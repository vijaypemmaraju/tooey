var v=null,H=0,x=new Set;function O(t){let e=t,n=new Set,a=()=>(v&&n.add(v),e);return a.set=o=>{let l=typeof o=="function"?o(e):o;l!==e&&(e=l,H>0?n.forEach(i=>x.add(i)):n.forEach(i=>i()))},a.sub=o=>(n.add(o),()=>n.delete(o)),a}function j(t){H++;try{t()}finally{if(H--,H===0){let e=x;x=new Set,e.forEach(n=>n())}}}function w(t,e){let n=!0,a=()=>{if(n){v=a;try{t()}finally{v=null}}};a();let o=()=>{n=!1,v=null};return e&&e.cleanups.push(o),o}function V(t,e,n){try{switch(e){case"+":t.set(a=>a+(typeof n=="number"?n:1));break;case"-":t.set(a=>a-(typeof n=="number"?n:1));break;case"!":t.set(n);break;case"~":t.set(a=>!a);break;case"<":t.set(a=>[...a,n]);break;case">":t.set(a=>[n,...a]);break;case"X":t.set(a=>{let o=a;return typeof n=="number"?o.filter((l,i)=>i!==n):typeof n=="function"?o.filter((l,i)=>!n(l,i)):o.filter(l=>l!==n)});break;case".":Array.isArray(n)&&n.length===2&&t.set(a=>({...a,[n[0]]:n[1]}));break}}catch(a){console.warn("[tooey] state operation error:",e,a)}}function M(t){return typeof t=="object"&&t!==null&&!Array.isArray(t)&&"$"in t}function N(t){return typeof t=="object"&&t!==null&&!Array.isArray(t)&&("if"in t||"?"in t)}function R(t){return typeof t=="object"&&t!==null&&!Array.isArray(t)&&("map"in t||"m"in t)}function p(t,e){if(M(t)){let n=e[t.$];if(!n){console.warn(`[tooey] unknown state key: "${t.$}"`);return}return n()}return t}function d(t){if(t!==void 0)return typeof t=="number"?`${t}px`:t}var D={c:"center",sb:"space-between",sa:"space-around",se:"space-evenly",fe:"flex-end",fs:"flex-start",st:"stretch",bl:"baseline"};function A(t){if(t!==void 0)return D[t]||t}function B(t){if(typeof t!="string"||t.length<2)return null;let e=t[t.length-1];if(e==="+"||e==="-"||e==="~")return[t.slice(0,-1),e];let n=t.indexOf("!");if(n>0){let a=t.slice(0,n),o=t.slice(n+1),l=o;return o==="true"?l=!0:o==="false"?l=!1:!isNaN(Number(o))&&o!==""&&(l=Number(o)),[a,"!",l]}return null}function z(t){let e=document.createElement("div");return e.textContent=t,e.innerHTML}function b(t,e,n,a,o){if(typeof t=="function")return t;let l;if(typeof t=="string"){let T=B(t);T?l=T:o==="+"?l=[t,"+"]:o==="-"?l=[t,"-"]:l=[t,"~"]}else l=t;let[i,r,f]=l;return()=>{let T=e[i];if(!T){console.warn(`[tooey] click handler: unknown state key "${i}"`);return}let s=f;if(a&&typeof s=="string"){if(s==="$index")s=a.index;else if(s==="$item")s=a.item;else if(s.startsWith("$item.")){let c=s.substring(6);s=a.item?.[c]}}if(r==="!"&&f===void 0&&n){let c=n.target;s=c.type==="checkbox"?c.checked:c.value}V(T,r,s)}}function q(t,e){let n=t.style;if(e.g!==void 0&&(n.gap=d(e.g)),e.p!==void 0&&(n.padding=d(e.p)),e.m!==void 0&&(n.margin=d(e.m)),e.w!==void 0&&(n.width=d(e.w)),e.h!==void 0&&(n.height=d(e.h)),e.mw!==void 0&&(n.maxWidth=d(e.mw)),e.mh!==void 0&&(n.maxHeight=d(e.mh)),e.bg!==void 0&&(n.background=e.bg),e.fg!==void 0&&(n.color=e.fg),e.o!==void 0&&(n.opacity=String(e.o)),e.r!==void 0&&(n.borderRadius=d(e.r)),e.bw!==void 0&&(n.borderWidth=d(e.bw)),e.bc!==void 0&&(n.borderColor=e.bc),e.bs!==void 0&&(n.borderStyle=e.bs),e.pos!==void 0){let a={rel:"relative",abs:"absolute",fix:"fixed",sticky:"sticky"};n.position=a[e.pos]||e.pos}e.z!==void 0&&(n.zIndex=String(e.z)),e.t!==void 0&&(n.top=d(e.t)),e.l!==void 0&&(n.left=d(e.l)),(typeof e.b=="number"||typeof e.b=="string"&&!Array.isArray(e.b))&&(n.bottom=d(e.b)),e.rt!==void 0&&(n.right=d(e.rt)),e.fs!==void 0&&(n.fontSize=d(e.fs)),e.fw!==void 0&&(n.fontWeight=String(e.fw)),e.ff!==void 0&&(n.fontFamily=e.ff),e.ta!==void 0&&(n.textAlign=e.ta),e.td!==void 0&&(n.textDecoration=e.td),e.lh!==void 0&&(n.lineHeight=typeof e.lh=="number"?String(e.lh):e.lh),e.ls!==void 0&&(n.letterSpacing=d(e.ls)),e.ai!==void 0&&(n.alignItems=A(e.ai)),e.jc!==void 0&&(n.justifyContent=A(e.jc)),e.flw!==void 0&&(n.flexWrap=A(e.flw)),e.cur!==void 0&&(n.cursor=e.cur),e.ov!==void 0&&(n.overflow=e.ov),e.pe!==void 0&&(n.pointerEvents=e.pe),e.us!==void 0&&(n.userSelect=e.us),e.sh!==void 0&&(n.boxShadow=e.sh),e.tr!==void 0&&(n.transform=e.tr),e.s&&Object.entries(e.s).forEach(([a,o])=>{n[a]=String(o)})}function h(t,e,n){let{state:a}=e;if(N(t)){let s=document.createElement("div");s.style.display="contents";let c=null,u=null,m=t.if??t["?"],S=t.then??t.t,g=t.else??t.e,y=t.eq??t.is;return w(()=>{u&&(u.cleanups.forEach(I=>I()),u.cleanups=[]),c&&(s.innerHTML="",c=null);let k=typeof m=="string"?a[m]?.():p(m,a),L;y!==void 0?L=k===y:L=!!k;let E=L?S:g;E&&(u={cleanups:[],state:a},Array.isArray(E)&&E.length>0&&Array.isArray(E[0])?E.forEach(I=>{let $=h(I,u,n);$&&s.appendChild($)}):(c=h(E,u,n),c&&s.appendChild(c)))},e),s}if(R(t)){let s=document.createElement("div");s.style.display="contents";let c=null,u=t.map??t.m,m=t.as??t.a;return w(()=>{c&&(c.cleanups.forEach(y=>y()),c.cleanups=[]),s.innerHTML="";let g=typeof u=="string"?a[u]?.():p(u,a);!Array.isArray(g)||!m||(c={cleanups:[],state:a},g.forEach((y,C)=>{let k=h(m,c,{item:y,index:C});k&&s.appendChild(k)}))},e),s}if(!Array.isArray(t)||t.length===0)return console.warn("[tooey] invalid node spec:",t),null;let[o,l,i={}]=t,r;switch(o){case"V":r=document.createElement("div"),r.style.display="flex",r.style.flexDirection="column";break;case"H":r=document.createElement("div"),r.style.display="flex",r.style.flexDirection="row";break;case"G":r=document.createElement("div"),r.style.display="grid",i.cols&&(r.style.gridTemplateColumns=typeof i.cols=="number"?`repeat(${i.cols}, 1fr)`:i.cols),i.rows&&(r.style.gridTemplateRows=typeof i.rows=="number"?`repeat(${i.rows}, 1fr)`:i.rows);break;case"D":r=document.createElement("div");break;case"T":r=document.createElement("span");break;case"B":r=document.createElement("button");break;case"I":r=document.createElement("input"),r.type=i.type||"text",i.ph&&(r.placeholder=i.ph),i.ro&&(r.readOnly=!0);break;case"Ta":r=document.createElement("textarea"),i.ph&&(r.placeholder=i.ph),i.rw&&(r.rows=i.rw),i.ro&&(r.readOnly=!0);break;case"S":r=document.createElement("select"),i.opts&&i.opts.forEach(s=>{let c=document.createElement("option");c.value=s.v,c.textContent=s.l,r.appendChild(c)});break;case"C":r=document.createElement("input"),r.type="checkbox";break;case"R":r=document.createElement("input"),r.type="radio";break;case"Tb":r=document.createElement("table");break;case"Th":r=document.createElement("thead");break;case"Tbd":r=document.createElement("tbody");break;case"Tr":r=document.createElement("tr");break;case"Td":r=document.createElement("td"),i.sp&&(r.colSpan=i.sp),i.rsp&&(r.rowSpan=i.rsp);break;case"Tc":r=document.createElement("th"),i.sp&&(r.colSpan=i.sp),i.rsp&&(r.rowSpan=i.rsp);break;case"Ul":r=document.createElement("ul");break;case"Ol":r=document.createElement("ol");break;case"Li":r=document.createElement("li");break;case"M":r=document.createElement("img"),i.src&&(r.src=i.src),i.alt&&(r.alt=i.alt);break;case"L":r=document.createElement("a"),i.href&&(r.href=i.href);break;case"Sv":r=document.createElementNS("http://www.w3.org/2000/svg","svg");break;default:console.warn(`[tooey] unknown component type: ${o}`),r=document.createElement("div")}if(i.cls&&(r.className=i.cls),i.id&&(r.id=i.id),i.dis&&(r.disabled=!0),q(r,i),l!==void 0){if(Array.isArray(l)&&l.length>0&&(Array.isArray(l[0])||N(l[0])||R(l[0])))l.forEach(s=>{let c=h(s,e,n);c&&r.appendChild(c)});else if(N(l)||R(l)){let s=h(l,e,n);s&&r.appendChild(s)}else if(M(l))w(()=>{let s=p(l,a),c=z(String(s??""));o==="I"||o==="Ta"?r.value=String(s??""):o==="C"||o==="R"?r.checked=!!s:r.textContent=String(s??"")},e);else if(typeof l=="string"||typeof l=="number"){let s=String(l);n&&(typeof n.item=="object"&&n.item!==null&&(s=s.replace(/\$item\.(\w+)/g,(c,u)=>String(n.item[u]??""))),s=s.replace(/\$item/g,String(n.item)),s=s.replace(/\$index/g,String(n.index))),o==="I"||o==="Ta"?r.value=s:o!=="S"&&(r.textContent=s)}}i.v!==void 0&&M(i.v)&&w(()=>{let s=p(i.v,a);o==="I"||o==="S"||o==="Ta"?r.value=String(s??""):(o==="C"||o==="R")&&(r.checked=!!s)},e),i.ch!==void 0&&(M(i.ch)?w(()=>{let s=p(i.ch,a);r.checked=!!s},e):r.checked=!!i.ch);let f=(s,c)=>{r.addEventListener(s,c),e.cleanups.push(()=>r.removeEventListener(s,c))},T=o==="B"&&(typeof l=="string"||typeof l=="number")?String(l):void 0;if(i.c&&f("click",s=>b(i.c,a,s,n,T)()),i.x){let s=i.x;f("input",c=>{if(typeof s=="function")s();else{let u,m;if(typeof s=="string"){let g=B(s);g?[u,m]=g:(u=s,m="!")}else[u,m]=s;let S=a[u];if(S){let g=c.target,y=o==="C"||o==="R"?g.checked:g.value;V(S,m,y)}}})}return i.f&&f("focus",s=>b(i.f,a,s,n)()),i.bl&&f("blur",s=>b(i.bl,a,s,n)()),i.k&&f("keydown",s=>b(i.k,a,s,n)()),i.ku&&f("keyup",s=>b(i.ku,a,s,n)()),i.kp&&f("keypress",s=>b(i.kp,a,s,n)()),i.e&&f("mouseenter",s=>b(i.e,a,s,n)()),i.lv&&f("mouseleave",s=>b(i.lv,a,s,n)()),i.sub&&f("submit",s=>{s.preventDefault(),b(i.sub,a,s,n)()}),r}function P(t,e){if(!t)throw new Error("[tooey] render requires a valid container element");if(!e||!e.r)throw new Error("[tooey] render requires a spec with a root node (r)");let n={};e.s&&Object.entries(e.s).forEach(([i,r])=>{n[i]=O(r)});let a={cleanups:[],state:n};t.innerHTML="";let o=h(e.r,a);o&&t.appendChild(o);let l={state:n,el:o,destroy(){a.cleanups.forEach(i=>i()),a.cleanups=[],t.innerHTML=""},update(i){if(i.s&&j(()=>{Object.entries(i.s).forEach(([r,f])=>{n[r]?n[r].set(f):n[r]=O(f)})}),i.r){a.cleanups.forEach(f=>f()),a.cleanups=[],t.innerHTML="";let r=h(i.r,a);r&&t.appendChild(r),l.el=r}},get(i){return n[i]?.()},set(i,r){n[i]&&n[i].set(r)}};return l}function W(t){return{$:t}}var G="V",U="H",K="D",X="G",_="T",F="B",J="I",Q="Ta",Y="S",Z="C",ee="R",ne="Tb",te="Th",ie="Tbd",re="Tr",se="Td",ae="Tc",oe="Ul",le="Ol",ce="Li",fe="M",ue="L",de="Sv";export{W as $,F as B,Z as C,K as D,X as G,U as H,J as I,ue as L,ce as Li,fe as M,le as Ol,ee as R,Y as S,de as Sv,_ as T,Q as Ta,ne as Tb,ie as Tbd,ae as Tc,se as Td,te as Th,re as Tr,oe as Ul,G as V,j as batch,w as effect,P as render,O as signal};
//# sourceMappingURL=tooey.esm.js.map
