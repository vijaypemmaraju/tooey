var S=null,w=0,p=new Set;function I(r){let e=r,n=new Set,s=()=>(S&&n.add(S),e);return s.set=o=>{let c=typeof o=="function"?o(e):o;c!==e&&(e=c,w>0?n.forEach(t=>p.add(t)):n.forEach(t=>t()))},s.sub=o=>(n.add(o),()=>n.delete(o)),s}function A(r){w++;try{r()}finally{if(w--,w===0){let e=p;p=new Set,e.forEach(n=>n())}}}function E(r,e){let n=!0,s=()=>{if(n){S=s;try{r()}finally{S=null}}};s();let o=()=>{n=!1,S=null};return e&&e.cleanups.push(o),o}function C(r,e,n){try{switch(e){case"+":r.set(s=>s+(typeof n=="number"?n:1));break;case"-":r.set(s=>s-(typeof n=="number"?n:1));break;case"!":r.set(n);break;case"~":r.set(s=>!s);break;case"<":r.set(s=>[...s,n]);break;case">":r.set(s=>[n,...s]);break;case"X":r.set(s=>{let o=s;return typeof n=="number"?o.filter((c,t)=>t!==n):typeof n=="function"?o.filter((c,t)=>!n(c,t)):o.filter(c=>c!==n)});break;case".":Array.isArray(n)&&n.length===2&&r.set(s=>({...s,[n[0]]:n[1]}));break}}catch(s){console.warn("[tooey] state operation error:",e,s)}}function v(r){return typeof r=="object"&&r!==null&&!Array.isArray(r)&&"$"in r}function H(r){return typeof r=="object"&&r!==null&&!Array.isArray(r)&&"if"in r}function M(r){return typeof r=="object"&&r!==null&&!Array.isArray(r)&&"map"in r}function k(r,e){if(v(r)){let n=e[r.$];if(!n){console.warn(`[tooey] unknown state key: "${r.$}"`);return}return n()}return r}function u(r){if(r!==void 0)return typeof r=="number"?`${r}px`:r}function R(r){let e=document.createElement("div");return e.textContent=r,e.innerHTML}function g(r,e,n){if(typeof r=="function")return r;let[s,o,c]=r;return()=>{let t=e[s];if(!t){console.warn(`[tooey] click handler: unknown state key "${s}"`);return}let i=c;if(o==="!"&&c===void 0&&n){let f=n.target;i=f.type==="checkbox"?f.checked:f.value}C(t,o,i)}}function x(r,e){let n=r.style;if(e.g!==void 0&&(n.gap=u(e.g)),e.p!==void 0&&(n.padding=u(e.p)),e.m!==void 0&&(n.margin=u(e.m)),e.w!==void 0&&(n.width=u(e.w)),e.h!==void 0&&(n.height=u(e.h)),e.mw!==void 0&&(n.maxWidth=u(e.mw)),e.mh!==void 0&&(n.maxHeight=u(e.mh)),e.bg!==void 0&&(n.background=e.bg),e.fg!==void 0&&(n.color=e.fg),e.o!==void 0&&(n.opacity=String(e.o)),e.r!==void 0&&(n.borderRadius=u(e.r)),e.bw!==void 0&&(n.borderWidth=u(e.bw)),e.bc!==void 0&&(n.borderColor=e.bc),e.bs!==void 0&&(n.borderStyle=e.bs),e.pos!==void 0){let s={rel:"relative",abs:"absolute",fix:"fixed",sticky:"sticky"};n.position=s[e.pos]||e.pos}e.z!==void 0&&(n.zIndex=String(e.z)),e.t!==void 0&&(n.top=u(e.t)),e.l!==void 0&&(n.left=u(e.l)),(typeof e.b=="number"||typeof e.b=="string"&&!Array.isArray(e.b))&&(n.bottom=u(e.b)),e.rt!==void 0&&(n.right=u(e.rt)),e.fs!==void 0&&(n.fontSize=u(e.fs)),e.fw!==void 0&&(n.fontWeight=String(e.fw)),e.ff!==void 0&&(n.fontFamily=e.ff),e.ta!==void 0&&(n.textAlign=e.ta),e.td!==void 0&&(n.textDecoration=e.td),e.lh!==void 0&&(n.lineHeight=typeof e.lh=="number"?String(e.lh):e.lh),e.ls!==void 0&&(n.letterSpacing=u(e.ls)),e.ai!==void 0&&(n.alignItems=e.ai),e.jc!==void 0&&(n.justifyContent=e.jc),e.flw!==void 0&&(n.flexWrap=e.flw),e.cur!==void 0&&(n.cursor=e.cur),e.ov!==void 0&&(n.overflow=e.ov),e.pe!==void 0&&(n.pointerEvents=e.pe),e.us!==void 0&&(n.userSelect=e.us),e.sh!==void 0&&(n.boxShadow=e.sh),e.tr!==void 0&&(n.transform=e.tr),e.s&&Object.entries(e.s).forEach(([s,o])=>{n[s]=String(o)})}function T(r,e,n){let{state:s}=e;if(H(r)){let a=document.createElement("div");a.style.display="contents";let l=null,d=null;return E(()=>{d&&(d.cleanups.forEach(b=>b()),d.cleanups=[]),l&&(a.innerHTML="",l=null);let m=(typeof r.if=="string"?s[r.if]?.():k(r.if,s))?r.then:r.else;m&&(d={cleanups:[],state:s},Array.isArray(m)&&m.length>0&&Array.isArray(m[0])?m.forEach(b=>{let L=T(b,d,n);L&&a.appendChild(L)}):(l=T(m,d,n),l&&a.appendChild(l)))},e),a}if(M(r)){let a=document.createElement("div");a.style.display="contents";let l=null;return E(()=>{l&&(l.cleanups.forEach(y=>y()),l.cleanups=[]),a.innerHTML="";let h=typeof r.map=="string"?s[r.map]?.():k(r.map,s);Array.isArray(h)&&(l={cleanups:[],state:s},h.forEach((y,m)=>{let b=T(r.as,l,{item:y,index:m});b&&a.appendChild(b)}))},e),a}if(!Array.isArray(r)||r.length===0)return console.warn("[tooey] invalid node spec:",r),null;let[o,c,t={}]=r,i;switch(o){case"V":i=document.createElement("div"),i.style.display="flex",i.style.flexDirection="column";break;case"H":i=document.createElement("div"),i.style.display="flex",i.style.flexDirection="row";break;case"G":i=document.createElement("div"),i.style.display="grid",t.cols&&(i.style.gridTemplateColumns=typeof t.cols=="number"?`repeat(${t.cols}, 1fr)`:t.cols),t.rows&&(i.style.gridTemplateRows=typeof t.rows=="number"?`repeat(${t.rows}, 1fr)`:t.rows);break;case"D":i=document.createElement("div");break;case"T":i=document.createElement("span");break;case"B":i=document.createElement("button");break;case"I":i=document.createElement("input"),i.type=t.type||"text",t.ph&&(i.placeholder=t.ph),t.ro&&(i.readOnly=!0);break;case"Ta":i=document.createElement("textarea"),t.ph&&(i.placeholder=t.ph),t.rw&&(i.rows=t.rw),t.ro&&(i.readOnly=!0);break;case"S":i=document.createElement("select"),t.opts&&t.opts.forEach(a=>{let l=document.createElement("option");l.value=a.v,l.textContent=a.l,i.appendChild(l)});break;case"C":i=document.createElement("input"),i.type="checkbox";break;case"R":i=document.createElement("input"),i.type="radio";break;case"Tb":i=document.createElement("table");break;case"Th":i=document.createElement("thead");break;case"Tbd":i=document.createElement("tbody");break;case"Tr":i=document.createElement("tr");break;case"Td":i=document.createElement("td"),t.sp&&(i.colSpan=t.sp),t.rsp&&(i.rowSpan=t.rsp);break;case"Tc":i=document.createElement("th"),t.sp&&(i.colSpan=t.sp),t.rsp&&(i.rowSpan=t.rsp);break;case"Ul":i=document.createElement("ul");break;case"Ol":i=document.createElement("ol");break;case"Li":i=document.createElement("li");break;case"M":i=document.createElement("img"),t.src&&(i.src=t.src),t.alt&&(i.alt=t.alt);break;case"L":i=document.createElement("a"),t.href&&(i.href=t.href);break;case"Sv":i=document.createElementNS("http://www.w3.org/2000/svg","svg");break;default:console.warn(`[tooey] unknown component type: ${o}`),i=document.createElement("div")}if(t.cls&&(i.className=t.cls),t.id&&(i.id=t.id),t.dis&&(i.disabled=!0),x(i,t),c!==void 0){if(Array.isArray(c)&&c.length>0&&(Array.isArray(c[0])||H(c[0])||M(c[0])))c.forEach(a=>{let l=T(a,e,n);l&&i.appendChild(l)});else if(H(c)||M(c)){let a=T(c,e,n);a&&i.appendChild(a)}else if(v(c))E(()=>{let a=k(c,s),l=R(String(a??""));o==="I"||o==="Ta"?i.value=String(a??""):o==="C"||o==="R"?i.checked=!!a:i.textContent=String(a??"")},e);else if(typeof c=="string"||typeof c=="number"){let a=String(c);n&&(typeof n.item=="object"&&n.item!==null&&(a=a.replace(/\$item\.(\w+)/g,(l,d)=>String(n.item[d]??""))),a=a.replace(/\$item/g,String(n.item)),a=a.replace(/\$index/g,String(n.index))),o==="I"||o==="Ta"?i.value=a:o!=="S"&&(i.textContent=a)}}t.v!==void 0&&v(t.v)&&E(()=>{let a=k(t.v,s);o==="I"||o==="S"||o==="Ta"?i.value=String(a??""):(o==="C"||o==="R")&&(i.checked=!!a)},e),t.ch!==void 0&&(v(t.ch)?E(()=>{let a=k(t.ch,s);i.checked=!!a},e):i.checked=!!t.ch);let f=(a,l)=>{i.addEventListener(a,l),e.cleanups.push(()=>i.removeEventListener(a,l))};if(t.c&&f("click",a=>g(t.c,s,a)()),t.x){let a=t.x;f("input",l=>{if(typeof a=="function")a();else{let[d,h]=a,y=s[d];if(y){let m=l.target,b=o==="C"||o==="R"?m.checked:m.value;C(y,h,b)}}})}return t.f&&f("focus",a=>g(t.f,s,a)()),t.bl&&f("blur",a=>g(t.bl,s,a)()),t.k&&f("keydown",a=>g(t.k,s,a)()),t.ku&&f("keyup",a=>g(t.ku,s,a)()),t.kp&&f("keypress",a=>g(t.kp,s,a)()),t.e&&f("mouseenter",a=>g(t.e,s,a)()),t.lv&&f("mouseleave",a=>g(t.lv,s,a)()),t.sub&&f("submit",a=>{a.preventDefault(),g(t.sub,s,a)()}),i}function N(r,e){if(!r)throw new Error("[tooey] render requires a valid container element");if(!e||!e.r)throw new Error("[tooey] render requires a spec with a root node (r)");let n={};e.s&&Object.entries(e.s).forEach(([t,i])=>{n[t]=I(i)});let s={cleanups:[],state:n};r.innerHTML="";let o=T(e.r,s);o&&r.appendChild(o);let c={state:n,el:o,destroy(){s.cleanups.forEach(t=>t()),s.cleanups=[],r.innerHTML=""},update(t){if(t.s&&A(()=>{Object.entries(t.s).forEach(([i,f])=>{n[i]?n[i].set(f):n[i]=I(f)})}),t.r){s.cleanups.forEach(f=>f()),s.cleanups=[],r.innerHTML="";let i=T(t.r,s);i&&r.appendChild(i),c.el=i}},get(t){return n[t]?.()},set(t,i){n[t]&&n[t].set(i)}};return c}function $(r){return{$:r}}var O="V",V="H",j="D",B="G",D="T",z="B",P="I",G="Ta",U="S",W="C",q="R",K="Tb",X="Th",_="Tbd",F="Tr",J="Td",Q="Tc",Y="Ul",Z="Ol",ee="Li",ne="M",te="L",ie="Sv";export{$,z as B,W as C,j as D,B as G,V as H,P as I,te as L,ee as Li,ne as M,Z as Ol,q as R,U as S,ie as Sv,D as T,G as Ta,K as Tb,_ as Tbd,Q as Tc,J as Td,X as Th,F as Tr,Y as Ul,O as V,A as batch,E as effect,N as render,I as signal};
//# sourceMappingURL=tooey.esm.js.map
