var S=null,w=0,p=new Set;function I(i){let e=i,n=new Set,s=()=>(S&&n.add(S),e);return s.set=o=>{let c=typeof o=="function"?o(e):o;c!==e&&(e=c,w>0?n.forEach(t=>p.add(t)):n.forEach(t=>t()))},s.sub=o=>(n.add(o),()=>n.delete(o)),s}function R(i){w++;try{i()}finally{if(w--,w===0){let e=p;p=new Set,e.forEach(n=>n())}}}function E(i,e){let n=!0,s=()=>{if(n){S=s;try{i()}finally{S=null}}};s();let o=()=>{n=!1,S=null};return e&&e.cleanups.push(o),o}function A(i,e,n){try{switch(e){case"+":i.set(s=>s+(typeof n=="number"?n:1));break;case"-":i.set(s=>s-(typeof n=="number"?n:1));break;case"!":i.set(n);break;case"~":i.set(s=>!s);break;case"<":i.set(s=>[...s,n]);break;case">":i.set(s=>[n,...s]);break;case"X":i.set(s=>{let o=s;return typeof n=="number"?o.filter((c,t)=>t!==n):typeof n=="function"?o.filter((c,t)=>!n(c,t)):o.filter(c=>c!==n)});break;case".":Array.isArray(n)&&n.length===2&&i.set(s=>({...s,[n[0]]:n[1]}));break}}catch(s){console.warn("[tooey] state operation error:",e,s)}}function v(i){return typeof i=="object"&&i!==null&&!Array.isArray(i)&&"$"in i}function H(i){return typeof i=="object"&&i!==null&&!Array.isArray(i)&&"if"in i}function M(i){return typeof i=="object"&&i!==null&&!Array.isArray(i)&&"map"in i}function k(i,e){if(v(i)){let n=e[i.$];if(!n){console.warn(`[tooey] unknown state key: "${i.$}"`);return}return n()}return i}function u(i){if(i!==void 0)return typeof i=="number"?`${i}px`:i}function N(i){let e=document.createElement("div");return e.textContent=i,e.innerHTML}function g(i,e,n,s){if(typeof i=="function")return i;let[o,c,t]=i;return()=>{let r=e[o];if(!r){console.warn(`[tooey] click handler: unknown state key "${o}"`);return}let l=t;if(s&&typeof l=="string"){if(l==="$index")l=s.index;else if(l==="$item")l=s.item;else if(l.startsWith("$item.")){let a=l.substring(6);l=s.item?.[a]}}if(c==="!"&&t===void 0&&n){let a=n.target;l=a.type==="checkbox"?a.checked:a.value}A(r,c,l)}}function C(i,e){let n=i.style;if(e.g!==void 0&&(n.gap=u(e.g)),e.p!==void 0&&(n.padding=u(e.p)),e.m!==void 0&&(n.margin=u(e.m)),e.w!==void 0&&(n.width=u(e.w)),e.h!==void 0&&(n.height=u(e.h)),e.mw!==void 0&&(n.maxWidth=u(e.mw)),e.mh!==void 0&&(n.maxHeight=u(e.mh)),e.bg!==void 0&&(n.background=e.bg),e.fg!==void 0&&(n.color=e.fg),e.o!==void 0&&(n.opacity=String(e.o)),e.r!==void 0&&(n.borderRadius=u(e.r)),e.bw!==void 0&&(n.borderWidth=u(e.bw)),e.bc!==void 0&&(n.borderColor=e.bc),e.bs!==void 0&&(n.borderStyle=e.bs),e.pos!==void 0){let s={rel:"relative",abs:"absolute",fix:"fixed",sticky:"sticky"};n.position=s[e.pos]||e.pos}e.z!==void 0&&(n.zIndex=String(e.z)),e.t!==void 0&&(n.top=u(e.t)),e.l!==void 0&&(n.left=u(e.l)),(typeof e.b=="number"||typeof e.b=="string"&&!Array.isArray(e.b))&&(n.bottom=u(e.b)),e.rt!==void 0&&(n.right=u(e.rt)),e.fs!==void 0&&(n.fontSize=u(e.fs)),e.fw!==void 0&&(n.fontWeight=String(e.fw)),e.ff!==void 0&&(n.fontFamily=e.ff),e.ta!==void 0&&(n.textAlign=e.ta),e.td!==void 0&&(n.textDecoration=e.td),e.lh!==void 0&&(n.lineHeight=typeof e.lh=="number"?String(e.lh):e.lh),e.ls!==void 0&&(n.letterSpacing=u(e.ls)),e.ai!==void 0&&(n.alignItems=e.ai),e.jc!==void 0&&(n.justifyContent=e.jc),e.flw!==void 0&&(n.flexWrap=e.flw),e.cur!==void 0&&(n.cursor=e.cur),e.ov!==void 0&&(n.overflow=e.ov),e.pe!==void 0&&(n.pointerEvents=e.pe),e.us!==void 0&&(n.userSelect=e.us),e.sh!==void 0&&(n.boxShadow=e.sh),e.tr!==void 0&&(n.transform=e.tr),e.s&&Object.entries(e.s).forEach(([s,o])=>{n[s]=String(o)})}function T(i,e,n){let{state:s}=e;if(H(i)){let a=document.createElement("div");a.style.display="contents";let f=null,d=null;return E(()=>{d&&(d.cleanups.forEach(b=>b()),d.cleanups=[]),f&&(a.innerHTML="",f=null);let m=(typeof i.if=="string"?s[i.if]?.():k(i.if,s))?i.then:i.else;m&&(d={cleanups:[],state:s},Array.isArray(m)&&m.length>0&&Array.isArray(m[0])?m.forEach(b=>{let L=T(b,d,n);L&&a.appendChild(L)}):(f=T(m,d,n),f&&a.appendChild(f)))},e),a}if(M(i)){let a=document.createElement("div");a.style.display="contents";let f=null;return E(()=>{f&&(f.cleanups.forEach(y=>y()),f.cleanups=[]),a.innerHTML="";let h=typeof i.map=="string"?s[i.map]?.():k(i.map,s);Array.isArray(h)&&(f={cleanups:[],state:s},h.forEach((y,m)=>{let b=T(i.as,f,{item:y,index:m});b&&a.appendChild(b)}))},e),a}if(!Array.isArray(i)||i.length===0)return console.warn("[tooey] invalid node spec:",i),null;let[o,c,t={}]=i,r;switch(o){case"V":r=document.createElement("div"),r.style.display="flex",r.style.flexDirection="column";break;case"H":r=document.createElement("div"),r.style.display="flex",r.style.flexDirection="row";break;case"G":r=document.createElement("div"),r.style.display="grid",t.cols&&(r.style.gridTemplateColumns=typeof t.cols=="number"?`repeat(${t.cols}, 1fr)`:t.cols),t.rows&&(r.style.gridTemplateRows=typeof t.rows=="number"?`repeat(${t.rows}, 1fr)`:t.rows);break;case"D":r=document.createElement("div");break;case"T":r=document.createElement("span");break;case"B":r=document.createElement("button");break;case"I":r=document.createElement("input"),r.type=t.type||"text",t.ph&&(r.placeholder=t.ph),t.ro&&(r.readOnly=!0);break;case"Ta":r=document.createElement("textarea"),t.ph&&(r.placeholder=t.ph),t.rw&&(r.rows=t.rw),t.ro&&(r.readOnly=!0);break;case"S":r=document.createElement("select"),t.opts&&t.opts.forEach(a=>{let f=document.createElement("option");f.value=a.v,f.textContent=a.l,r.appendChild(f)});break;case"C":r=document.createElement("input"),r.type="checkbox";break;case"R":r=document.createElement("input"),r.type="radio";break;case"Tb":r=document.createElement("table");break;case"Th":r=document.createElement("thead");break;case"Tbd":r=document.createElement("tbody");break;case"Tr":r=document.createElement("tr");break;case"Td":r=document.createElement("td"),t.sp&&(r.colSpan=t.sp),t.rsp&&(r.rowSpan=t.rsp);break;case"Tc":r=document.createElement("th"),t.sp&&(r.colSpan=t.sp),t.rsp&&(r.rowSpan=t.rsp);break;case"Ul":r=document.createElement("ul");break;case"Ol":r=document.createElement("ol");break;case"Li":r=document.createElement("li");break;case"M":r=document.createElement("img"),t.src&&(r.src=t.src),t.alt&&(r.alt=t.alt);break;case"L":r=document.createElement("a"),t.href&&(r.href=t.href);break;case"Sv":r=document.createElementNS("http://www.w3.org/2000/svg","svg");break;default:console.warn(`[tooey] unknown component type: ${o}`),r=document.createElement("div")}if(t.cls&&(r.className=t.cls),t.id&&(r.id=t.id),t.dis&&(r.disabled=!0),C(r,t),c!==void 0){if(Array.isArray(c)&&c.length>0&&(Array.isArray(c[0])||H(c[0])||M(c[0])))c.forEach(a=>{let f=T(a,e,n);f&&r.appendChild(f)});else if(H(c)||M(c)){let a=T(c,e,n);a&&r.appendChild(a)}else if(v(c))E(()=>{let a=k(c,s),f=N(String(a??""));o==="I"||o==="Ta"?r.value=String(a??""):o==="C"||o==="R"?r.checked=!!a:r.textContent=String(a??"")},e);else if(typeof c=="string"||typeof c=="number"){let a=String(c);n&&(typeof n.item=="object"&&n.item!==null&&(a=a.replace(/\$item\.(\w+)/g,(f,d)=>String(n.item[d]??""))),a=a.replace(/\$item/g,String(n.item)),a=a.replace(/\$index/g,String(n.index))),o==="I"||o==="Ta"?r.value=a:o!=="S"&&(r.textContent=a)}}t.v!==void 0&&v(t.v)&&E(()=>{let a=k(t.v,s);o==="I"||o==="S"||o==="Ta"?r.value=String(a??""):(o==="C"||o==="R")&&(r.checked=!!a)},e),t.ch!==void 0&&(v(t.ch)?E(()=>{let a=k(t.ch,s);r.checked=!!a},e):r.checked=!!t.ch);let l=(a,f)=>{r.addEventListener(a,f),e.cleanups.push(()=>r.removeEventListener(a,f))};if(t.c&&l("click",a=>g(t.c,s,a,n)()),t.x){let a=t.x;l("input",f=>{if(typeof a=="function")a();else{let[d,h]=a,y=s[d];if(y){let m=f.target,b=o==="C"||o==="R"?m.checked:m.value;A(y,h,b)}}})}return t.f&&l("focus",a=>g(t.f,s,a,n)()),t.bl&&l("blur",a=>g(t.bl,s,a,n)()),t.k&&l("keydown",a=>g(t.k,s,a,n)()),t.ku&&l("keyup",a=>g(t.ku,s,a,n)()),t.kp&&l("keypress",a=>g(t.kp,s,a,n)()),t.e&&l("mouseenter",a=>g(t.e,s,a,n)()),t.lv&&l("mouseleave",a=>g(t.lv,s,a,n)()),t.sub&&l("submit",a=>{a.preventDefault(),g(t.sub,s,a,n)()}),r}function x(i,e){if(!i)throw new Error("[tooey] render requires a valid container element");if(!e||!e.r)throw new Error("[tooey] render requires a spec with a root node (r)");let n={};e.s&&Object.entries(e.s).forEach(([t,r])=>{n[t]=I(r)});let s={cleanups:[],state:n};i.innerHTML="";let o=T(e.r,s);o&&i.appendChild(o);let c={state:n,el:o,destroy(){s.cleanups.forEach(t=>t()),s.cleanups=[],i.innerHTML=""},update(t){if(t.s&&R(()=>{Object.entries(t.s).forEach(([r,l])=>{n[r]?n[r].set(l):n[r]=I(l)})}),t.r){s.cleanups.forEach(l=>l()),s.cleanups=[],i.innerHTML="";let r=T(t.r,s);r&&i.appendChild(r),c.el=r}},get(t){return n[t]?.()},set(t,r){n[t]&&n[t].set(r)}};return c}function $(i){return{$:i}}var O="V",V="H",j="D",B="G",D="T",z="B",P="I",W="Ta",G="S",U="C",q="R",K="Tb",X="Th",_="Tbd",F="Tr",J="Td",Q="Tc",Y="Ul",Z="Ol",ee="Li",ne="M",te="L",re="Sv";export{$,z as B,U as C,j as D,B as G,V as H,P as I,te as L,ee as Li,ne as M,Z as Ol,q as R,G as S,re as Sv,D as T,W as Ta,K as Tb,_ as Tbd,Q as Tc,J as Td,X as Th,F as Tr,Y as Ul,O as V,R as batch,E as effect,x as render,I as signal};
//# sourceMappingURL=tooey.esm.js.map
