{
  "version": 3,
  "sources": ["../src/adapters/edge.ts", "../src/adapters/types.ts"],
  "sourcesContent": ["/**\n * @tooey/server edge adapter\n *\n * adapter for edge runtimes (cloudflare workers, deno deploy, vercel edge)\n */\n\nimport type { AdapterRequest, AdapterResponse } from '../types.js';\nimport type { Adapter, RequestHandler } from './types.js';\nimport { createHandler } from './types.js';\n\n// ============ edge adapter ============\n\n/**\n * edge runtime adapter (web fetch api compatible)\n */\nexport const edgeAdapter: Adapter = {\n  name: 'edge',\n\n  async toRequest(req: unknown): Promise<AdapterRequest> {\n    const fetchReq = req as Request;\n    const url = fetchReq.url;\n    const method = fetchReq.method;\n\n    // convert headers\n    const headers: Record<string, string> = {};\n    fetchReq.headers.forEach((value, key) => {\n      headers[key.toLowerCase()] = value;\n    });\n\n    // parse body\n    let body: unknown;\n    if (['POST', 'PUT', 'PATCH'].includes(method)) {\n      body = await parseBody(fetchReq);\n    }\n\n    return {\n      url,\n      method,\n      headers,\n      body,\n    };\n  },\n\n  toResponse(res: AdapterResponse): Response {\n    const init: ResponseInit = {\n      status: res.status,\n      headers: res.headers,\n    };\n\n    if (typeof res.body === 'string') {\n      return new Response(res.body, init);\n    }\n\n    if (res.body instanceof ReadableStream) {\n      return new Response(res.body, init);\n    }\n\n    return new Response(null, init);\n  },\n};\n\n// ============ body parsing ============\n\nasync function parseBody(req: Request): Promise<unknown> {\n  const contentType = req.headers.get('content-type') || '';\n\n  try {\n    if (contentType.includes('application/json')) {\n      return await req.json();\n    }\n\n    if (contentType.includes('application/x-www-form-urlencoded')) {\n      const text = await req.text();\n      return Object.fromEntries(new URLSearchParams(text));\n    }\n\n    if (contentType.includes('multipart/form-data')) {\n      const formData = await req.formData();\n      const obj: Record<string, unknown> = {};\n      formData.forEach((value, key) => {\n        obj[key] = value;\n      });\n      return obj;\n    }\n\n    return await req.text();\n  } catch {\n    return undefined;\n  }\n}\n\n// ============ edge handler ============\n\n/**\n * create edge-compatible fetch handler\n */\nexport function createFetchHandler(\n  handler: RequestHandler\n): (req: Request) => Promise<Response> {\n  const handle = createHandler(edgeAdapter, handler);\n\n  return async (req) => {\n    try {\n      return (await handle(req)) as Response;\n    } catch (err) {\n      console.error('[tooey/server] request error:', err);\n      return new Response(\n        JSON.stringify({ error: 'internal server error' }),\n        {\n          status: 500,\n          headers: { 'Content-Type': 'application/json' },\n        }\n      );\n    }\n  };\n}\n\n// ============ cloudflare workers ============\n\n/**\n * cloudflare workers environment types\n */\nexport interface CloudflareEnv {\n  [key: string]: unknown;\n}\n\nexport interface CloudflareContext {\n  waitUntil(promise: Promise<unknown>): void;\n  passThroughOnException(): void;\n}\n\n/**\n * create cloudflare workers handler\n */\nexport function createCfHandler(\n  handler: RequestHandler\n): (req: Request, env: CloudflareEnv, ctx: CloudflareContext) => Promise<Response> {\n  const fetchHandler = createFetchHandler(handler);\n\n  return async (req, _env, _ctx) => {\n    return fetchHandler(req);\n  };\n}\n\n// ============ deno ============\n\n/**\n * create deno.serve compatible handler\n */\nexport function createDenoHandler(\n  handler: RequestHandler\n): (req: Request) => Promise<Response> {\n  return createFetchHandler(handler);\n}\n\n// ============ vercel edge ============\n\n/**\n * create vercel edge function handler\n */\nexport function createVercelHandler(\n  handler: RequestHandler\n): (req: Request) => Promise<Response> {\n  return createFetchHandler(handler);\n}\n\n// ============ bun ============\n\n/**\n * create bun.serve compatible handler\n */\nexport function createBunHandler(\n  handler: RequestHandler\n): (req: Request) => Promise<Response> {\n  return createFetchHandler(handler);\n}\n\n// ============ exports ============\n\nexport { createHandler } from './types.js';\nexport type { Adapter, RequestHandler } from './types.js';\n", "/**\n * @tooey/server adapter types\n *\n * common interfaces for server adapters\n */\n\nimport type { AdapterRequest, AdapterResponse } from '../types.js';\n\n/**\n * adapter interface\n * converts between platform-specific request/response and tooey's format\n */\nexport interface Adapter {\n  /** adapter name */\n  name: string;\n  /** convert platform request to adapter request */\n  toRequest(req: unknown): AdapterRequest | Promise<AdapterRequest>;\n  /** convert adapter response to platform response */\n  toResponse(res: AdapterResponse, platformRes?: unknown): unknown;\n}\n\n/**\n * request handler type\n * adapters wrap this to create platform-specific handlers\n */\nexport type RequestHandler = (req: AdapterRequest) => Promise<AdapterResponse>;\n\n/**\n * create adapter handler\n * wraps a tooey request handler with adapter conversion\n */\nexport function createHandler(\n  adapter: Adapter,\n  handler: RequestHandler\n): (req: unknown, res?: unknown) => Promise<unknown> {\n  return async (platformReq, platformRes) => {\n    const req = await adapter.toRequest(platformReq);\n    const response = await handler(req);\n    return adapter.toResponse(response, platformRes);\n  };\n}\n"],
  "mappings": "yaAAA,IAAAA,EAAA,GAAAC,EAAAD,EAAA,sBAAAE,EAAA,oBAAAC,EAAA,sBAAAC,EAAA,uBAAAC,EAAA,kBAAAC,EAAA,wBAAAC,EAAA,gBAAAC,IAAA,eAAAC,EAAAT,GC+BO,SAASU,EACdC,EACAC,EACmD,CACnD,MAAO,OAAOC,EAAaC,IAAgB,CACzC,IAAMC,EAAM,MAAMJ,EAAQ,UAAUE,CAAW,EACzCG,EAAW,MAAMJ,EAAQG,CAAG,EAClC,OAAOJ,EAAQ,WAAWK,EAAUF,CAAW,CACjD,CACF,CDzBO,IAAMG,EAAuB,CAClC,KAAM,OAEN,MAAM,UAAUC,EAAuC,CACrD,IAAMC,EAAWD,EACXE,EAAMD,EAAS,IACfE,EAASF,EAAS,OAGlBG,EAAkC,CAAC,EACzCH,EAAS,QAAQ,QAAQ,CAACI,EAAOC,IAAQ,CACvCF,EAAQE,EAAI,YAAY,CAAC,EAAID,CAC/B,CAAC,EAGD,IAAIE,EACJ,MAAI,CAAC,OAAQ,MAAO,OAAO,EAAE,SAASJ,CAAM,IAC1CI,EAAO,MAAMC,EAAUP,CAAQ,GAG1B,CACL,IAAAC,EACA,OAAAC,EACA,QAAAC,EACA,KAAAG,CACF,CACF,EAEA,WAAWE,EAAgC,CACzC,IAAMC,EAAqB,CACzB,OAAQD,EAAI,OACZ,QAASA,EAAI,OACf,EAEA,OAAI,OAAOA,EAAI,MAAS,SACf,IAAI,SAASA,EAAI,KAAMC,CAAI,EAGhCD,EAAI,gBAAgB,eACf,IAAI,SAASA,EAAI,KAAMC,CAAI,EAG7B,IAAI,SAAS,KAAMA,CAAI,CAChC,CACF,EAIA,eAAeF,EAAUR,EAAgC,CACvD,IAAMW,EAAcX,EAAI,QAAQ,IAAI,cAAc,GAAK,GAEvD,GAAI,CACF,GAAIW,EAAY,SAAS,kBAAkB,EACzC,OAAO,MAAMX,EAAI,KAAK,EAGxB,GAAIW,EAAY,SAAS,mCAAmC,EAAG,CAC7D,IAAMC,EAAO,MAAMZ,EAAI,KAAK,EAC5B,OAAO,OAAO,YAAY,IAAI,gBAAgBY,CAAI,CAAC,CACrD,CAEA,GAAID,EAAY,SAAS,qBAAqB,EAAG,CAC/C,IAAME,EAAW,MAAMb,EAAI,SAAS,EAC9Bc,EAA+B,CAAC,EACtC,OAAAD,EAAS,QAAQ,CAACR,EAAOC,IAAQ,CAC/BQ,EAAIR,CAAG,EAAID,CACb,CAAC,EACMS,CACT,CAEA,OAAO,MAAMd,EAAI,KAAK,CACxB,MAAQ,CACN,MACF,CACF,CAOO,SAASe,EACdC,EACqC,CACrC,IAAMC,EAASC,EAAcnB,EAAaiB,CAAO,EAEjD,MAAO,OAAOhB,GAAQ,CACpB,GAAI,CACF,OAAQ,MAAMiB,EAAOjB,CAAG,CAC1B,OAASmB,EAAK,CACZ,eAAQ,MAAM,gCAAiCA,CAAG,EAC3C,IAAI,SACT,KAAK,UAAU,CAAE,MAAO,uBAAwB,CAAC,EACjD,CACE,OAAQ,IACR,QAAS,CAAE,eAAgB,kBAAmB,CAChD,CACF,CACF,CACF,CACF,CAmBO,SAASC,EACdJ,EACiF,CACjF,IAAMK,EAAeN,EAAmBC,CAAO,EAE/C,MAAO,OAAOhB,EAAKsB,EAAMC,IAChBF,EAAarB,CAAG,CAE3B,CAOO,SAASwB,EACdR,EACqC,CACrC,OAAOD,EAAmBC,CAAO,CACnC,CAOO,SAASS,EACdT,EACqC,CACrC,OAAOD,EAAmBC,CAAO,CACnC,CAOO,SAASU,EACdV,EACqC,CACrC,OAAOD,EAAmBC,CAAO,CACnC",
  "names": ["edge_exports", "__export", "createBunHandler", "createCfHandler", "createDenoHandler", "createFetchHandler", "createHandler", "createVercelHandler", "edgeAdapter", "__toCommonJS", "createHandler", "adapter", "handler", "platformReq", "platformRes", "req", "response", "edgeAdapter", "req", "fetchReq", "url", "method", "headers", "value", "key", "body", "parseBody", "res", "init", "contentType", "text", "formData", "obj", "createFetchHandler", "handler", "handle", "createHandler", "err", "createCfHandler", "fetchHandler", "_env", "_ctx", "createDenoHandler", "createVercelHandler", "createBunHandler"]
}
