"use strict";var w=Object.create;var u=Object.defineProperty;var h=Object.getOwnPropertyDescriptor;var g=Object.getOwnPropertyNames;var q=Object.getPrototypeOf,A=Object.prototype.hasOwnProperty;var v=(e,t)=>{for(var n in t)u(e,n,{get:t[n],enumerable:!0})},y=(e,t,n,o)=>{if(t&&typeof t=="object"||typeof t=="function")for(let r of g(t))!A.call(e,r)&&r!==n&&u(e,r,{get:()=>t[r],enumerable:!(o=h(t,r))||o.enumerable});return e};var P=(e,t,n)=>(n=e!=null?w(q(e)):{},y(t||!e||!e.__esModule?u(n,"default",{value:e,enumerable:!0}):n,e)),k=e=>y(u({},"__esModule",{value:!0}),e);var M={};v(M,{createHandler:()=>p,createHttpHandler:()=>R,createMiddleware:()=>S,nodeAdapter:()=>m,serve:()=>x});module.exports=k(M);function p(e,t){return async(n,o)=>{let r=await e.toRequest(n),s=await t(r);return e.toResponse(s,o)}}var m={name:"node",async toRequest(e){let t=e,n=t.url||"/",o=t.method||"GET",r={};for(let[d,i]of Object.entries(t.headers))typeof i=="string"?r[d.toLowerCase()]=i:Array.isArray(i)&&(r[d.toLowerCase()]=i.join(", "));let s;["POST","PUT","PATCH"].includes(o)&&(s=await H(t));let c=t.socket?.encrypted?"https":"http",a=r.host||"localhost";return{url:`${c}://${a}${n}`,method:o,headers:r,body:s}},toResponse(e,t){let n=t;n.statusCode=e.status;for(let[o,r]of Object.entries(e.headers))n.setHeader(o,r);return typeof e.body=="string"?n.end(e.body):e.body instanceof ReadableStream?b(e.body,n):n.end(),n}};async function H(e){let t=e.headers["content-type"]||"";return new Promise((n,o)=>{let r=[];e.on("data",s=>{r.push(s)}),e.on("end",()=>{let s=Buffer.concat(r).toString("utf-8");if(!s){n(void 0);return}try{t.includes("application/json")?n(JSON.parse(s)):t.includes("application/x-www-form-urlencoded")?n(Object.fromEntries(new URLSearchParams(s))):n(s)}catch{n(s)}}),e.on("error",o)})}async function b(e,t){let n=e.getReader();try{for(;;){let{done:o,value:r}=await n.read();if(o)break;await new Promise((s,c)=>{t.write(r,a=>{a?c(a):s()})})}}finally{t.end()}}function S(e){let t=p(m,e);return async(n,o,r)=>{try{await t(n,o)}catch{r?r():(o.statusCode=500,o.end("internal server error"))}}}function R(e){let t=p(m,e);return async(n,o)=>{try{await t(n,o)}catch(r){console.error("[tooey/server] request error:",r),o.statusCode=500,o.setHeader("Content-Type","text/plain"),o.end("internal server error")}}}async function x(e,t={}){let{createServer:n}=await import("http"),o=t.port||3e3,r=t.host||"localhost",s=R(e);return new Promise(c=>{let a=n(s);a.listen(o,r,()=>{let l=`http://${r}:${o}`;console.log(`[tooey/server] listening on ${l}`),c({url:l,close:()=>new Promise((d,i)=>{a.close(f=>{f?i(f):d()})})})})})}0&&(module.exports={createHandler,createHttpHandler,createMiddleware,nodeAdapter,serve});
//# sourceMappingURL=node.js.map
