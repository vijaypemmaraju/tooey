"use strict";var tooey=(()=>{var C=Object.defineProperty;var F=Object.getOwnPropertyDescriptor;var q=Object.getOwnPropertyNames;var _=Object.prototype.hasOwnProperty;var G=(t,n)=>{for(var s in n)C(t,s,{get:n[s],enumerable:!0})},K=(t,n,s,r)=>{if(n&&typeof n=="object"||typeof n=="function")for(let a of q(n))!_.call(t,a)&&a!==s&&C(t,a,{get:()=>n[a],enumerable:!(r=F(n,a))||r.enumerable});return t};var X=t=>K(C({},"__esModule",{value:!0}),t);var Ne={};G(Ne,{$:()=>ie,B:()=>le,C:()=>ge,D:()=>ae,G:()=>ce,H:()=>se,I:()=>de,L:()=>Le,Li:()=>ve,M:()=>He,Ol:()=>we,R:()=>ye,S:()=>me,Sv:()=>Me,T:()=>fe,Ta:()=>ue,Tb:()=>be,Tbd:()=>Te,Tc:()=>Se,Td:()=>pe,Th:()=>he,Tr:()=>Ee,Ul:()=>ke,V:()=>oe,batch:()=>U,createTooey:()=>re,effect:()=>p,render:()=>z,signal:()=>O});function J(t){return typeof t=="object"&&t!==null&&"boundary"in t&&t.boundary===!0}function j(t){let n=document.createElement("div");return n.style.cssText="padding:12px;background:#fee;border:1px solid #fcc;border-radius:4px;color:#c00;font-family:monospace;font-size:12px",n.textContent=`[tooey error] ${t.message}`,n}var v=null,M=0,x=new Set;function O(t){let n=t,s=new Set,r=(()=>(v&&s.add(v),n));return r.set=a=>{let c=typeof a=="function"?a(n):a;c!==n&&(n=c,M>0?s.forEach(e=>x.add(e)):s.forEach(e=>e()))},r.sub=a=>(s.add(a),()=>s.delete(a)),r}function U(t){M++;try{t()}finally{if(M--,M===0){let n=x;x=new Set,n.forEach(s=>s())}}}function p(t,n){let s=!0,r=()=>{if(s){v=r;try{t()}finally{v=null}}};r();let a=()=>{s=!1,v=null};return n&&n.cleanups.push(a),a}function W(t,n,s){try{switch(n){case"+":t.set(r=>r+(typeof s=="number"?s:1));break;case"-":t.set(r=>r-(typeof s=="number"?s:1));break;case"!":t.set(s);break;case"~":t.set(r=>!r);break;case"<":t.set(r=>[...r,s]);break;case">":t.set(r=>[s,...r]);break;case"X":t.set(r=>{let a=r;return typeof s=="number"?a.filter((c,e)=>e!==s):typeof s=="function"?a.filter((c,e)=>!s(c,e)):a.filter(c=>c!==s)});break;case".":Array.isArray(s)&&s.length===2&&t.set(r=>({...r,[s[0]]:s[1]}));break}}catch(r){console.warn("[tooey] state operation error:",n,r)}}function N(t){return typeof t=="object"&&t!==null&&!Array.isArray(t)&&"$"in t}function H(t){return typeof t=="object"&&t!==null&&!Array.isArray(t)&&("if"in t||"?"in t)}function L(t){return typeof t=="object"&&t!==null&&!Array.isArray(t)&&("map"in t||"m"in t)}function w(t,n){if(N(t)){let s=n[t.$];if(!s){console.warn(`[tooey] unknown state key: "${t.$}"`);return}return s()}return t}function Q(t){if(t!==void 0)return typeof t=="number"?`${t}px`:t}function Y(t,n){if(!n)return;let s=["colors","spacing","radius","fonts"];for(let r of s){let a=n[r];if(a&&t in a)return a[t]}for(let[r,a]of Object.entries(n))if(a&&!s.includes(r)&&t in a)return a[t]}var Z={c:"center",sb:"space-between",sa:"space-around",se:"space-evenly",fe:"flex-end",fs:"flex-start",st:"stretch",bl:"baseline"};function A(t){if(t!==void 0)return Z[t]||t}function D(t){if(typeof t!="string"||t.length<2)return null;let n=t[t.length-1];if(n==="+"||n==="-"||n==="~")return[t.slice(0,-1),n];let s=t.indexOf("!");if(s>0){let r=t.slice(0,s),a=t.slice(s+1),c=a;return a==="true"?c=!0:a==="false"?c=!1:!isNaN(Number(a))&&a!==""&&(c=Number(a)),[r,"!",c]}return null}var ee=["http:","https:","mailto:","tel:","ftp:"];function ne(t){if(!t||typeof t!="string")return!1;if(t.startsWith("/")||t.startsWith("#")||t.startsWith("."))return!0;try{let n=new URL(t,window.location.href);return ee.includes(n.protocol)}catch{let n=t.toLowerCase().trim();return!["javascript:","data:","vbscript:"].some(r=>n.startsWith(r))}}function P(t,n){return t?ne(t)?t:(console.warn(`[tooey] blocked unsafe URL in ${n}: "${t.slice(0,50)}..."`),null):null}function h(t,n,s,r,a){if(typeof t=="function")return t;let c;if(typeof t=="string"){let d=D(t);d?c=d:a==="+"?c=[t,"+"]:a==="-"?c=[t,"-"]:c=[t,"~"]}else c=t;let[e,l,o]=c;return()=>{let d=n[e];if(!d){console.warn(`[tooey] click handler: unknown state key "${e}"`);return}let m=o;if(r&&typeof m=="string"){if(m==="$index")m=r.index;else if(m==="$item")m=r.item;else if(m.startsWith("$item.")){let i=m.substring(6);m=r.item?.[i]}}if(l==="!"&&o===void 0&&s){let i=s.target;m=i.type==="checkbox"?i.checked:i.value}W(d,l,m)}}function V(t,n){if(t!==void 0){if(typeof t=="string"&&t.startsWith("$")){let s=t.slice(1),r=Y(s,n);if(r!==void 0)return r;console.warn(`[tooey] unknown theme token: "${t}"`);return}return t}}function te(t,n,s){let r=t.style,a=e=>{let l=V(e,s);return Q(l)},c=e=>{if(e===void 0)return;let l=V(e,s);return l!==void 0?String(l):void 0};if(n.g!==void 0){let e=a(n.g);e&&(r.gap=e)}if(n.p!==void 0){let e=a(n.p);e&&(r.padding=e)}if(n.m!==void 0){let e=a(n.m);e&&(r.margin=e)}if(n.w!==void 0){let e=a(n.w);e&&(r.width=e)}if(n.h!==void 0){let e=a(n.h);e&&(r.height=e)}if(n.mw!==void 0){let e=a(n.mw);e&&(r.maxWidth=e)}if(n.mh!==void 0){let e=a(n.mh);e&&(r.maxHeight=e)}if(n.bg!==void 0){let e=c(n.bg);e&&(r.background=e)}if(n.fg!==void 0){let e=c(n.fg);e&&(r.color=e)}if(n.o!==void 0&&(r.opacity=String(n.o)),n.r!==void 0){let e=a(n.r);e&&(r.borderRadius=e)}if(n.bw!==void 0){let e=a(n.bw);e&&(r.borderWidth=e)}if(n.bc!==void 0){let e=c(n.bc);e&&(r.borderColor=e)}if(n.bs!==void 0&&(r.borderStyle=n.bs),n.pos!==void 0){let e={rel:"relative",abs:"absolute",fix:"fixed",sticky:"sticky"};r.position=e[n.pos]||n.pos}if(n.z!==void 0&&(r.zIndex=String(n.z)),n.t!==void 0){let e=a(n.t);e&&(r.top=e)}if(n.l!==void 0){let e=a(n.l);e&&(r.left=e)}if(typeof n.b=="number"||typeof n.b=="string"&&!Array.isArray(n.b)){let e=a(n.b);e&&(r.bottom=e)}if(n.rt!==void 0){let e=a(n.rt);e&&(r.right=e)}if(n.fs!==void 0){let e=a(n.fs);e&&(r.fontSize=e)}if(n.fw!==void 0&&(r.fontWeight=String(n.fw)),n.ff!==void 0){let e=c(n.ff);e&&(r.fontFamily=e)}if(n.ta!==void 0&&(r.textAlign=n.ta),n.td!==void 0&&(r.textDecoration=n.td),n.lh!==void 0&&(r.lineHeight=typeof n.lh=="number"?String(n.lh):n.lh),n.ls!==void 0){let e=a(n.ls);e&&(r.letterSpacing=e)}if(n.ai!==void 0&&(r.alignItems=A(n.ai)),n.jc!==void 0&&(r.justifyContent=A(n.jc)),n.flw!==void 0&&(r.flexWrap=A(n.flw)),n.cur!==void 0&&(r.cursor=n.cur),n.ov!==void 0&&(r.overflow=n.ov),n.pe!==void 0&&(r.pointerEvents=n.pe),n.us!==void 0&&(r.userSelect=n.us),n.sh!==void 0){let e=c(n.sh);e&&(r.boxShadow=e)}n.tr!==void 0&&(r.transform=n.tr),n.s&&Object.entries(n.s).forEach(([e,l])=>{let o=V(l,s);o!==void 0&&(r[e]=String(o))})}function b(t,n,s){let{state:r}=n;if(J(t)){let i=document.createElement("div");i.style.display="contents";try{let f={cleanups:[],state:r,onError:t.onError||n.onError},u=b(t.child,f,s);u&&(i.appendChild(u),n.cleanups.push(...f.cleanups))}catch(f){let u={message:f instanceof Error?f.message:String(f),stack:f instanceof Error?f.stack:void 0};if(t.onError&&t.onError(u),t.fallback)try{let g=b(t.fallback,n,s);g&&i.appendChild(g)}catch{i.appendChild(j(u))}else i.appendChild(j(u))}return i}if(H(t)){let i=document.createElement("div");i.style.display="contents";let f=null,u=null,g=t.if??t["?"],S=t.then??t.t,y=t.else??t.e,T=t.eq??t.is;return p(()=>{u&&(u.cleanups.forEach(R=>R()),u.cleanups=[]),f&&(i.innerHTML="",f=null);let k=typeof g=="string"?r[g]?.():w(g,r),I;T!==void 0?I=k===T:I=!!k;let E=I?S:y;E&&(u={cleanups:[],state:r},Array.isArray(E)&&E.length>0&&Array.isArray(E[0])?E.forEach(R=>{let B=b(R,u,s);B&&i.appendChild(B)}):(f=b(E,u,s),f&&i.appendChild(f)))},n),i}if(L(t)){let i=document.createElement("div");i.style.display="contents";let f=null,u=t.map??t.m,g=t.as??t.a;return p(()=>{f&&(f.cleanups.forEach(T=>T()),f.cleanups=[]),i.innerHTML="";let y=typeof u=="string"?r[u]?.():w(u,r);!Array.isArray(y)||!g||(f={cleanups:[],state:r},y.forEach((T,$)=>{let k=b(g,f,{item:T,index:$});k&&i.appendChild(k)}))},n),i}if(!Array.isArray(t)||t.length===0)return console.warn("[tooey] invalid node spec:",t),null;let[a,c,e={}]=t;if(typeof a=="function"){let i=Array.isArray(c)&&c.length>0&&(Array.isArray(c[0])||H(c[0])||L(c[0])||typeof c[0]=="function")?c:void 0,f=a(e,i);return b(f,n,s)}let l=a,o;switch(l){case"V":o=document.createElement("div"),o.style.display="flex",o.style.flexDirection="column";break;case"H":o=document.createElement("div"),o.style.display="flex",o.style.flexDirection="row";break;case"G":o=document.createElement("div"),o.style.display="grid",e.cols&&(o.style.gridTemplateColumns=typeof e.cols=="number"?`repeat(${e.cols}, 1fr)`:e.cols),e.rows&&(o.style.gridTemplateRows=typeof e.rows=="number"?`repeat(${e.rows}, 1fr)`:e.rows);break;case"D":o=document.createElement("div");break;case"T":o=document.createElement("span");break;case"B":o=document.createElement("button");break;case"I":o=document.createElement("input"),o.type=e.type||"text",e.ph&&(o.placeholder=e.ph),e.ro&&(o.readOnly=!0);break;case"Ta":o=document.createElement("textarea"),e.ph&&(o.placeholder=e.ph),e.rw&&(o.rows=e.rw),e.ro&&(o.readOnly=!0);break;case"S":o=document.createElement("select"),e.opts&&e.opts.forEach(i=>{let f=document.createElement("option");f.value=i.v,f.textContent=i.l,o.appendChild(f)});break;case"C":o=document.createElement("input"),o.type="checkbox";break;case"R":o=document.createElement("input"),o.type="radio";break;case"Tb":o=document.createElement("table");break;case"Th":o=document.createElement("thead");break;case"Tbd":o=document.createElement("tbody");break;case"Tr":o=document.createElement("tr");break;case"Td":o=document.createElement("td"),e.sp&&(o.colSpan=e.sp),e.rsp&&(o.rowSpan=e.rsp);break;case"Tc":o=document.createElement("th"),e.sp&&(o.colSpan=e.sp),e.rsp&&(o.rowSpan=e.rsp);break;case"Ul":o=document.createElement("ul");break;case"Ol":o=document.createElement("ol");break;case"Li":o=document.createElement("li");break;case"M":if(o=document.createElement("img"),e.src){let i=P(e.src,"src");i&&(o.src=i)}e.alt&&(o.alt=e.alt);break;case"L":if(o=document.createElement("a"),e.href){let i=P(e.href,"href");i&&(o.href=i)}break;case"Sv":o=document.createElementNS("http://www.w3.org/2000/svg","svg");break;default:console.warn(`[tooey] unknown component type: ${l}`),o=document.createElement("div")}if(e.cls&&(o.className=e.cls),e.id&&(o.id=e.id),e.dis&&(o.disabled=!0),te(o,e,n.theme),c!==void 0){if(Array.isArray(c)&&c.length>0&&(Array.isArray(c[0])||H(c[0])||L(c[0])))c.forEach(i=>{let f=b(i,n,s);f&&o.appendChild(f)});else if(H(c)||L(c)){let i=b(c,n,s);i&&o.appendChild(i)}else if(N(c))p(()=>{let i=w(c,r);l==="I"||l==="Ta"?o.value=String(i??""):l==="C"||l==="R"?o.checked=!!i:o.textContent=String(i??"")},n);else if(typeof c=="string"||typeof c=="number"){let i=String(c);s&&(typeof s.item=="object"&&s.item!==null&&(i=i.replace(/\$item\.(\w+)/g,(f,u)=>String(s.item[u]??""))),i=i.replace(/\$item/g,String(s.item)),i=i.replace(/\$index/g,String(s.index))),l==="I"||l==="Ta"?o.value=i:l!=="S"&&(o.textContent=i)}}e.v!==void 0&&N(e.v)&&p(()=>{let i=w(e.v,r);l==="I"||l==="S"||l==="Ta"?o.value=String(i??""):(l==="C"||l==="R")&&(o.checked=!!i)},n),e.ch!==void 0&&(N(e.ch)?p(()=>{let i=w(e.ch,r);o.checked=!!i},n):o.checked=!!e.ch);let d=(i,f)=>{o.addEventListener(i,f),n.cleanups.push(()=>o.removeEventListener(i,f))},m=l==="B"&&(typeof c=="string"||typeof c=="number")?String(c):void 0;if(e.c&&d("click",i=>h(e.c,r,i,s,m)()),e.x){let i=e.x;d("input",f=>{if(typeof i=="function")i();else{let u,g;if(typeof i=="string"){let y=D(i);y?[u,g]=y:(u=i,g="!")}else[u,g]=i;let S=r[u];if(S){let y=f.target,T=l==="C"||l==="R"?y.checked:y.value;W(S,g,T)}}})}return e.f&&d("focus",i=>h(e.f,r,i,s)()),e.bl&&d("blur",i=>h(e.bl,r,i,s)()),e.k&&d("keydown",i=>h(e.k,r,i,s)()),e.ku&&d("keyup",i=>h(e.ku,r,i,s)()),e.kp&&d("keypress",i=>h(e.kp,r,i,s)()),e.e&&d("mouseenter",i=>h(e.e,r,i,s)()),e.lv&&d("mouseleave",i=>h(e.lv,r,i,s)()),e.sub&&d("submit",i=>{i.preventDefault(),h(e.sub,r,i,s)()}),o}function z(t,n,s){if(!t)throw new Error("[tooey] render requires a valid container element");if(!n||!n.r)throw new Error("[tooey] render requires a spec with a root node (r)");let r=s?.theme,a={};n.s&&Object.entries(n.s).forEach(([o,d])=>{a[o]=O(d)});let c={cleanups:[],state:a,theme:r};t.innerHTML="";let e=b(n.r,c);e&&t.appendChild(e);let l={state:a,el:e,destroy(){c.cleanups.forEach(o=>o()),c.cleanups=[],t.innerHTML=""},update(o){if(o.s&&U(()=>{Object.entries(o.s).forEach(([d,m])=>{a[d]?a[d].set(m):a[d]=O(m)})}),o.r){c.cleanups.forEach(m=>m()),c.cleanups=[],t.innerHTML="";let d=b(o.r,c);d&&t.appendChild(d),l.el=d}},get(o){return a[o]?.()},set(o,d){a[o]&&a[o].set(d)}};return l}function re(t){return{render:(n,s)=>z(n,s,{theme:t}),theme:t}}function ie(t){return{$:t}}var oe="V",se="H",ae="D",ce="G",fe="T",le="B",de="I",ue="Ta",me="S",ge="C",ye="R",be="Tb",he="Th",Te="Tbd",Ee="Tr",pe="Td",Se="Tc",ke="Ul",we="Ol",ve="Li",He="M",Le="L",Me="Sv";return X(Ne);})();
if(typeof module!=="undefined")module.exports=tooey;
//# sourceMappingURL=tooey.js.map
