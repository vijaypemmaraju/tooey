"use strict";var tooey=(()=>{var $=Object.defineProperty;var F=Object.getOwnPropertyDescriptor;var G=Object.getOwnPropertyNames;var K=Object.prototype.hasOwnProperty;var X=(n,e)=>{for(var i in e)$(n,i,{get:e[i],enumerable:!0})},J=(n,e,i,r)=>{if(e&&typeof e=="object"||typeof e=="function")for(let c of G(e))!K.call(n,c)&&c!==i&&$(n,c,{get:()=>e[c],enumerable:!(r=F(e,c))||r.enumerable});return n};var Q=n=>J($({},"__esModule",{value:!0}),n);var Ie={};X(Ie,{$:()=>ae,B:()=>ge,C:()=>be,D:()=>ue,G:()=>de,H:()=>le,I:()=>me,L:()=>Ne,Li:()=>Me,M:()=>Ce,Ol:()=>Le,R:()=>Te,S:()=>he,Sv:()=>Re,T:()=>fe,Ta:()=>ye,Tb:()=>pe,Tbd:()=>Se,Tc:()=>ve,Td:()=>ke,Th:()=>Ee,Tr:()=>we,Ul:()=>He,V:()=>ce,async$:()=>Z,batch:()=>U,computed:()=>Y,createTooey:()=>se,effect:()=>k,render:()=>q,signal:()=>W});function P(n){return typeof n=="object"&&n!==null&&"boundary"in n&&n.boundary===!0}function j(n){let e=document.createElement("div");return e.style.cssText="padding:12px;background:#fee;border:1px solid #fcc;border-radius:4px;color:#c00;font-family:monospace;font-size:12px",e.textContent=`[tooey error] ${n.message}`,e}var T=null,L=0,I=new Set;function W(n){let e=n,i=new Set,r=(()=>(T&&i.add(T),e));return r.set=c=>{let d=typeof c=="function"?c(e):c;d!==e&&(e=d,L>0?i.forEach(t=>I.add(t)):i.forEach(t=>t()))},r.sub=c=>(i.add(c),()=>i.delete(c)),r}function U(n){L++;try{n()}finally{if(L--,L===0){let e=I;I=new Set,e.forEach(i=>i())}}}function k(n,e){let i=!0,r=()=>{if(i){T=r;try{n()}finally{T=null}}};r();let c=()=>{i=!1,T=null};return e&&e.cleanups.push(c),c}function Y(n){let e,i=!0,r=new Set,c=()=>{i=!0,L>0?r.forEach(t=>I.add(t)):r.forEach(t=>t())},d=(()=>{if(T&&r.add(T),i){let t=T;T=c;try{e=n()}finally{T=t}i=!1}return e});return d.sub=t=>(r.add(t),()=>r.delete(t)),d}function Z(n,e){return{s:{data:null,loading:!0,error:null},async init(i){try{let c=await(typeof n=="function"?n():n);i.set("data",c),i.set("loading",!1)}catch(r){let c=r instanceof Error?r.message:String(r);i.set("error",c),i.set("loading",!1),e?.onError&&r instanceof Error&&e.onError(r)}}}}function z(n,e,i){try{switch(e){case"+":n.set(r=>r+(typeof i=="number"?i:1));break;case"-":n.set(r=>r-(typeof i=="number"?i:1));break;case"!":n.set(i);break;case"~":n.set(r=>!r);break;case"<":n.set(r=>[...r,i]);break;case">":n.set(r=>[i,...r]);break;case"X":n.set(r=>{let c=r;return typeof i=="number"?c.filter((d,t)=>t!==i):typeof i=="function"?c.filter((d,t)=>!i(d,t)):c.filter(d=>d!==i)});break;case".":Array.isArray(i)&&i.length===2&&n.set(r=>({...r,[i[0]]:i[1]}));break}}catch(r){console.warn("[tooey] state operation error:",e,r)}}function R(n){return typeof n=="object"&&n!==null&&!Array.isArray(n)&&"$"in n}function C(n){return typeof n=="object"&&n!==null&&!Array.isArray(n)&&("if"in n||"?"in n)}function N(n){return typeof n=="object"&&n!==null&&!Array.isArray(n)&&("map"in n||"m"in n)}function H(n,e){if(R(n)){let i=e[n.$];if(!i){console.warn(`[tooey] unknown state key: "${n.$}"`);return}return i()}return n}function ee(n){if(n!==void 0)return typeof n=="number"?`${n}px`:n}function ne(n,e){if(!e)return;let i=["colors","spacing","radius","fonts"];for(let r of i){let c=e[r];if(c&&n in c)return c[n]}for(let[r,c]of Object.entries(e))if(c&&!i.includes(r)&&n in c)return c[n]}var te={c:"center",sb:"space-between",sa:"space-around",se:"space-evenly",fe:"flex-end",fs:"flex-start",st:"stretch",bl:"baseline"};function x(n){if(n!==void 0)return te[n]||n}function _(n){if(typeof n!="string"||n.length<2)return null;let e=n[n.length-1];if(e==="+"||e==="-"||e==="~")return[n.slice(0,-1),e];let i=n.indexOf("!");if(i>0){let r=n.slice(0,i),c=n.slice(i+1),d=c;return c==="true"?d=!0:c==="false"?d=!1:!isNaN(Number(c))&&c!==""&&(d=Number(c)),[r,"!",d]}return null}var re=["http:","https:","mailto:","tel:","ftp:"];function oe(n){if(!n||typeof n!="string")return!1;if(n.startsWith("/")||n.startsWith("#")||n.startsWith("."))return!0;try{let e=new URL(n,window.location.href);return re.includes(e.protocol)}catch{let e=n.toLowerCase().trim();return!["javascript:","data:","vbscript:"].some(r=>e.startsWith(r))}}function D(n,e){return n?oe(n)?n:(console.warn(`[tooey] blocked unsafe URL in ${e}: "${n.slice(0,50)}..."`),null):null}function S(n,e,i,r,c){if(typeof n=="function")return n;let d;if(typeof n=="string"){let a=_(n);a?d=a:c==="+"?d=[n,"+"]:c==="-"?d=[n,"-"]:d=[n,"~"]}else d=n;let[t,s,g]=d;return()=>{let a=e[t];if(!a){console.warn(`[tooey] click handler: unknown state key "${t}"`);return}let l=g;if(r&&typeof l=="string"){if(l==="$index")l=r.index;else if(l==="$item")l=r.item;else if(l.startsWith("$item.")){let m=l.substring(6);l=r.item?.[m]}}if(s==="!"&&g===void 0&&i){let m=i.target;l=m.type==="checkbox"?m.checked:m.value}z(a,s,l)}}function B(n,e){if(n!==void 0){if(typeof n=="string"&&n.startsWith("$")){let i=n.slice(1),r=ne(i,e);if(r!==void 0)return r;console.warn(`[tooey] unknown theme token: "${n}"`);return}return n}}function ie(n,e,i){let r=n.style,c=t=>{let s=B(t,i);return ee(s)},d=t=>{if(t===void 0)return;let s=B(t,i);return s!==void 0?String(s):void 0};if(e.g!==void 0){let t=c(e.g);t&&(r.gap=t)}if(e.p!==void 0){let t=c(e.p);t&&(r.padding=t)}if(e.m!==void 0){let t=c(e.m);t&&(r.margin=t)}if(e.w!==void 0){let t=c(e.w);t&&(r.width=t)}if(e.h!==void 0){let t=c(e.h);t&&(r.height=t)}if(e.mw!==void 0){let t=c(e.mw);t&&(r.maxWidth=t)}if(e.mh!==void 0){let t=c(e.mh);t&&(r.maxHeight=t)}if(e.bg!==void 0){let t=d(e.bg);t&&(r.background=t)}if(e.fg!==void 0){let t=d(e.fg);t&&(r.color=t)}if(e.o!==void 0&&(r.opacity=String(e.o)),e.r!==void 0){let t=c(e.r);t&&(r.borderRadius=t)}if(e.bw!==void 0){let t=c(e.bw);t&&(r.borderWidth=t)}if(e.bc!==void 0){let t=d(e.bc);t&&(r.borderColor=t)}if(e.bs!==void 0&&(r.borderStyle=e.bs),e.pos!==void 0){let t={rel:"relative",abs:"absolute",fix:"fixed",sticky:"sticky"};r.position=t[e.pos]||e.pos}if(e.z!==void 0&&(r.zIndex=String(e.z)),e.t!==void 0){let t=c(e.t);t&&(r.top=t)}if(e.l!==void 0){let t=c(e.l);t&&(r.left=t)}if(typeof e.b=="number"||typeof e.b=="string"&&!Array.isArray(e.b)){let t=c(e.b);t&&(r.bottom=t)}if(e.rt!==void 0){let t=c(e.rt);t&&(r.right=t)}if(e.fs!==void 0){let t=c(e.fs);t&&(r.fontSize=t)}if(e.fw!==void 0&&(r.fontWeight=String(e.fw)),e.ff!==void 0){let t=d(e.ff);t&&(r.fontFamily=t)}if(e.ta!==void 0&&(r.textAlign=e.ta),e.td!==void 0&&(r.textDecoration=e.td),e.lh!==void 0&&(r.lineHeight=typeof e.lh=="number"?String(e.lh):e.lh),e.ls!==void 0){let t=c(e.ls);t&&(r.letterSpacing=t)}if(e.ai!==void 0&&(r.alignItems=x(e.ai)),e.jc!==void 0&&(r.justifyContent=x(e.jc)),e.flw!==void 0&&(r.flexWrap=x(e.flw)),e.cur!==void 0&&(r.cursor=e.cur),e.ov!==void 0&&(r.overflow=e.ov),e.pe!==void 0&&(r.pointerEvents=e.pe),e.us!==void 0&&(r.userSelect=e.us),e.sh!==void 0){let t=d(e.sh);t&&(r.boxShadow=t)}e.tr!==void 0&&(r.transform=e.tr),e.s&&Object.entries(e.s).forEach(([t,s])=>{let g=B(s,i);g!==void 0&&(r[t]=String(g))})}function b(n,e,i){let{state:r}=e;if(P(n)){let o=document.createElement("div");o.style.display="contents";try{let u={cleanups:[],state:r,onError:n.onError||e.onError},f=b(n.child,u,i);f&&(o.appendChild(f),e.cleanups.push(...u.cleanups))}catch(u){let f={message:u instanceof Error?u.message:String(u),stack:u instanceof Error?u.stack:void 0};if(n.onError&&n.onError(f),n.fallback)try{let y=b(n.fallback,e,i);y&&o.appendChild(y)}catch{o.appendChild(j(f))}else o.appendChild(j(f))}return o}if(C(n)){let o=document.createElement("div");o.style.display="contents";let u=null,f=null,y=n.if??n["?"],p=n.then??n.t,h=n.else??n.e,E=n.eq??n.is;return k(()=>{f&&(f.cleanups.forEach(V=>V()),f.cleanups=[]),u&&(o.innerHTML="",u=null);let w=typeof y=="string"?r[y]?.():H(y,r),A;E!==void 0?A=w===E:A=!!w;let v=A?p:h;v&&(f={cleanups:[],state:r},Array.isArray(v)&&v.length>0&&Array.isArray(v[0])?v.forEach(V=>{let O=b(V,f,i);O&&o.appendChild(O)}):(u=b(v,f,i),u&&o.appendChild(u)))},e),o}if(N(n)){let o=document.createElement("div");o.style.display="contents";let u=null,f=n.map??n.m,y=n.as??n.a;return k(()=>{u&&(u.cleanups.forEach(E=>E()),u.cleanups=[]),o.innerHTML="";let h=typeof f=="string"?r[f]?.():H(f,r);!Array.isArray(h)||!y||(u={cleanups:[],state:r},h.forEach((E,M)=>{let w=b(y,u,{item:E,index:M});w&&o.appendChild(w)}))},e),o}if(!Array.isArray(n)||n.length===0)return console.warn("[tooey] invalid node spec:",n),null;let c=n;if(e.plugins)for(let o of e.plugins)o.beforeRender&&(c=o.beforeRender(c,e));if(!Array.isArray(c))return b(c,e,i);let[d,t,s={}]=c;if(typeof d=="function"){let o=Array.isArray(t)&&t.length>0&&(Array.isArray(t[0])||C(t[0])||N(t[0])||typeof t[0]=="function")?t:void 0,u=d(s,o);return b(u,e,i)}let g=d;if(s.show!==void 0){let o=s.show,u=document.createElement("div");u.style.display="contents";let f=null,y=null;return k(()=>{if(y&&(y.cleanups.forEach(w=>w()),y.cleanups=[]),f&&(u.innerHTML="",f=null),!r[o]?.())return;let{show:E,...M}=s;y={cleanups:[],state:r,theme:e.theme,plugins:e.plugins},f=b([g,t,M],y,i),f&&(u.appendChild(f),e.cleanups.push(...y.cleanups))},e),u}let a;switch(g){case"V":a=document.createElement("div"),a.style.display="flex",a.style.flexDirection="column";break;case"H":a=document.createElement("div"),a.style.display="flex",a.style.flexDirection="row";break;case"G":a=document.createElement("div"),a.style.display="grid",s.cols&&(a.style.gridTemplateColumns=typeof s.cols=="number"?`repeat(${s.cols}, 1fr)`:s.cols),s.rows&&(a.style.gridTemplateRows=typeof s.rows=="number"?`repeat(${s.rows}, 1fr)`:s.rows);break;case"D":a=document.createElement("div");break;case"T":a=document.createElement("span");break;case"B":a=document.createElement("button");break;case"I":a=document.createElement("input"),a.type=s.type||"text",s.ph&&(a.placeholder=s.ph),s.ro&&(a.readOnly=!0);break;case"Ta":a=document.createElement("textarea"),s.ph&&(a.placeholder=s.ph),s.rw&&(a.rows=s.rw),s.ro&&(a.readOnly=!0);break;case"S":a=document.createElement("select"),s.opts&&s.opts.forEach(o=>{let u=document.createElement("option");u.value=o.v,u.textContent=o.l,a.appendChild(u)});break;case"C":a=document.createElement("input"),a.type="checkbox";break;case"R":a=document.createElement("input"),a.type="radio";break;case"Tb":a=document.createElement("table");break;case"Th":a=document.createElement("thead");break;case"Tbd":a=document.createElement("tbody");break;case"Tr":a=document.createElement("tr");break;case"Td":a=document.createElement("td"),s.sp&&(a.colSpan=s.sp),s.rsp&&(a.rowSpan=s.rsp);break;case"Tc":a=document.createElement("th"),s.sp&&(a.colSpan=s.sp),s.rsp&&(a.rowSpan=s.rsp);break;case"Ul":a=document.createElement("ul");break;case"Ol":a=document.createElement("ol");break;case"Li":a=document.createElement("li");break;case"M":if(a=document.createElement("img"),s.src){let o=D(s.src,"src");o&&(a.src=o)}s.alt&&(a.alt=s.alt);break;case"L":if(a=document.createElement("a"),s.href){let o=D(s.href,"href");o&&(a.href=o)}break;case"Sv":a=document.createElementNS("http://www.w3.org/2000/svg","svg");break;default:console.warn(`[tooey] unknown component type: ${g}`),a=document.createElement("div")}if(s.cls&&(a.className=s.cls),s.id&&(a.id=s.id),s.dis&&(a.disabled=!0),ie(a,s,e.theme),t!==void 0){if(Array.isArray(t)&&t.length>0&&(Array.isArray(t[0])||C(t[0])||N(t[0])||P(t[0])))t.forEach(o=>{let u=b(o,e,i);u&&a.appendChild(u)});else if(C(t)||N(t)||P(t)){let o=b(t,e,i);o&&a.appendChild(o)}else if(R(t))k(()=>{let o=H(t,r);g==="I"||g==="Ta"?a.value=String(o??""):g==="C"||g==="R"?a.checked=!!o:a.textContent=String(o??"")},e);else if(typeof t=="string"||typeof t=="number"){let o=String(t);i&&(typeof i.item=="object"&&i.item!==null&&(o=o.replace(/\$item\.(\w+)/g,(u,f)=>String(i.item[f]??""))),o=o.replace(/\$item/g,String(i.item)),o=o.replace(/\$index/g,String(i.index))),g==="I"||g==="Ta"?a.value=o:g!=="S"&&(a.textContent=o)}}s.v!==void 0&&R(s.v)&&k(()=>{let o=H(s.v,r);g==="I"||g==="S"||g==="Ta"?a.value=String(o??""):(g==="C"||g==="R")&&(a.checked=!!o)},e),s.ch!==void 0&&(R(s.ch)?k(()=>{let o=H(s.ch,r);a.checked=!!o},e):a.checked=!!s.ch);let l=(o,u)=>{a.addEventListener(o,u),e.cleanups.push(()=>a.removeEventListener(o,u))},m=g==="B"&&(typeof t=="string"||typeof t=="number")?String(t):void 0;if(s.c&&l("click",o=>S(s.c,r,o,i,m)()),s.x){let o=s.x;l("input",u=>{if(typeof o=="function")o();else{let f,y;if(typeof o=="string"){let h=_(o);h?[f,y]=h:(f=o,y="!")}else[f,y]=o;let p=r[f];if(p){let h=u.target,E=g==="C"||g==="R"?h.checked:h.value;z(p,y,E)}}})}if(s.f&&l("focus",o=>S(s.f,r,o,i)()),s.bl&&l("blur",o=>S(s.bl,r,o,i)()),s.k&&l("keydown",o=>S(s.k,r,o,i)()),s.ku&&l("keyup",o=>S(s.ku,r,o,i)()),s.kp&&l("keypress",o=>S(s.kp,r,o,i)()),s.e&&l("mouseenter",o=>S(s.e,r,o,i)()),s.lv&&l("mouseleave",o=>S(s.lv,r,o,i)()),s.sub&&l("submit",o=>{o.preventDefault(),S(s.sub,r,o,i)()}),e.plugins)for(let o of e.plugins)o.afterRender&&o.afterRender(a,c);return a}function q(n,e,i){if(!n)throw new Error("[tooey] render requires a valid container element");if(!e||!e.r)throw new Error("[tooey] render requires a spec with a root node (r)");let r=i?.theme,c=i?.plugins||[],d=(l,m)=>{let o=W(m),u=o.set.bind(o);return o.set=f=>{let y=o();u(f);let p=o();y!==p&&c.forEach(h=>h.onStateChange?.(l,y,p))},o},t={};e.s&&Object.entries(e.s).forEach(([l,m])=>{t[l]=d(l,m)});let s={cleanups:[],state:t,theme:r,plugins:c};n.innerHTML="";let g=b(e.r,s);g&&n.appendChild(g);let a={state:t,el:g,destroy(){c.forEach(l=>l.onDestroy?.(a)),s.cleanups.forEach(l=>l()),s.cleanups=[],n.innerHTML=""},update(l){if(l.s&&U(()=>{Object.entries(l.s).forEach(([m,o])=>{t[m]?t[m].set(o):t[m]=d(m,o)})}),l.r){s.cleanups.forEach(o=>o()),s.cleanups=[],n.innerHTML="";let m=b(l.r,s);m&&n.appendChild(m),a.el=m}},get(l){return t[l]?.()},set(l,m){t[l]&&t[l].set(m)}};return c.forEach(l=>{l.extend&&Object.entries(l.extend).forEach(([m,o])=>{a[m]=o.bind(a)})}),c.forEach(l=>l.onInit?.(a)),a}function se(n){let e=n&&("theme"in n||"plugins"in n),i=e?n.theme:n,r=e?n.plugins:void 0;return{render:(c,d)=>q(c,d,{theme:i,plugins:r}),theme:i,plugins:r}}function ae(n){return{$:n}}var ce="V",le="H",ue="D",de="G",fe="T",ge="B",me="I",ye="Ta",he="S",be="C",Te="R",pe="Tb",Ee="Th",Se="Tbd",we="Tr",ke="Td",ve="Tc",He="Ul",Le="Ol",Me="Li",Ce="M",Ne="L",Re="Sv";return Q(Ie);})();
if(typeof module!=="undefined")module.exports=tooey;
//# sourceMappingURL=tooey.js.map
