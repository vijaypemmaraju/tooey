"use strict";var tooey=(()=>{var A=Object.defineProperty;var q=Object.getOwnPropertyDescriptor;var _=Object.getOwnPropertyNames;var G=Object.prototype.hasOwnProperty;var K=(n,e)=>{for(var s in e)A(n,s,{get:e[s],enumerable:!0})},X=(n,e,s,r)=>{if(e&&typeof e=="object"||typeof e=="function")for(let c of _(e))!G.call(n,c)&&c!==s&&A(n,c,{get:()=>e[c],enumerable:!(r=q(e,c))||r.enumerable});return n};var J=n=>X(A({},"__esModule",{value:!0}),n);var Re={};K(Re,{$:()=>oe,B:()=>de,C:()=>ye,D:()=>ce,G:()=>le,H:()=>ae,I:()=>ue,L:()=>Me,Li:()=>He,M:()=>Le,Ol:()=>ve,R:()=>be,S:()=>me,Sv:()=>Ne,T:()=>fe,Ta:()=>ge,Tb:()=>he,Tbd:()=>pe,Tc:()=>ke,Td:()=>Se,Th:()=>Te,Tr:()=>Ee,Ul:()=>we,V:()=>se,batch:()=>U,createTooey:()=>ie,effect:()=>k,render:()=>F,signal:()=>D});function Q(n){return typeof n=="object"&&n!==null&&"boundary"in n&&n.boundary===!0}function P(n){let e=document.createElement("div");return e.style.cssText="padding:12px;background:#fee;border:1px solid #fcc;border-radius:4px;color:#c00;font-family:monospace;font-size:12px",e.textContent=`[tooey error] ${n.message}`,e}var H=null,N=0,$=new Set;function D(n){let e=n,s=new Set,r=(()=>(H&&s.add(H),e));return r.set=c=>{let d=typeof c=="function"?c(e):c;d!==e&&(e=d,N>0?s.forEach(t=>$.add(t)):s.forEach(t=>t()))},r.sub=c=>(s.add(c),()=>s.delete(c)),r}function U(n){N++;try{n()}finally{if(N--,N===0){let e=$;$=new Set,e.forEach(s=>s())}}}function k(n,e){let s=!0,r=()=>{if(s){H=r;try{n()}finally{H=null}}};r();let c=()=>{s=!1,H=null};return e&&e.cleanups.push(c),c}function W(n,e,s){try{switch(e){case"+":n.set(r=>r+(typeof s=="number"?s:1));break;case"-":n.set(r=>r-(typeof s=="number"?s:1));break;case"!":n.set(s);break;case"~":n.set(r=>!r);break;case"<":n.set(r=>[...r,s]);break;case">":n.set(r=>[s,...r]);break;case"X":n.set(r=>{let c=r;return typeof s=="number"?c.filter((d,t)=>t!==s):typeof s=="function"?c.filter((d,t)=>!s(d,t)):c.filter(d=>d!==s)});break;case".":Array.isArray(s)&&s.length===2&&n.set(r=>({...r,[s[0]]:s[1]}));break}}catch(r){console.warn("[tooey] state operation error:",e,r)}}function R(n){return typeof n=="object"&&n!==null&&!Array.isArray(n)&&"$"in n}function L(n){return typeof n=="object"&&n!==null&&!Array.isArray(n)&&("if"in n||"?"in n)}function M(n){return typeof n=="object"&&n!==null&&!Array.isArray(n)&&("map"in n||"m"in n)}function v(n,e){if(R(n)){let s=e[n.$];if(!s){console.warn(`[tooey] unknown state key: "${n.$}"`);return}return s()}return n}function Y(n){if(n!==void 0)return typeof n=="number"?`${n}px`:n}function Z(n,e){if(!e)return;let s=["colors","spacing","radius","fonts"];for(let r of s){let c=e[r];if(c&&n in c)return c[n]}for(let[r,c]of Object.entries(e))if(c&&!s.includes(r)&&n in c)return c[n]}var ee={c:"center",sb:"space-between",sa:"space-around",se:"space-evenly",fe:"flex-end",fs:"flex-start",st:"stretch",bl:"baseline"};function V(n){if(n!==void 0)return ee[n]||n}function z(n){if(typeof n!="string"||n.length<2)return null;let e=n[n.length-1];if(e==="+"||e==="-"||e==="~")return[n.slice(0,-1),e];let s=n.indexOf("!");if(s>0){let r=n.slice(0,s),c=n.slice(s+1),d=c;return c==="true"?d=!0:c==="false"?d=!1:!isNaN(Number(c))&&c!==""&&(d=Number(c)),[r,"!",d]}return null}var ne=["http:","https:","mailto:","tel:","ftp:"];function te(n){if(!n||typeof n!="string")return!1;if(n.startsWith("/")||n.startsWith("#")||n.startsWith("."))return!0;try{let e=new URL(n,window.location.href);return ne.includes(e.protocol)}catch{let e=n.toLowerCase().trim();return!["javascript:","data:","vbscript:"].some(r=>e.startsWith(r))}}function j(n,e){return n?te(n)?n:(console.warn(`[tooey] blocked unsafe URL in ${e}: "${n.slice(0,50)}..."`),null):null}function T(n,e,s,r,c){if(typeof n=="function")return n;let d;if(typeof n=="string"){let a=z(n);a?d=a:c==="+"?d=[n,"+"]:c==="-"?d=[n,"-"]:d=[n,"~"]}else d=n;let[t,o,u]=d;return()=>{let a=e[t];if(!a){console.warn(`[tooey] click handler: unknown state key "${t}"`);return}let l=u;if(r&&typeof l=="string"){if(l==="$index")l=r.index;else if(l==="$item")l=r.item;else if(l.startsWith("$item.")){let m=l.substring(6);l=r.item?.[m]}}if(o==="!"&&u===void 0&&s){let m=s.target;l=m.type==="checkbox"?m.checked:m.value}W(a,o,l)}}function x(n,e){if(n!==void 0){if(typeof n=="string"&&n.startsWith("$")){let s=n.slice(1),r=Z(s,e);if(r!==void 0)return r;console.warn(`[tooey] unknown theme token: "${n}"`);return}return n}}function re(n,e,s){let r=n.style,c=t=>{let o=x(t,s);return Y(o)},d=t=>{if(t===void 0)return;let o=x(t,s);return o!==void 0?String(o):void 0};if(e.g!==void 0){let t=c(e.g);t&&(r.gap=t)}if(e.p!==void 0){let t=c(e.p);t&&(r.padding=t)}if(e.m!==void 0){let t=c(e.m);t&&(r.margin=t)}if(e.w!==void 0){let t=c(e.w);t&&(r.width=t)}if(e.h!==void 0){let t=c(e.h);t&&(r.height=t)}if(e.mw!==void 0){let t=c(e.mw);t&&(r.maxWidth=t)}if(e.mh!==void 0){let t=c(e.mh);t&&(r.maxHeight=t)}if(e.bg!==void 0){let t=d(e.bg);t&&(r.background=t)}if(e.fg!==void 0){let t=d(e.fg);t&&(r.color=t)}if(e.o!==void 0&&(r.opacity=String(e.o)),e.r!==void 0){let t=c(e.r);t&&(r.borderRadius=t)}if(e.bw!==void 0){let t=c(e.bw);t&&(r.borderWidth=t)}if(e.bc!==void 0){let t=d(e.bc);t&&(r.borderColor=t)}if(e.bs!==void 0&&(r.borderStyle=e.bs),e.pos!==void 0){let t={rel:"relative",abs:"absolute",fix:"fixed",sticky:"sticky"};r.position=t[e.pos]||e.pos}if(e.z!==void 0&&(r.zIndex=String(e.z)),e.t!==void 0){let t=c(e.t);t&&(r.top=t)}if(e.l!==void 0){let t=c(e.l);t&&(r.left=t)}if(typeof e.b=="number"||typeof e.b=="string"&&!Array.isArray(e.b)){let t=c(e.b);t&&(r.bottom=t)}if(e.rt!==void 0){let t=c(e.rt);t&&(r.right=t)}if(e.fs!==void 0){let t=c(e.fs);t&&(r.fontSize=t)}if(e.fw!==void 0&&(r.fontWeight=String(e.fw)),e.ff!==void 0){let t=d(e.ff);t&&(r.fontFamily=t)}if(e.ta!==void 0&&(r.textAlign=e.ta),e.td!==void 0&&(r.textDecoration=e.td),e.lh!==void 0&&(r.lineHeight=typeof e.lh=="number"?String(e.lh):e.lh),e.ls!==void 0){let t=c(e.ls);t&&(r.letterSpacing=t)}if(e.ai!==void 0&&(r.alignItems=V(e.ai)),e.jc!==void 0&&(r.justifyContent=V(e.jc)),e.flw!==void 0&&(r.flexWrap=V(e.flw)),e.cur!==void 0&&(r.cursor=e.cur),e.ov!==void 0&&(r.overflow=e.ov),e.pe!==void 0&&(r.pointerEvents=e.pe),e.us!==void 0&&(r.userSelect=e.us),e.sh!==void 0){let t=d(e.sh);t&&(r.boxShadow=t)}e.tr!==void 0&&(r.transform=e.tr),e.s&&Object.entries(e.s).forEach(([t,o])=>{let u=x(o,s);u!==void 0&&(r[t]=String(u))})}function h(n,e,s){let{state:r}=e;if(Q(n)){let i=document.createElement("div");i.style.display="contents";try{let f={cleanups:[],state:r,onError:n.onError||e.onError},g=h(n.child,f,s);g&&(i.appendChild(g),e.cleanups.push(...f.cleanups))}catch(f){let g={message:f instanceof Error?f.message:String(f),stack:f instanceof Error?f.stack:void 0};if(n.onError&&n.onError(g),n.fallback)try{let y=h(n.fallback,e,s);y&&i.appendChild(y)}catch{i.appendChild(P(g))}else i.appendChild(P(g))}return i}if(L(n)){let i=document.createElement("div");i.style.display="contents";let f=null,g=null,y=n.if??n["?"],p=n.then??n.t,b=n.else??n.e,E=n.eq??n.is;return k(()=>{g&&(g.cleanups.forEach(C=>C()),g.cleanups=[]),f&&(i.innerHTML="",f=null);let w=typeof y=="string"?r[y]?.():v(y,r),I;E!==void 0?I=w===E:I=!!w;let S=I?p:b;S&&(g={cleanups:[],state:r},Array.isArray(S)&&S.length>0&&Array.isArray(S[0])?S.forEach(C=>{let B=h(C,g,s);B&&i.appendChild(B)}):(f=h(S,g,s),f&&i.appendChild(f)))},e),i}if(M(n)){let i=document.createElement("div");i.style.display="contents";let f=null,g=n.map??n.m,y=n.as??n.a;return k(()=>{f&&(f.cleanups.forEach(E=>E()),f.cleanups=[]),i.innerHTML="";let b=typeof g=="string"?r[g]?.():v(g,r);!Array.isArray(b)||!y||(f={cleanups:[],state:r},b.forEach((E,O)=>{let w=h(y,f,{item:E,index:O});w&&i.appendChild(w)}))},e),i}if(!Array.isArray(n)||n.length===0)return console.warn("[tooey] invalid node spec:",n),null;let c=n;if(e.plugins)for(let i of e.plugins)i.beforeRender&&(c=i.beforeRender(c,e));if(!Array.isArray(c))return h(c,e,s);let[d,t,o={}]=c;if(typeof d=="function"){let i=Array.isArray(t)&&t.length>0&&(Array.isArray(t[0])||L(t[0])||M(t[0])||typeof t[0]=="function")?t:void 0,f=d(o,i);return h(f,e,s)}let u=d,a;switch(u){case"V":a=document.createElement("div"),a.style.display="flex",a.style.flexDirection="column";break;case"H":a=document.createElement("div"),a.style.display="flex",a.style.flexDirection="row";break;case"G":a=document.createElement("div"),a.style.display="grid",o.cols&&(a.style.gridTemplateColumns=typeof o.cols=="number"?`repeat(${o.cols}, 1fr)`:o.cols),o.rows&&(a.style.gridTemplateRows=typeof o.rows=="number"?`repeat(${o.rows}, 1fr)`:o.rows);break;case"D":a=document.createElement("div");break;case"T":a=document.createElement("span");break;case"B":a=document.createElement("button");break;case"I":a=document.createElement("input"),a.type=o.type||"text",o.ph&&(a.placeholder=o.ph),o.ro&&(a.readOnly=!0);break;case"Ta":a=document.createElement("textarea"),o.ph&&(a.placeholder=o.ph),o.rw&&(a.rows=o.rw),o.ro&&(a.readOnly=!0);break;case"S":a=document.createElement("select"),o.opts&&o.opts.forEach(i=>{let f=document.createElement("option");f.value=i.v,f.textContent=i.l,a.appendChild(f)});break;case"C":a=document.createElement("input"),a.type="checkbox";break;case"R":a=document.createElement("input"),a.type="radio";break;case"Tb":a=document.createElement("table");break;case"Th":a=document.createElement("thead");break;case"Tbd":a=document.createElement("tbody");break;case"Tr":a=document.createElement("tr");break;case"Td":a=document.createElement("td"),o.sp&&(a.colSpan=o.sp),o.rsp&&(a.rowSpan=o.rsp);break;case"Tc":a=document.createElement("th"),o.sp&&(a.colSpan=o.sp),o.rsp&&(a.rowSpan=o.rsp);break;case"Ul":a=document.createElement("ul");break;case"Ol":a=document.createElement("ol");break;case"Li":a=document.createElement("li");break;case"M":if(a=document.createElement("img"),o.src){let i=j(o.src,"src");i&&(a.src=i)}o.alt&&(a.alt=o.alt);break;case"L":if(a=document.createElement("a"),o.href){let i=j(o.href,"href");i&&(a.href=i)}break;case"Sv":a=document.createElementNS("http://www.w3.org/2000/svg","svg");break;default:console.warn(`[tooey] unknown component type: ${u}`),a=document.createElement("div")}if(o.cls&&(a.className=o.cls),o.id&&(a.id=o.id),o.dis&&(a.disabled=!0),re(a,o,e.theme),t!==void 0){if(Array.isArray(t)&&t.length>0&&(Array.isArray(t[0])||L(t[0])||M(t[0])))t.forEach(i=>{let f=h(i,e,s);f&&a.appendChild(f)});else if(L(t)||M(t)){let i=h(t,e,s);i&&a.appendChild(i)}else if(R(t))k(()=>{let i=v(t,r);u==="I"||u==="Ta"?a.value=String(i??""):u==="C"||u==="R"?a.checked=!!i:a.textContent=String(i??"")},e);else if(typeof t=="string"||typeof t=="number"){let i=String(t);s&&(typeof s.item=="object"&&s.item!==null&&(i=i.replace(/\$item\.(\w+)/g,(f,g)=>String(s.item[g]??""))),i=i.replace(/\$item/g,String(s.item)),i=i.replace(/\$index/g,String(s.index))),u==="I"||u==="Ta"?a.value=i:u!=="S"&&(a.textContent=i)}}o.v!==void 0&&R(o.v)&&k(()=>{let i=v(o.v,r);u==="I"||u==="S"||u==="Ta"?a.value=String(i??""):(u==="C"||u==="R")&&(a.checked=!!i)},e),o.ch!==void 0&&(R(o.ch)?k(()=>{let i=v(o.ch,r);a.checked=!!i},e):a.checked=!!o.ch);let l=(i,f)=>{a.addEventListener(i,f),e.cleanups.push(()=>a.removeEventListener(i,f))},m=u==="B"&&(typeof t=="string"||typeof t=="number")?String(t):void 0;if(o.c&&l("click",i=>T(o.c,r,i,s,m)()),o.x){let i=o.x;l("input",f=>{if(typeof i=="function")i();else{let g,y;if(typeof i=="string"){let b=z(i);b?[g,y]=b:(g=i,y="!")}else[g,y]=i;let p=r[g];if(p){let b=f.target,E=u==="C"||u==="R"?b.checked:b.value;W(p,y,E)}}})}if(o.f&&l("focus",i=>T(o.f,r,i,s)()),o.bl&&l("blur",i=>T(o.bl,r,i,s)()),o.k&&l("keydown",i=>T(o.k,r,i,s)()),o.ku&&l("keyup",i=>T(o.ku,r,i,s)()),o.kp&&l("keypress",i=>T(o.kp,r,i,s)()),o.e&&l("mouseenter",i=>T(o.e,r,i,s)()),o.lv&&l("mouseleave",i=>T(o.lv,r,i,s)()),o.sub&&l("submit",i=>{i.preventDefault(),T(o.sub,r,i,s)()}),e.plugins)for(let i of e.plugins)i.afterRender&&i.afterRender(a,c);return a}function F(n,e,s){if(!n)throw new Error("[tooey] render requires a valid container element");if(!e||!e.r)throw new Error("[tooey] render requires a spec with a root node (r)");let r=s?.theme,c=s?.plugins||[],d=(l,m)=>{let i=D(m),f=i.set.bind(i);return i.set=g=>{let y=i();f(g);let p=i();y!==p&&c.forEach(b=>b.onStateChange?.(l,y,p))},i},t={};e.s&&Object.entries(e.s).forEach(([l,m])=>{t[l]=d(l,m)});let o={cleanups:[],state:t,theme:r,plugins:c};n.innerHTML="";let u=h(e.r,o);u&&n.appendChild(u);let a={state:t,el:u,destroy(){c.forEach(l=>l.onDestroy?.(a)),o.cleanups.forEach(l=>l()),o.cleanups=[],n.innerHTML=""},update(l){if(l.s&&U(()=>{Object.entries(l.s).forEach(([m,i])=>{t[m]?t[m].set(i):t[m]=d(m,i)})}),l.r){o.cleanups.forEach(i=>i()),o.cleanups=[],n.innerHTML="";let m=h(l.r,o);m&&n.appendChild(m),a.el=m}},get(l){return t[l]?.()},set(l,m){t[l]&&t[l].set(m)}};return c.forEach(l=>{l.extend&&Object.entries(l.extend).forEach(([m,i])=>{a[m]=i.bind(a)})}),c.forEach(l=>l.onInit?.(a)),a}function ie(n){let e=n&&("theme"in n||"plugins"in n),s=e?n.theme:n,r=e?n.plugins:void 0;return{render:(c,d)=>F(c,d,{theme:s,plugins:r}),theme:s,plugins:r}}function oe(n){return{$:n}}var se="V",ae="H",ce="D",le="G",fe="T",de="B",ue="I",ge="Ta",me="S",ye="C",be="R",he="Tb",Te="Th",pe="Tbd",Ee="Tr",Se="Td",ke="Tc",we="Ul",ve="Ol",He="Li",Le="M",Me="L",Ne="Sv";return J(Re);})();
if(typeof module!=="undefined")module.exports=tooey;
//# sourceMappingURL=tooey.js.map
