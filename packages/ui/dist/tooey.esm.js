function D(n){return typeof n=="object"&&n!==null&&"boundary"in n&&n.boundary===!0}function O(n){let e=document.createElement("div");return e.style.cssText="padding:12px;background:#fee;border:1px solid #fcc;border-radius:4px;color:#c00;font-family:monospace;font-size:12px",e.textContent=`[tooey error] ${n.message}`,e}var v=null,H=0,C=new Set;function $(n){let e=n,t=new Set,s=(()=>(v&&t.add(v),e));return s.set=o=>{let l=typeof o=="function"?o(e):o;l!==e&&(e=l,H>0?t.forEach(r=>C.add(r)):t.forEach(r=>r()))},s.sub=o=>(t.add(o),()=>t.delete(o)),s}function W(n){H++;try{n()}finally{if(H--,H===0){let e=C;C=new Set,e.forEach(t=>t())}}}function w(n,e){let t=!0,s=()=>{if(t){v=s;try{n()}finally{v=null}}};s();let o=()=>{t=!1,v=null};return e&&e.cleanups.push(o),o}function j(n,e,t){try{switch(e){case"+":n.set(s=>s+(typeof t=="number"?t:1));break;case"-":n.set(s=>s-(typeof t=="number"?t:1));break;case"!":n.set(t);break;case"~":n.set(s=>!s);break;case"<":n.set(s=>[...s,t]);break;case">":n.set(s=>[t,...s]);break;case"X":n.set(s=>{let o=s;return typeof t=="number"?o.filter((l,r)=>r!==t):typeof t=="function"?o.filter((l,r)=>!t(l,r)):o.filter(l=>l!==t)});break;case".":Array.isArray(t)&&t.length===2&&n.set(s=>({...s,[t[0]]:t[1]}));break}}catch(s){console.warn("[tooey] state operation error:",e,s)}}function L(n){return typeof n=="object"&&n!==null&&!Array.isArray(n)&&"$"in n}function N(n){return typeof n=="object"&&n!==null&&!Array.isArray(n)&&("if"in n||"?"in n)}function R(n){return typeof n=="object"&&n!==null&&!Array.isArray(n)&&("map"in n||"m"in n)}function p(n,e){if(L(n)){let t=e[n.$];if(!t){console.warn(`[tooey] unknown state key: "${n.$}"`);return}return t()}return n}function u(n){if(n!==void 0)return typeof n=="number"?`${n}px`:n}var z={c:"center",sb:"space-between",sa:"space-around",se:"space-evenly",fe:"flex-end",fs:"flex-start",st:"stretch",bl:"baseline"};function A(n){if(n!==void 0)return z[n]||n}function U(n){if(typeof n!="string"||n.length<2)return null;let e=n[n.length-1];if(e==="+"||e==="-"||e==="~")return[n.slice(0,-1),e];let t=n.indexOf("!");if(t>0){let s=n.slice(0,t),o=n.slice(t+1),l=o;return o==="true"?l=!0:o==="false"?l=!1:!isNaN(Number(o))&&o!==""&&(l=Number(o)),[s,"!",l]}return null}var P=["http:","https:","mailto:","tel:","ftp:"];function q(n){if(!n||typeof n!="string")return!1;if(n.startsWith("/")||n.startsWith("#")||n.startsWith("."))return!0;try{let e=new URL(n,window.location.href);return P.includes(e.protocol)}catch{let e=n.toLowerCase().trim();return!["javascript:","data:","vbscript:"].some(s=>e.startsWith(s))}}function B(n,e){return n?q(n)?n:(console.warn(`[tooey] blocked unsafe URL in ${e}: "${n.slice(0,50)}..."`),null):null}function b(n,e,t,s,o){if(typeof n=="function")return n;let l;if(typeof n=="string"){let h=U(n);h?l=h:o==="+"?l=[n,"+"]:o==="-"?l=[n,"-"]:l=[n,"~"]}else l=n;let[r,a,d]=l;return()=>{let h=e[r];if(!h){console.warn(`[tooey] click handler: unknown state key "${r}"`);return}let i=d;if(s&&typeof i=="string"){if(i==="$index")i=s.index;else if(i==="$item")i=s.item;else if(i.startsWith("$item.")){let c=i.substring(6);i=s.item?.[c]}}if(a==="!"&&d===void 0&&t){let c=t.target;i=c.type==="checkbox"?c.checked:c.value}j(h,a,i)}}function _(n,e){let t=n.style;if(e.g!==void 0&&(t.gap=u(e.g)),e.p!==void 0&&(t.padding=u(e.p)),e.m!==void 0&&(t.margin=u(e.m)),e.w!==void 0&&(t.width=u(e.w)),e.h!==void 0&&(t.height=u(e.h)),e.mw!==void 0&&(t.maxWidth=u(e.mw)),e.mh!==void 0&&(t.maxHeight=u(e.mh)),e.bg!==void 0&&(t.background=e.bg),e.fg!==void 0&&(t.color=e.fg),e.o!==void 0&&(t.opacity=String(e.o)),e.r!==void 0&&(t.borderRadius=u(e.r)),e.bw!==void 0&&(t.borderWidth=u(e.bw)),e.bc!==void 0&&(t.borderColor=e.bc),e.bs!==void 0&&(t.borderStyle=e.bs),e.pos!==void 0){let s={rel:"relative",abs:"absolute",fix:"fixed",sticky:"sticky"};t.position=s[e.pos]||e.pos}e.z!==void 0&&(t.zIndex=String(e.z)),e.t!==void 0&&(t.top=u(e.t)),e.l!==void 0&&(t.left=u(e.l)),(typeof e.b=="number"||typeof e.b=="string"&&!Array.isArray(e.b))&&(t.bottom=u(e.b)),e.rt!==void 0&&(t.right=u(e.rt)),e.fs!==void 0&&(t.fontSize=u(e.fs)),e.fw!==void 0&&(t.fontWeight=String(e.fw)),e.ff!==void 0&&(t.fontFamily=e.ff),e.ta!==void 0&&(t.textAlign=e.ta),e.td!==void 0&&(t.textDecoration=e.td),e.lh!==void 0&&(t.lineHeight=typeof e.lh=="number"?String(e.lh):e.lh),e.ls!==void 0&&(t.letterSpacing=u(e.ls)),e.ai!==void 0&&(t.alignItems=A(e.ai)),e.jc!==void 0&&(t.justifyContent=A(e.jc)),e.flw!==void 0&&(t.flexWrap=A(e.flw)),e.cur!==void 0&&(t.cursor=e.cur),e.ov!==void 0&&(t.overflow=e.ov),e.pe!==void 0&&(t.pointerEvents=e.pe),e.us!==void 0&&(t.userSelect=e.us),e.sh!==void 0&&(t.boxShadow=e.sh),e.tr!==void 0&&(t.transform=e.tr),e.s&&Object.entries(e.s).forEach(([s,o])=>{t[s]=String(o)})}function y(n,e,t){let{state:s}=e;if(D(n)){let i=document.createElement("div");i.style.display="contents";try{let c={cleanups:[],state:s,onError:n.onError||e.onError},f=y(n.child,c,t);f&&(i.appendChild(f),e.cleanups.push(...c.cleanups))}catch(c){let f={message:c instanceof Error?c.message:String(c),stack:c instanceof Error?c.stack:void 0};if(n.onError&&n.onError(f),n.fallback)try{let m=y(n.fallback,e,t);m&&i.appendChild(m)}catch{i.appendChild(O(f))}else i.appendChild(O(f))}return i}if(N(n)){let i=document.createElement("div");i.style.display="contents";let c=null,f=null,m=n.if??n["?"],S=n.then??n.t,g=n.else??n.e,E=n.eq??n.is;return w(()=>{f&&(f.cleanups.forEach(I=>I()),f.cleanups=[]),c&&(i.innerHTML="",c=null);let k=typeof m=="string"?s[m]?.():p(m,s),M;E!==void 0?M=k===E:M=!!k;let T=M?S:g;T&&(f={cleanups:[],state:s},Array.isArray(T)&&T.length>0&&Array.isArray(T[0])?T.forEach(I=>{let V=y(I,f,t);V&&i.appendChild(V)}):(c=y(T,f,t),c&&i.appendChild(c)))},e),i}if(R(n)){let i=document.createElement("div");i.style.display="contents";let c=null,f=n.map??n.m,m=n.as??n.a;return w(()=>{c&&(c.cleanups.forEach(E=>E()),c.cleanups=[]),i.innerHTML="";let g=typeof f=="string"?s[f]?.():p(f,s);!Array.isArray(g)||!m||(c={cleanups:[],state:s},g.forEach((E,x)=>{let k=y(m,c,{item:E,index:x});k&&i.appendChild(k)}))},e),i}if(!Array.isArray(n)||n.length===0)return console.warn("[tooey] invalid node spec:",n),null;let[o,l,r={}]=n,a;switch(o){case"V":a=document.createElement("div"),a.style.display="flex",a.style.flexDirection="column";break;case"H":a=document.createElement("div"),a.style.display="flex",a.style.flexDirection="row";break;case"G":a=document.createElement("div"),a.style.display="grid",r.cols&&(a.style.gridTemplateColumns=typeof r.cols=="number"?`repeat(${r.cols}, 1fr)`:r.cols),r.rows&&(a.style.gridTemplateRows=typeof r.rows=="number"?`repeat(${r.rows}, 1fr)`:r.rows);break;case"D":a=document.createElement("div");break;case"T":a=document.createElement("span");break;case"B":a=document.createElement("button");break;case"I":a=document.createElement("input"),a.type=r.type||"text",r.ph&&(a.placeholder=r.ph),r.ro&&(a.readOnly=!0);break;case"Ta":a=document.createElement("textarea"),r.ph&&(a.placeholder=r.ph),r.rw&&(a.rows=r.rw),r.ro&&(a.readOnly=!0);break;case"S":a=document.createElement("select"),r.opts&&r.opts.forEach(i=>{let c=document.createElement("option");c.value=i.v,c.textContent=i.l,a.appendChild(c)});break;case"C":a=document.createElement("input"),a.type="checkbox";break;case"R":a=document.createElement("input"),a.type="radio";break;case"Tb":a=document.createElement("table");break;case"Th":a=document.createElement("thead");break;case"Tbd":a=document.createElement("tbody");break;case"Tr":a=document.createElement("tr");break;case"Td":a=document.createElement("td"),r.sp&&(a.colSpan=r.sp),r.rsp&&(a.rowSpan=r.rsp);break;case"Tc":a=document.createElement("th"),r.sp&&(a.colSpan=r.sp),r.rsp&&(a.rowSpan=r.rsp);break;case"Ul":a=document.createElement("ul");break;case"Ol":a=document.createElement("ol");break;case"Li":a=document.createElement("li");break;case"M":if(a=document.createElement("img"),r.src){let i=B(r.src,"src");i&&(a.src=i)}r.alt&&(a.alt=r.alt);break;case"L":if(a=document.createElement("a"),r.href){let i=B(r.href,"href");i&&(a.href=i)}break;case"Sv":a=document.createElementNS("http://www.w3.org/2000/svg","svg");break;default:console.warn(`[tooey] unknown component type: ${o}`),a=document.createElement("div")}if(r.cls&&(a.className=r.cls),r.id&&(a.id=r.id),r.dis&&(a.disabled=!0),_(a,r),l!==void 0){if(Array.isArray(l)&&l.length>0&&(Array.isArray(l[0])||N(l[0])||R(l[0])))l.forEach(i=>{let c=y(i,e,t);c&&a.appendChild(c)});else if(N(l)||R(l)){let i=y(l,e,t);i&&a.appendChild(i)}else if(L(l))w(()=>{let i=p(l,s);o==="I"||o==="Ta"?a.value=String(i??""):o==="C"||o==="R"?a.checked=!!i:a.textContent=String(i??"")},e);else if(typeof l=="string"||typeof l=="number"){let i=String(l);t&&(typeof t.item=="object"&&t.item!==null&&(i=i.replace(/\$item\.(\w+)/g,(c,f)=>String(t.item[f]??""))),i=i.replace(/\$item/g,String(t.item)),i=i.replace(/\$index/g,String(t.index))),o==="I"||o==="Ta"?a.value=i:o!=="S"&&(a.textContent=i)}}r.v!==void 0&&L(r.v)&&w(()=>{let i=p(r.v,s);o==="I"||o==="S"||o==="Ta"?a.value=String(i??""):(o==="C"||o==="R")&&(a.checked=!!i)},e),r.ch!==void 0&&(L(r.ch)?w(()=>{let i=p(r.ch,s);a.checked=!!i},e):a.checked=!!r.ch);let d=(i,c)=>{a.addEventListener(i,c),e.cleanups.push(()=>a.removeEventListener(i,c))},h=o==="B"&&(typeof l=="string"||typeof l=="number")?String(l):void 0;if(r.c&&d("click",i=>b(r.c,s,i,t,h)()),r.x){let i=r.x;d("input",c=>{if(typeof i=="function")i();else{let f,m;if(typeof i=="string"){let g=U(i);g?[f,m]=g:(f=i,m="!")}else[f,m]=i;let S=s[f];if(S){let g=c.target,E=o==="C"||o==="R"?g.checked:g.value;j(S,m,E)}}})}return r.f&&d("focus",i=>b(r.f,s,i,t)()),r.bl&&d("blur",i=>b(r.bl,s,i,t)()),r.k&&d("keydown",i=>b(r.k,s,i,t)()),r.ku&&d("keyup",i=>b(r.ku,s,i,t)()),r.kp&&d("keypress",i=>b(r.kp,s,i,t)()),r.e&&d("mouseenter",i=>b(r.e,s,i,t)()),r.lv&&d("mouseleave",i=>b(r.lv,s,i,t)()),r.sub&&d("submit",i=>{i.preventDefault(),b(r.sub,s,i,t)()}),a}function G(n,e){if(!n)throw new Error("[tooey] render requires a valid container element");if(!e||!e.r)throw new Error("[tooey] render requires a spec with a root node (r)");let t={};e.s&&Object.entries(e.s).forEach(([r,a])=>{t[r]=$(a)});let s={cleanups:[],state:t};n.innerHTML="";let o=y(e.r,s);o&&n.appendChild(o);let l={state:t,el:o,destroy(){s.cleanups.forEach(r=>r()),s.cleanups=[],n.innerHTML=""},update(r){if(r.s&&W(()=>{Object.entries(r.s).forEach(([a,d])=>{t[a]?t[a].set(d):t[a]=$(d)})}),r.r){s.cleanups.forEach(d=>d()),s.cleanups=[],n.innerHTML="";let a=y(r.r,s);a&&n.appendChild(a),l.el=a}},get(r){return t[r]?.()},set(r,a){t[r]&&t[r].set(a)}};return l}function F(n){return{$:n}}var K="V",X="H",J="D",Q="G",Y="T",Z="B",ee="I",ne="Ta",te="S",re="C",ie="R",ae="Tb",se="Th",oe="Tbd",le="Tr",ce="Td",fe="Tc",de="Ul",ue="Ol",me="Li",ge="M",be="L",ye="Sv";export{F as $,Z as B,re as C,J as D,Q as G,X as H,ee as I,be as L,me as Li,ge as M,ue as Ol,ie as R,te as S,ye as Sv,Y as T,ne as Ta,ae as Tb,oe as Tbd,fe as Tc,ce as Td,se as Th,le as Tr,de as Ul,K as V,W as batch,w as effect,G as render,$ as signal};
//# sourceMappingURL=tooey.esm.js.map
