{
  "version": 3,
  "sources": ["../src/tooey.ts"],
  "sourcesContent": ["/**\n * tooey - token-efficient ui library for llms\n *\n * component types (2-letter abbreviations):\n *   layout: vs (vstack), hs (hstack), dv (div), gr (grid), fr (fragment)\n *   text & buttons: tx (text/span), bt (button)\n *   inputs: in (input), ta (textarea), sl (select), cb (checkbox), rd (radio)\n *   tables: tb (table), th (thead), bd (tbody), tr (tr), td (td), tc (th)\n *   lists: ul (ul), ol (ol), li (li)\n *   media & links: im (image), ln (link), sv (svg)\n *\n * props (short keys):\n *   spacing: g (gap), p (padding), m (margin), w (width), h (height), mw, mh\n *   colors: bg (background), fg (color), o (opacity)\n *   borders: r (border-radius), bw (border-width), bc (border-color), bs (border-style)\n *   positioning: pos (position), z (z-index), t (top), l (left), rt (right)\n *   typography: fs (font-size), fw (font-weight), ff (font-family), ta, td, lh, ls\n *   layout: ai (align-items), jc (justify-content), flw (flex-wrap), cols, rows\n *     shortcuts: c=center, sb=space-between, fe=flex-end, fs=flex-start, st=stretch\n *   misc: cur (cursor), ov (overflow), pe (pointer-events), us (user-select), sh, tr\n *   element-specific: v (value), ph (placeholder), type, href, src, alt, dis, ch, ro, opts\n *   refs: rf (ref callback or ref object)\n *\n * events: c (click), x (input/change), f (focus), bl (blur), k (keydown), ku, kp, e, lv, sub\n *   shorthand: \"state+\" (increment), \"state-\" (decrement), \"state~\" (toggle), \"state!val\" (set)\n *\n * state operations: + (increment), - (decrement), ! (set), ~ (toggle), < (append), > (prepend), X (remove), . (set prop)\n *\n * control flow (short form): {?: cond, t: [...], e: [...]} | {m: state, a: [...]}\n * control flow (long form): {if: state, then: [...], else: [...]} | {map: state, as: [...]}\n * equality check: {?: \"state\", is: 0, t: [...]} or {?: {$:\"state\"}, is: 0, t: [...]}\n *\n * advanced features:\n *   refs: ref() creates ref object, rf prop attaches to element\n *   context: cx(default) creates context, ux(ctx) gets value, {pv: ctx, v: val, c: [...]} provides\n *   portals: {pt: target, c: [...]} renders children to target element\n *   memo: {mm: ['deps'], c: [...]} memoizes based on state deps, mm(component, compare) wraps component\n *   reducer: rd$(reducer, initialState) returns {s, dp} for reducer pattern\n *   ssr: rts(spec) renders to string, hy(container, spec) hydrates\n *   router: rt (router), lk (link), ot(routes) outlet, nav(path) navigate\n *   devtools: devtools({name, log}) plugin for debugging\n */\n\n// ============ types ============\n\ntype StateValue = unknown;\ntype StateStore = Record<string, Signal<StateValue>>;\n\n// ============ refs ============\n\ninterface Ref<T = HTMLElement | null> {\n  el: T;\n}\n\nfunction ref<T = HTMLElement | null>(initial: T = null as T): Ref<T> {\n  return { el: initial };\n}\n\ntype RefCallback = (el: HTMLElement) => void;\ntype RefProp = Ref | RefCallback;\n\n// ============ context ============\n\n// context id counter for unique identification\nlet contextIdCounter = 0;\n\ninterface Context<T> {\n  _id: number;\n  _default: T;\n}\n\n// context value stack for nested providers\nconst contextStacks: Map<number, unknown[]> = new Map();\n\nfunction cx<T>(defaultValue: T): Context<T> {\n  const id = contextIdCounter++;\n  contextStacks.set(id, [defaultValue]);\n  return { _id: id, _default: defaultValue };\n}\n\nfunction ux<T>(context: Context<T>): T {\n  const stack = contextStacks.get(context._id);\n  if (!stack || stack.length === 0) {\n    return context._default;\n  }\n  return stack[stack.length - 1] as T;\n}\n\n// push context value (used by provider)\nfunction pushContext<T>(context: Context<T>, value: T): void {\n  const stack = contextStacks.get(context._id);\n  if (stack) {\n    stack.push(value);\n  }\n}\n\n// pop context value (used by provider cleanup)\nfunction popContext<T>(context: Context<T>): void {\n  const stack = contextStacks.get(context._id);\n  if (stack && stack.length > 1) {\n    stack.pop();\n  }\n}\n\n// ============ theming ============\n\ntype ThemeValue = string | number;\ntype ThemeCategory = Record<string, ThemeValue>;\n\ninterface Theme {\n  colors?: ThemeCategory;\n  spacing?: ThemeCategory;\n  radius?: ThemeCategory;\n  fonts?: ThemeCategory;\n  [key: string]: ThemeCategory | undefined;\n}\n\n// ============ plugins ============\n\ninterface TooeyPlugin {\n  name: string;\n\n  // lifecycle hooks\n  onInit?(instance: TooeyInstance): void;\n  onDestroy?(instance: TooeyInstance): void;\n\n  // render hooks\n  beforeRender?(spec: NodeSpec, ctx: RenderContext): NodeSpec;\n  afterRender?(el: HTMLElement, spec: NodeSpec): void;\n\n  // state hooks\n  onStateChange?(key: string, oldVal: unknown, newVal: unknown): void;\n\n  // extend instance with custom methods\n  extend?: Record<string, (this: TooeyInstance, ...args: unknown[]) => unknown>;\n}\n\ninterface RenderOptions {\n  theme?: Theme;\n  plugins?: TooeyPlugin[];\n}\n\ninterface Signal<T> {\n  (): T;\n  set(v: T | ((prev: T) => T)): void;\n  sub(fn: () => void): () => void;\n}\n\ntype Op = '+' | '-' | '!' | '~' | '<' | '>' | 'X' | '.';\ntype EventHandler = [string, Op, unknown?] | (() => void) | string;\n\ninterface Props {\n  // conditional rendering\n  show?: string; // state key - component only renders when state is truthy\n  // spacing/sizing\n  g?: number | string;\n  p?: number | string;\n  m?: number | string;\n  w?: number | string;\n  h?: number | string;\n  mw?: number | string;\n  mh?: number | string;\n  // colors\n  bg?: string;\n  fg?: string;\n  o?: number;\n  // borders\n  r?: number | string;\n  bw?: number | string;\n  bc?: string;\n  bs?: string;\n  // positioning\n  pos?: 'rel' | 'abs' | 'fix' | 'sticky' | string;\n  z?: number;\n  t?: number | string;\n  l?: number | string;\n  b?: number | string;\n  rt?: number | string;\n  // typography\n  fs?: number | string;\n  fw?: number | string;\n  ff?: string;\n  ta?: string;\n  td?: string;\n  lh?: number | string;\n  ls?: number | string;\n  // layout\n  ai?: string;\n  jc?: string;\n  flw?: string;\n  cols?: number | string;\n  rows?: number | string;\n  // misc\n  cur?: string;\n  ov?: string;\n  pe?: string;\n  us?: string;\n  sh?: string;\n  tr?: string;\n  // element-specific\n  v?: unknown;\n  ph?: string;\n  type?: string;\n  href?: string;\n  src?: string;\n  alt?: string;\n  dis?: boolean;\n  ch?: unknown;\n  ro?: boolean;\n  opts?: Array<{v: string, l: string}>;\n  cls?: string;\n  id?: string;\n  rw?: number;\n  sp?: number;\n  rsp?: number;\n  // events\n  c?: EventHandler;\n  x?: EventHandler;\n  f?: EventHandler;\n  bl?: EventHandler;\n  k?: EventHandler;\n  ku?: EventHandler;\n  kp?: EventHandler;\n  e?: EventHandler;\n  lv?: EventHandler;\n  sub?: EventHandler;\n  // custom styles\n  s?: Record<string, unknown>;\n  // refs\n  rf?: RefProp;\n}\n\ntype ComponentType =\n  | 'vs' | 'hs' | 'dv' | 'gr'\n  | 'tx' | 'bt'\n  | 'in' | 'ta' | 'sl' | 'cb' | 'rd'\n  | 'tb' | 'th' | 'bd' | 'tr' | 'td' | 'tc'\n  | 'ul' | 'ol' | 'li'\n  | 'im' | 'ln' | 'sv'\n  | 'fr';  // fragment\n\n// function component type - returns a NodeSpec\ntype Component<P extends Props = Props> = (props?: P, children?: NodeSpec[]) => NodeSpec;\n\ntype StateRef = { $: string };\n\ninterface IfNode {\n  // long form\n  if?: StateRef | string;\n  then?: NodeSpec | NodeSpec[];\n  else?: NodeSpec | NodeSpec[];\n  // short form\n  '?'?: StateRef | string;\n  t?: NodeSpec | NodeSpec[];\n  e?: NodeSpec | NodeSpec[];\n  // equality check (works with both forms)\n  eq?: unknown;\n  is?: unknown;\n}\n\ninterface MapNode {\n  // long form\n  map?: StateRef | string;\n  as?: NodeSpec;\n  // short form\n  m?: StateRef | string;\n  a?: NodeSpec;\n  key?: string;\n}\n\n// provider node for context\ninterface ProviderNode {\n  pv: Context<unknown>;\n  v: unknown;\n  c: NodeSpec | NodeSpec[];\n}\n\n// portal node for rendering outside component tree\ninterface PortalNode {\n  pt: HTMLElement | string;  // target element or selector\n  c: NodeSpec | NodeSpec[];\n}\n\n// memo node for memoized rendering\ninterface MemoNode {\n  mm: string[];  // dependency state keys\n  c: NodeSpec;\n}\n\ntype Content = string | number | StateRef | NodeSpec[] | IfNode | MapNode;\n// eslint-disable-next-line @typescript-eslint/no-explicit-any\ntype FunctionNodeSpec = [Component<any>, Content?, (Props & Record<string, unknown>)?];\ntype BuiltinNodeSpec = [ComponentType, Content?, Props?];\ntype NodeSpec = BuiltinNodeSpec | FunctionNodeSpec | IfNode | MapNode | ProviderNode | PortalNode | MemoNode;\n\ninterface TooeySpec {\n  s?: Record<string, StateValue>;\n  r: NodeSpec;\n}\n\n// ============ render context for cleanup ============\n\ninterface ErrorInfo {\n  message: string;\n  componentType?: string;\n  stack?: string;\n}\n\ntype ErrorHandler = (error: ErrorInfo) => void;\n\ninterface RenderContext {\n  cleanups: Array<() => void>;\n  state: StateStore;\n  theme?: Theme;\n  plugins?: TooeyPlugin[];\n  onError?: ErrorHandler;\n}\n\n// ============ error boundary ============\n\ninterface ErrorBoundaryNode {\n  boundary: true;\n  child: NodeSpec;\n  fallback?: NodeSpec;\n  onError?: ErrorHandler;\n}\n\nfunction isErrorBoundaryNode(v: unknown): v is ErrorBoundaryNode {\n  return typeof v === 'object' && v !== null && 'boundary' in v && (v as ErrorBoundaryNode).boundary === true;\n}\n\nfunction createErrorFallback(error: ErrorInfo): HTMLElement {\n  const el = document.createElement('div');\n  el.style.cssText = 'padding:12px;background:#fee;border:1px solid #fcc;border-radius:4px;color:#c00;font-family:monospace;font-size:12px';\n  el.textContent = `[tooey error] ${error.message}`;\n  return el;\n}\n\n// ============ signals ============\n\nlet currentEffect: (() => void) | null = null;\nlet batchDepth = 0;\nlet pendingEffects = new Set<() => void>();\n\nfunction signal<T>(initial: T): Signal<T> {\n  let value = initial;\n  const subscribers = new Set<() => void>();\n\n  const sig = (() => {\n    if (currentEffect) {\n      subscribers.add(currentEffect);\n    }\n    return value;\n  }) as Signal<T>;\n\n  sig.set = (v: T | ((prev: T) => T)) => {\n    const newValue = typeof v === 'function' ? (v as (prev: T) => T)(value) : v;\n    if (newValue !== value) {\n      value = newValue;\n      if (batchDepth > 0) {\n        subscribers.forEach(fn => pendingEffects.add(fn));\n      } else {\n        subscribers.forEach(fn => fn());\n      }\n    }\n  };\n\n  sig.sub = (fn: () => void) => {\n    subscribers.add(fn);\n    return () => subscribers.delete(fn);\n  };\n\n  return sig;\n}\n\nfunction batch(fn: () => void): void {\n  batchDepth++;\n  try {\n    fn();\n  } finally {\n    batchDepth--;\n    if (batchDepth === 0) {\n      const effects = pendingEffects;\n      pendingEffects = new Set();\n      effects.forEach(fn => fn());\n    }\n  }\n}\n\nfunction effect(fn: () => void, ctx?: RenderContext): () => void {\n  let isActive = true;\n\n  const execute = () => {\n    if (!isActive) return;\n    currentEffect = execute;\n    try {\n      fn();\n    } finally {\n      currentEffect = null;\n    }\n  };\n\n  execute();\n\n  const cleanup = () => {\n    isActive = false;\n    currentEffect = null;\n  };\n\n  if (ctx) {\n    ctx.cleanups.push(cleanup);\n  }\n\n  return cleanup;\n}\n\n// computed signal - derives value from other signals and auto-updates\ninterface ComputedSignal<T> {\n  (): T;\n  sub(fn: () => void): () => void;\n}\n\nfunction computed<T>(fn: () => T): ComputedSignal<T> {\n  let cachedValue: T;\n  let isDirty = true;\n  const subscribers = new Set<() => void>();\n\n  // re-compute and notify subscribers when dependencies change\n  const recompute = () => {\n    isDirty = true;\n    // notify all subscribers that the value may have changed\n    if (batchDepth > 0) {\n      subscribers.forEach(sub => pendingEffects.add(sub));\n    } else {\n      subscribers.forEach(sub => sub());\n    }\n  };\n\n  const sig = (() => {\n    // track this computed as a dependency if inside an effect\n    if (currentEffect) {\n      subscribers.add(currentEffect);\n    }\n\n    // recompute if dirty\n    if (isDirty) {\n      // track dependencies by running the computation inside an effect context\n      const prevEffect = currentEffect;\n      currentEffect = recompute;\n      try {\n        cachedValue = fn();\n      } finally {\n        currentEffect = prevEffect;\n      }\n      isDirty = false;\n    }\n\n    return cachedValue;\n  }) as ComputedSignal<T>;\n\n  sig.sub = (subFn: () => void) => {\n    subscribers.add(subFn);\n    return () => subscribers.delete(subFn);\n  };\n\n  return sig;\n}\n\n// async$ helper - handle async data with loading states\ninterface AsyncState<T> {\n  data: T | null;\n  loading: boolean;\n  error: string | null;\n  [key: string]: unknown; // index signature for TooeySpec.s compatibility\n}\n\ninterface AsyncSpec<T> {\n  s: AsyncState<T>;\n  init(instance: TooeyInstance): Promise<void>;\n}\n\nfunction async$<T>(\n  promiseOrFn: Promise<T> | (() => Promise<T>),\n  options?: { onError?: (error: Error) => void }\n): AsyncSpec<T> {\n  return {\n    s: {\n      data: null,\n      loading: true,\n      error: null\n    },\n    async init(instance: TooeyInstance) {\n      try {\n        const promise = typeof promiseOrFn === 'function' ? promiseOrFn() : promiseOrFn;\n        const data = await promise;\n        instance.set('data', data);\n        instance.set('loading', false);\n      } catch (err) {\n        const errorMessage = err instanceof Error ? err.message : String(err);\n        instance.set('error', errorMessage);\n        instance.set('loading', false);\n        if (options?.onError && err instanceof Error) {\n          options.onError(err);\n        }\n      }\n    }\n  };\n}\n\n// reducer helper - creates state and dispatch function for reducer pattern\ntype Reducer<S, A> = (state: S, action: A) => S;\ntype Dispatch<A> = (action: A) => void;\n\ninterface ReducerSpec<S extends Record<string, unknown>, A> {\n  s: S;\n  dp: Dispatch<A>;\n}\n\nfunction rd$<S extends Record<string, unknown>, A>(\n  reducer: Reducer<S, A>,\n  initialState: S\n): ReducerSpec<S, A> {\n  let currentState = initialState;\n  let instance: TooeyInstance | null = null;\n\n  const dispatch: Dispatch<A> = (action: A) => {\n    const newState = reducer(currentState, action);\n    if (newState !== currentState) {\n      currentState = newState;\n      if (instance) {\n        batch(() => {\n          Object.entries(newState).forEach(([key, val]) => {\n            instance!.set(key, val);\n          });\n        });\n      }\n    }\n  };\n\n  // create a proxy to capture the instance when state is accessed\n  const stateProxy = new Proxy(initialState, {\n    get(target, prop) {\n      return target[prop as keyof S];\n    }\n  });\n\n  return {\n    s: stateProxy,\n    dp: dispatch,\n    // internal: bind instance after render\n    _bind(inst: TooeyInstance) {\n      instance = inst;\n    }\n  } as ReducerSpec<S, A> & { _bind: (inst: TooeyInstance) => void };\n}\n\n// memoized component wrapper - caches result based on props comparison\nfunction mm<P extends Props>(\n  component: Component<P>,\n  compareFn?: (prevProps: P | undefined, nextProps: P | undefined) => boolean\n): Component<P> {\n  let cachedResult: NodeSpec | null = null;\n  let prevProps: P | undefined = undefined;\n\n  const defaultCompare = (prev: P | undefined, next: P | undefined): boolean => {\n    if (prev === next) return true;\n    if (!prev || !next) return false;\n    const prevKeys = Object.keys(prev);\n    const nextKeys = Object.keys(next);\n    if (prevKeys.length !== nextKeys.length) return false;\n    return prevKeys.every(key => (prev as Record<string, unknown>)[key] === (next as Record<string, unknown>)[key]);\n  };\n\n  const compare = compareFn || defaultCompare;\n\n  return (props?: P, children?: NodeSpec[]): NodeSpec => {\n    if (cachedResult && compare(prevProps, props)) {\n      return cachedResult;\n    }\n    prevProps = props;\n    cachedResult = component(props, children);\n    return cachedResult;\n  };\n}\n\n// ============ state operations ============\n\nfunction applyOp(state: Signal<StateValue>, op: Op, val?: unknown): void {\n  try {\n    switch (op) {\n      case '+':\n        state.set((v: StateValue) => (v as number) + (typeof val === 'number' ? val : 1));\n        break;\n      case '-':\n        state.set((v: StateValue) => (v as number) - (typeof val === 'number' ? val : 1));\n        break;\n      case '!':\n        state.set(val);\n        break;\n      case '~':\n        state.set((v: StateValue) => !v);\n        break;\n      case '<':\n        state.set((v: StateValue) => [...(v as unknown[]), val]);\n        break;\n      case '>':\n        state.set((v: StateValue) => [val, ...(v as unknown[])]);\n        break;\n      case 'X':\n        state.set((v: StateValue) => {\n          const arr = v as unknown[];\n          if (typeof val === 'number') {\n            return arr.filter((_, i) => i !== val);\n          } else if (typeof val === 'function') {\n            return arr.filter((item, i) => !(val as (item: unknown, i: number) => boolean)(item, i));\n          }\n          return arr.filter(item => item !== val);\n        });\n        break;\n      case '.':\n        if (Array.isArray(val) && val.length === 2) {\n          state.set((v: StateValue) => ({ ...(v as Record<string, unknown>), [val[0]]: val[1] }));\n        }\n        break;\n    }\n  } catch (err) {\n    console.warn('[tooey] state operation error:', op, err);\n  }\n}\n\n// ============ helpers ============\n\nfunction isStateRef(v: unknown): v is StateRef {\n  return typeof v === 'object' && v !== null && !Array.isArray(v) && '$' in v;\n}\n\nfunction isIfNode(v: unknown): v is IfNode {\n  return typeof v === 'object' && v !== null && !Array.isArray(v) && ('if' in v || '?' in v);\n}\n\nfunction isMapNode(v: unknown): v is MapNode {\n  return typeof v === 'object' && v !== null && !Array.isArray(v) && ('map' in v || 'm' in v);\n}\n\nfunction isProviderNode(v: unknown): v is ProviderNode {\n  return typeof v === 'object' && v !== null && !Array.isArray(v) && 'pv' in v;\n}\n\nfunction isPortalNode(v: unknown): v is PortalNode {\n  return typeof v === 'object' && v !== null && !Array.isArray(v) && 'pt' in v;\n}\n\nfunction isMemoNode(v: unknown): v is MemoNode {\n  return typeof v === 'object' && v !== null && !Array.isArray(v) && 'mm' in v && 'c' in v;\n}\n\nfunction resolveValue(content: unknown, state: StateStore): unknown {\n  if (isStateRef(content)) {\n    const sig = state[content.$];\n    if (!sig) {\n      console.warn(`[tooey] unknown state key: \"${content.$}\"`);\n      return undefined;\n    }\n    return sig();\n  }\n  return content;\n}\n\nfunction resolveCssValue(val: number | string | undefined): string | undefined {\n  if (val === undefined) return undefined;\n  if (typeof val === 'number') return `${val}px`;\n  return val;\n}\n\nfunction resolveThemeValue(token: string, theme: Theme | undefined): ThemeValue | undefined {\n  if (!theme) return undefined;\n\n  // try direct category lookup: $primary -> colors.primary, $md -> spacing.md, etc.\n  // check in order of most common usage\n  const categories: (keyof Theme)[] = ['colors', 'spacing', 'radius', 'fonts'];\n\n  for (const category of categories) {\n    const cat = theme[category];\n    if (cat && token in cat) {\n      return cat[token];\n    }\n  }\n\n  // check any custom categories\n  for (const [key, cat] of Object.entries(theme)) {\n    if (cat && !categories.includes(key as keyof Theme) && token in cat) {\n      return cat[token];\n    }\n  }\n\n  return undefined;\n}\n\n// style value shortcuts for common layout values\nconst styleShortcuts: Record<string, string> = {\n  'c': 'center',\n  'sb': 'space-between',\n  'sa': 'space-around',\n  'se': 'space-evenly',\n  'fe': 'flex-end',\n  'fs': 'flex-start',\n  'st': 'stretch',\n  'bl': 'baseline',\n};\n\nfunction expandStyleValue(val: string | undefined): string | undefined {\n  if (val === undefined) return undefined;\n  return styleShortcuts[val] || val;\n}\n\n// parse string-based event handler shorthand\n// format: \"stateName+\" | \"stateName-\" | \"stateName~\" | \"stateName!value\"\nfunction parseEventShorthand(str: string): [string, Op, unknown?] | null {\n  if (typeof str !== 'string' || str.length < 2) return null;\n\n  const lastChar = str[str.length - 1];\n\n  // simple ops: +, -, ~\n  if (lastChar === '+' || lastChar === '-' || lastChar === '~') {\n    return [str.slice(0, -1), lastChar as Op];\n  }\n\n  // set operation with value: \"state!value\"\n  const bangIdx = str.indexOf('!');\n  if (bangIdx > 0) {\n    const stateKey = str.slice(0, bangIdx);\n    const valStr = str.slice(bangIdx + 1);\n    // try to parse as number or boolean\n    let val: unknown = valStr;\n    if (valStr === 'true') val = true;\n    else if (valStr === 'false') val = false;\n    else if (!isNaN(Number(valStr)) && valStr !== '') val = Number(valStr);\n    return [stateKey, '!', val];\n  }\n\n  return null;\n}\n\n// xss protection - escape html entities (kept for future use, textContent provides protection now)\nfunction _escapeHtml(str: string): string {\n  const div = document.createElement('div');\n  div.textContent = str;\n  return div.innerHTML;\n}\n\n// url validation - prevent dangerous protocols\nconst SAFE_URL_PROTOCOLS = ['http:', 'https:', 'mailto:', 'tel:', 'ftp:'];\n\nfunction isValidUrl(url: string): boolean {\n  if (!url || typeof url !== 'string') return false;\n\n  // allow relative urls and anchors\n  if (url.startsWith('/') || url.startsWith('#') || url.startsWith('.')) {\n    return true;\n  }\n\n  try {\n    const parsed = new URL(url, window.location.href);\n    return SAFE_URL_PROTOCOLS.includes(parsed.protocol);\n  } catch {\n    // if url parsing fails, check for dangerous patterns directly\n    const lowerUrl = url.toLowerCase().trim();\n    const dangerousPatterns = ['javascript:', 'data:', 'vbscript:'];\n    return !dangerousPatterns.some(pattern => lowerUrl.startsWith(pattern));\n  }\n}\n\nfunction sanitizeUrl(url: string, propName: string): string | null {\n  if (!url) return null;\n\n  if (!isValidUrl(url)) {\n    console.warn(`[tooey] blocked unsafe URL in ${propName}: \"${url.slice(0, 50)}...\"`);\n    return null;\n  }\n\n  return url;\n}\n\nfunction createHandler(\n  handler: EventHandler,\n  state: StateStore,\n  event?: Event,\n  itemContext?: { item: unknown, index: number },\n  buttonText?: string\n): () => void {\n  if (typeof handler === 'function') {\n    return handler;\n  }\n\n  // handle string shorthand: \"state+\", \"state-\", \"state~\", \"state!value\"\n  let normalizedHandler: [string, Op, unknown?];\n  if (typeof handler === 'string') {\n    const parsed = parseEventShorthand(handler);\n    if (parsed) {\n      normalizedHandler = parsed;\n    } else {\n      // plain state key - infer operation from button text if available\n      if (buttonText === '+') {\n        normalizedHandler = [handler, '+'];\n      } else if (buttonText === '-') {\n        normalizedHandler = [handler, '-'];\n      } else {\n        // default to toggle for plain state key\n        normalizedHandler = [handler, '~'];\n      }\n    }\n  } else {\n    normalizedHandler = handler;\n  }\n\n  const [stateKey, op, val] = normalizedHandler;\n  return () => {\n    const sig = state[stateKey];\n    if (!sig) {\n      console.warn(`[tooey] click handler: unknown state key \"${stateKey}\"`);\n      return;\n    }\n    let actualVal = val;\n    // resolve $item and $index in event handler values\n    if (itemContext && typeof actualVal === 'string') {\n      if (actualVal === '$index') {\n        actualVal = itemContext.index;\n      } else if (actualVal === '$item') {\n        actualVal = itemContext.item;\n      } else if (actualVal.startsWith('$item.')) {\n        const key = actualVal.substring(6);\n        actualVal = (itemContext.item as Record<string, unknown>)?.[key];\n      }\n    }\n    if (op === '!' && val === undefined && event) {\n      const target = event.target as HTMLInputElement;\n      actualVal = target.type === 'checkbox' ? target.checked : target.value;\n    }\n    applyOp(sig, op, actualVal);\n  };\n}\n\n// ============ styles ============\n\nfunction resolveStyleValue(val: string | number | undefined, theme: Theme | undefined): string | number | undefined {\n  if (val === undefined) return undefined;\n  if (typeof val === 'string' && val.startsWith('$')) {\n    const token = val.slice(1);\n    const themeVal = resolveThemeValue(token, theme);\n    if (themeVal !== undefined) return themeVal;\n    console.warn(`[tooey] unknown theme token: \"${val}\"`);\n    return undefined;\n  }\n  return val;\n}\n\nfunction applyStyles(el: HTMLElement, props: Props, theme?: Theme): void {\n  const style = el.style;\n\n  // helper to resolve and apply css value with theme token support\n  const resolve = (val: string | number | undefined): string | undefined => {\n    const resolved = resolveStyleValue(val, theme);\n    return resolveCssValue(resolved as string | number | undefined);\n  };\n\n  // helper for string values that support theme tokens\n  const resolveStr = (val: string | undefined): string | undefined => {\n    if (val === undefined) return undefined;\n    const resolved = resolveStyleValue(val, theme);\n    return resolved !== undefined ? String(resolved) : undefined;\n  };\n\n  if (props.g !== undefined) { const v = resolve(props.g); if (v) style.gap = v; }\n  if (props.p !== undefined) { const v = resolve(props.p); if (v) style.padding = v; }\n  if (props.m !== undefined) { const v = resolve(props.m); if (v) style.margin = v; }\n  if (props.w !== undefined) { const v = resolve(props.w); if (v) style.width = v; }\n  if (props.h !== undefined) { const v = resolve(props.h); if (v) style.height = v; }\n  if (props.mw !== undefined) { const v = resolve(props.mw); if (v) style.maxWidth = v; }\n  if (props.mh !== undefined) { const v = resolve(props.mh); if (v) style.maxHeight = v; }\n\n  if (props.bg !== undefined) { const v = resolveStr(props.bg); if (v) style.background = v; }\n  if (props.fg !== undefined) { const v = resolveStr(props.fg); if (v) style.color = v; }\n  if (props.o !== undefined) style.opacity = String(props.o);\n\n  if (props.r !== undefined) { const v = resolve(props.r); if (v) style.borderRadius = v; }\n  if (props.bw !== undefined) { const v = resolve(props.bw); if (v) style.borderWidth = v; }\n  if (props.bc !== undefined) { const v = resolveStr(props.bc); if (v) style.borderColor = v; }\n  if (props.bs !== undefined) style.borderStyle = props.bs;\n\n  if (props.pos !== undefined) {\n    const posMap: Record<string, string> = {\n      rel: 'relative', abs: 'absolute', fix: 'fixed', sticky: 'sticky'\n    };\n    style.position = posMap[props.pos] || props.pos;\n  }\n  if (props.z !== undefined) style.zIndex = String(props.z);\n  if (props.t !== undefined) { const v = resolve(props.t); if (v) style.top = v; }\n  if (props.l !== undefined) { const v = resolve(props.l); if (v) style.left = v; }\n  if (typeof props.b === 'number' || (typeof props.b === 'string' && !Array.isArray(props.b))) {\n    const v = resolve(props.b as number | string);\n    if (v) style.bottom = v;\n  }\n  if (props.rt !== undefined) { const v = resolve(props.rt); if (v) style.right = v; }\n\n  if (props.fs !== undefined) { const v = resolve(props.fs); if (v) style.fontSize = v; }\n  if (props.fw !== undefined) style.fontWeight = String(props.fw);\n  if (props.ff !== undefined) { const v = resolveStr(props.ff); if (v) style.fontFamily = v; }\n  if (props.ta !== undefined) style.textAlign = props.ta;\n  if (props.td !== undefined) style.textDecoration = props.td;\n  if (props.lh !== undefined) style.lineHeight = typeof props.lh === 'number' ? String(props.lh) : props.lh;\n  if (props.ls !== undefined) { const v = resolve(props.ls); if (v) style.letterSpacing = v; }\n\n  if (props.ai !== undefined) style.alignItems = expandStyleValue(props.ai)!;\n  if (props.jc !== undefined) style.justifyContent = expandStyleValue(props.jc)!;\n  if (props.flw !== undefined) style.flexWrap = expandStyleValue(props.flw)!\n\n  if (props.cur !== undefined) style.cursor = props.cur;\n  if (props.ov !== undefined) style.overflow = props.ov;\n  if (props.pe !== undefined) style.pointerEvents = props.pe;\n  if (props.us !== undefined) style.userSelect = props.us;\n  if (props.sh !== undefined) { const v = resolveStr(props.sh); if (v) style.boxShadow = v; }\n  if (props.tr !== undefined) style.transform = props.tr;\n\n  if (props.s) {\n    Object.entries(props.s).forEach(([key, val]) => {\n      const resolved = resolveStyleValue(val as string | number | undefined, theme);\n      if (resolved !== undefined) {\n        (style as unknown as Record<string, string>)[key] = String(resolved);\n      }\n    });\n  }\n}\n\n// ============ renderer ============\n\nfunction createElement(\n  spec: NodeSpec,\n  ctx: RenderContext,\n  itemContext?: { item: unknown, index: number }\n): HTMLElement | null {\n  const { state } = ctx;\n\n  // handle error boundary node\n  if (isErrorBoundaryNode(spec)) {\n    const placeholder = document.createElement('div');\n    placeholder.style.display = 'contents';\n\n    try {\n      const childCtx: RenderContext = {\n        cleanups: [],\n        state,\n        onError: spec.onError || ctx.onError,\n      };\n      const child = createElement(spec.child, childCtx, itemContext);\n      if (child) {\n        placeholder.appendChild(child);\n        ctx.cleanups.push(...childCtx.cleanups);\n      }\n    } catch (err) {\n      const errorInfo: ErrorInfo = {\n        message: err instanceof Error ? err.message : String(err),\n        stack: err instanceof Error ? err.stack : undefined,\n      };\n\n      if (spec.onError) {\n        spec.onError(errorInfo);\n      }\n\n      if (spec.fallback) {\n        try {\n          const fallbackEl = createElement(spec.fallback, ctx, itemContext);\n          if (fallbackEl) placeholder.appendChild(fallbackEl);\n        } catch {\n          placeholder.appendChild(createErrorFallback(errorInfo));\n        }\n      } else {\n        placeholder.appendChild(createErrorFallback(errorInfo));\n      }\n    }\n\n    return placeholder;\n  }\n\n  // handle reactive if node (supports both long and short form)\n  if (isIfNode(spec)) {\n    const placeholder = document.createElement('div');\n    placeholder.style.display = 'contents';\n\n    let currentEl: HTMLElement | null = null;\n    let childCtx: RenderContext | null = null;\n\n    // normalize short form to long form\n    const ifCond = spec.if ?? spec['?'];\n    const thenBranch = spec.then ?? spec.t;\n    const elseBranch = spec.else ?? spec.e;\n    const eqValue = spec.eq ?? spec.is;\n\n    const updateIf = () => {\n      // cleanup previous render\n      if (childCtx) {\n        childCtx.cleanups.forEach(fn => fn());\n        childCtx.cleanups = [];\n      }\n      if (currentEl) {\n        placeholder.innerHTML = '';\n        currentEl = null;\n      }\n\n      const rawValue = typeof ifCond === 'string'\n        ? state[ifCond]?.()\n        : resolveValue(ifCond, state);\n\n      // handle equality check (eq or is)\n      let condition: boolean;\n      if (eqValue !== undefined) {\n        condition = rawValue === eqValue;\n      } else {\n        condition = Boolean(rawValue);\n      }\n\n      const branch = condition ? thenBranch : elseBranch;\n      if (!branch) return;\n\n      childCtx = { cleanups: [], state };\n\n      if (Array.isArray(branch) && branch.length > 0 && Array.isArray(branch[0])) {\n        (branch as NodeSpec[]).forEach(child => {\n          const el = createElement(child, childCtx!, itemContext);\n          if (el) placeholder.appendChild(el);\n        });\n      } else {\n        currentEl = createElement(branch as NodeSpec, childCtx, itemContext);\n        if (currentEl) placeholder.appendChild(currentEl);\n      }\n    };\n\n    effect(updateIf, ctx);\n    return placeholder;\n  }\n\n  // handle reactive map node (supports both long and short form)\n  if (isMapNode(spec)) {\n    const placeholder = document.createElement('div');\n    placeholder.style.display = 'contents';\n\n    let childCtx: RenderContext | null = null;\n\n    // normalize short form to long form\n    const mapSource = spec.map ?? spec.m;\n    const asTemplate = spec.as ?? spec.a;\n\n    const updateMap = () => {\n      // cleanup previous render\n      if (childCtx) {\n        childCtx.cleanups.forEach(fn => fn());\n        childCtx.cleanups = [];\n      }\n      placeholder.innerHTML = '';\n\n      const arr = (typeof mapSource === 'string'\n        ? state[mapSource]?.()\n        : resolveValue(mapSource, state)) as unknown[];\n\n      if (!Array.isArray(arr) || !asTemplate) return;\n\n      childCtx = { cleanups: [], state };\n\n      arr.forEach((item, index) => {\n        const el = createElement(asTemplate, childCtx!, { item, index });\n        if (el) placeholder.appendChild(el);\n      });\n    };\n\n    effect(updateMap, ctx);\n    return placeholder;\n  }\n\n  // handle provider node for context\n  if (isProviderNode(spec)) {\n    const placeholder = document.createElement('div');\n    placeholder.style.display = 'contents';\n\n    // push context value\n    pushContext(spec.pv as Context<unknown>, spec.v);\n\n    // render children - detect if spec.c is already an array of node specs\n    // if first element is a function, it's a single function component NodeSpec [Fn, content?, props?]\n    // if first element is an array or object node (if/map/provider/etc), it's an array of NodeSpecs\n    const isNodeSpecArray = (arr: unknown[]): boolean => {\n      const first = arr[0];\n      // function as first = single function component, not array of specs\n      if (typeof first === 'function') return false;\n      return Array.isArray(first) || isIfNode(first) || isMapNode(first) ||\n             isProviderNode(first) || isPortalNode(first) || isMemoNode(first) ||\n             isErrorBoundaryNode(first);\n    };\n\n    const children = Array.isArray(spec.c) && spec.c.length > 0 && isNodeSpecArray(spec.c as unknown[])\n      ? spec.c as NodeSpec[]\n      : [spec.c as NodeSpec];\n\n    children.forEach(child => {\n      const el = createElement(child, ctx, itemContext);\n      if (el) placeholder.appendChild(el);\n    });\n\n    // cleanup: pop context value when destroyed\n    ctx.cleanups.push(() => popContext(spec.pv as Context<unknown>));\n\n    return placeholder;\n  }\n\n  // handle portal node - render to different target\n  if (isPortalNode(spec)) {\n    const target = typeof spec.pt === 'string'\n      ? document.querySelector(spec.pt)\n      : spec.pt;\n\n    if (!target) {\n      console.warn(`[tooey] portal target not found: ${spec.pt}`);\n      return null;\n    }\n\n    // create a wrapper for portal content\n    const portalWrapper = document.createElement('div');\n    portalWrapper.style.display = 'contents';\n    portalWrapper.setAttribute('data-tooey-portal', 'true');\n\n    // render children into portal wrapper - detect if spec.c is already an array of node specs\n    // if first element is a function, it's a single function component NodeSpec [Fn, content?, props?]\n    const isNodeSpecArray = (arr: unknown[]): boolean => {\n      const first = arr[0];\n      if (typeof first === 'function') return false;\n      return Array.isArray(first) || isIfNode(first) || isMapNode(first) ||\n             isProviderNode(first) || isPortalNode(first) || isMemoNode(first) ||\n             isErrorBoundaryNode(first);\n    };\n\n    const children = Array.isArray(spec.c) && spec.c.length > 0 && isNodeSpecArray(spec.c as unknown[])\n      ? spec.c as NodeSpec[]\n      : [spec.c as NodeSpec];\n\n    children.forEach(child => {\n      const el = createElement(child, ctx, itemContext);\n      if (el) portalWrapper.appendChild(el);\n    });\n\n    // append to target\n    target.appendChild(portalWrapper);\n\n    // cleanup: remove portal content when destroyed\n    ctx.cleanups.push(() => {\n      if (portalWrapper.parentNode) {\n        portalWrapper.parentNode.removeChild(portalWrapper);\n      }\n    });\n\n    // return empty placeholder in original location\n    const placeholder = document.createElement('div');\n    placeholder.style.display = 'none';\n    placeholder.setAttribute('data-tooey-portal-anchor', 'true');\n    return placeholder;\n  }\n\n  // handle memo node - memoized rendering based on state dependencies\n  if (isMemoNode(spec)) {\n    const placeholder = document.createElement('div');\n    placeholder.style.display = 'contents';\n\n    let currentEl: HTMLElement | null = null;\n    let childCtx: RenderContext | null = null;\n    let prevValues: unknown[] = [];\n\n    const updateMemo = () => {\n      // get current values of dependencies\n      const currentValues = spec.mm.map(key => state[key]?.());\n\n      // check if any dependency changed\n      const hasChanged = prevValues.length === 0 ||\n        currentValues.some((val, i) => val !== prevValues[i]);\n\n      if (!hasChanged && currentEl) {\n        return; // skip re-render\n      }\n\n      prevValues = currentValues;\n\n      // cleanup previous render\n      if (childCtx) {\n        childCtx.cleanups.forEach(fn => fn());\n        childCtx.cleanups = [];\n      }\n      if (currentEl) {\n        placeholder.innerHTML = '';\n        currentEl = null;\n      }\n\n      childCtx = { cleanups: [], state, theme: ctx.theme, plugins: ctx.plugins };\n      currentEl = createElement(spec.c, childCtx, itemContext);\n      if (currentEl) {\n        placeholder.appendChild(currentEl);\n        ctx.cleanups.push(...childCtx.cleanups);\n      }\n    };\n\n    effect(updateMemo, ctx);\n    return placeholder;\n  }\n\n  // validate spec structure\n  if (!Array.isArray(spec) || (spec as unknown[]).length === 0) {\n    console.warn('[tooey] invalid node spec:', spec);\n    return null;\n  }\n\n  // apply beforeRender hooks from plugins\n  let processedSpec: NodeSpec = spec;\n  if (ctx.plugins) {\n    for (const plugin of ctx.plugins) {\n      if (plugin.beforeRender) {\n        processedSpec = plugin.beforeRender(processedSpec, ctx);\n      }\n    }\n  }\n\n  // if beforeRender transformed spec to a non-array type, recurse\n  if (!Array.isArray(processedSpec)) {\n    return createElement(processedSpec, ctx, itemContext);\n  }\n\n  // handle function components\n  const [first, content, props = {}] = processedSpec as [ComponentType | Component, Content?, Props?];\n  if (typeof first === 'function') {\n    // function component: call it with (props, children)\n    const children = Array.isArray(content) && content.length > 0 && (Array.isArray(content[0]) || isIfNode(content[0]) || isMapNode(content[0]) || typeof content[0] === 'function')\n      ? content as NodeSpec[]\n      : undefined;\n    const resolved = (first as Component)(props, children);\n    return createElement(resolved, ctx, itemContext);\n  }\n\n  const type = first as ComponentType;\n\n  // handle show prop - conditional rendering based on state\n  if (props.show !== undefined) {\n    const showKey = props.show;\n    const placeholder = document.createElement('div');\n    placeholder.style.display = 'contents';\n\n    let currentEl: HTMLElement | null = null;\n    let childCtx: RenderContext | null = null;\n\n    const updateShow = () => {\n      // cleanup previous render\n      if (childCtx) {\n        childCtx.cleanups.forEach(fn => fn());\n        childCtx.cleanups = [];\n      }\n      if (currentEl) {\n        placeholder.innerHTML = '';\n        currentEl = null;\n      }\n\n      const showValue = state[showKey]?.();\n      if (!showValue) return;\n\n      // create the element without the show prop to avoid infinite recursion\n      const { show: _, ...propsWithoutShow } = props;\n      childCtx = { cleanups: [], state, theme: ctx.theme, plugins: ctx.plugins };\n      currentEl = createElement([type, content, propsWithoutShow as Props], childCtx, itemContext);\n      if (currentEl) {\n        placeholder.appendChild(currentEl);\n        ctx.cleanups.push(...childCtx.cleanups);\n      }\n    };\n\n    effect(updateShow, ctx);\n    return placeholder;\n  }\n\n  let el: HTMLElement;\n\n  switch (type) {\n    case 'vs':\n      el = document.createElement('div');\n      el.style.display = 'flex';\n      el.style.flexDirection = 'column';\n      break;\n    case 'hs':\n      el = document.createElement('div');\n      el.style.display = 'flex';\n      el.style.flexDirection = 'row';\n      break;\n    case 'gr':\n      el = document.createElement('div');\n      el.style.display = 'grid';\n      if (props.cols) {\n        el.style.gridTemplateColumns = typeof props.cols === 'number'\n          ? `repeat(${props.cols}, 1fr)` : props.cols;\n      }\n      if (props.rows) {\n        el.style.gridTemplateRows = typeof props.rows === 'number'\n          ? `repeat(${props.rows}, 1fr)` : props.rows;\n      }\n      break;\n    case 'dv':\n      el = document.createElement('div');\n      break;\n    case 'tx':\n      el = document.createElement('span');\n      break;\n    case 'bt':\n      el = document.createElement('button');\n      break;\n    case 'in':\n      el = document.createElement('input');\n      (el as HTMLInputElement).type = props.type || 'text';\n      if (props.ph) (el as HTMLInputElement).placeholder = props.ph;\n      if (props.ro) (el as HTMLInputElement).readOnly = true;\n      break;\n    case 'ta':\n      el = document.createElement('textarea');\n      if (props.ph) (el as HTMLTextAreaElement).placeholder = props.ph;\n      if (props.rw) (el as HTMLTextAreaElement).rows = props.rw;\n      if (props.ro) (el as HTMLTextAreaElement).readOnly = true;\n      break;\n    case 'sl':\n      el = document.createElement('select');\n      if (props.opts) {\n        props.opts.forEach(opt => {\n          const option = document.createElement('option');\n          option.value = opt.v;\n          option.textContent = opt.l;\n          el.appendChild(option);\n        });\n      }\n      break;\n    case 'cb':\n      el = document.createElement('input');\n      (el as HTMLInputElement).type = 'checkbox';\n      break;\n    case 'rd':\n      el = document.createElement('input');\n      (el as HTMLInputElement).type = 'radio';\n      break;\n    case 'tb':\n      el = document.createElement('table');\n      break;\n    case 'th':\n      el = document.createElement('thead');\n      break;\n    case 'bd':\n      el = document.createElement('tbody');\n      break;\n    case 'tr':\n      el = document.createElement('tr');\n      break;\n    case 'td':\n      el = document.createElement('td');\n      if (props.sp) (el as HTMLTableCellElement).colSpan = props.sp;\n      if (props.rsp) (el as HTMLTableCellElement).rowSpan = props.rsp;\n      break;\n    case 'tc':\n      el = document.createElement('th');\n      if (props.sp) (el as HTMLTableCellElement).colSpan = props.sp;\n      if (props.rsp) (el as HTMLTableCellElement).rowSpan = props.rsp;\n      break;\n    case 'ul':\n      el = document.createElement('ul');\n      break;\n    case 'ol':\n      el = document.createElement('ol');\n      break;\n    case 'li':\n      el = document.createElement('li');\n      break;\n    case 'im':\n      el = document.createElement('img');\n      if (props.src) {\n        const safeSrc = sanitizeUrl(props.src, 'src');\n        if (safeSrc) (el as HTMLImageElement).src = safeSrc;\n      }\n      if (props.alt) (el as HTMLImageElement).alt = props.alt;\n      break;\n    case 'ln':\n      el = document.createElement('a');\n      if (props.href) {\n        const safeHref = sanitizeUrl(props.href, 'href');\n        if (safeHref) (el as HTMLAnchorElement).href = safeHref;\n      }\n      break;\n    case 'sv':\n      el = document.createElementNS('http://www.w3.org/2000/svg', 'svg') as unknown as HTMLElement;\n      break;\n    case 'fr':\n      // fragment - renders children without wrapper, but we need a container\n      // use display:contents to make it invisible in layout\n      el = document.createElement('div');\n      el.style.display = 'contents';\n      el.setAttribute('data-tooey-fragment', 'true');\n      break;\n    default:\n      console.warn(`[tooey] unknown component type: ${type}`);\n      el = document.createElement('div');\n  }\n\n  // handle ref prop\n  if (props.rf) {\n    if (typeof props.rf === 'function') {\n      (props.rf as RefCallback)(el);\n    } else {\n      (props.rf as Ref).el = el;\n    }\n  }\n\n  if (props.cls) el.className = props.cls;\n  if (props.id) el.id = props.id;\n  if (props.dis) (el as HTMLButtonElement).disabled = true;\n\n  applyStyles(el, props, ctx.theme);\n\n  // handle content\n  if (content !== undefined) {\n    if (Array.isArray(content) && content.length > 0 && (Array.isArray(content[0]) || isIfNode(content[0]) || isMapNode(content[0]) || isErrorBoundaryNode(content[0]))) {\n      (content as NodeSpec[]).forEach(childSpec => {\n        const child = createElement(childSpec, ctx, itemContext);\n        if (child) el.appendChild(child);\n      });\n    } else if (isIfNode(content) || isMapNode(content) || isErrorBoundaryNode(content)) {\n      const child = createElement(content as NodeSpec, ctx, itemContext);\n      if (child) el.appendChild(child);\n    } else if (isStateRef(content)) {\n      effect(() => {\n        const val = resolveValue(content, state);\n        if (type === 'in') {\n          (el as HTMLInputElement).value = String(val ?? '');\n        } else if (type === 'ta') {\n          (el as HTMLTextAreaElement).value = String(val ?? '');\n        } else if (type === 'cb' || type === 'rd') {\n          (el as HTMLInputElement).checked = Boolean(val);\n        } else {\n          // textContent provides XSS protection by not parsing HTML\n          el.textContent = String(val ?? '');\n        }\n      }, ctx);\n    } else if (typeof content === 'string' || typeof content === 'number') {\n      let textContent = String(content);\n      if (itemContext) {\n        // handle object property access first (before $item replacement)\n        if (typeof itemContext.item === 'object' && itemContext.item !== null) {\n          textContent = textContent.replace(/\\$item\\.(\\w+)/g, (_, key) => {\n            return String((itemContext.item as Record<string, unknown>)[key] ?? '');\n          });\n        }\n        textContent = textContent.replace(/\\$item/g, String(itemContext.item));\n        textContent = textContent.replace(/\\$index/g, String(itemContext.index));\n      }\n      // xss protection for static content\n      if (type === 'in') {\n        (el as HTMLInputElement).value = textContent;\n      } else if (type === 'ta') {\n        (el as HTMLTextAreaElement).value = textContent;\n      } else if (type !== 'sl') {\n        // don't set textContent for select (would clear options)\n        el.textContent = textContent;\n      }\n    }\n  }\n\n  // handle value binding for inputs\n  if (props.v !== undefined && isStateRef(props.v)) {\n    effect(() => {\n      const val = resolveValue(props.v!, state);\n      if (type === 'in' || type === 'sl' || type === 'ta') {\n        (el as HTMLInputElement).value = String(val ?? '');\n      } else if (type === 'cb' || type === 'rd') {\n        (el as HTMLInputElement).checked = Boolean(val);\n      }\n    }, ctx);\n  }\n\n  // handle checked binding\n  if (props.ch !== undefined) {\n    if (isStateRef(props.ch as unknown)) {\n      effect(() => {\n        const val = resolveValue(props.ch as unknown as StateRef, state);\n        (el as HTMLInputElement).checked = Boolean(val);\n      }, ctx);\n    } else {\n      (el as HTMLInputElement).checked = Boolean(props.ch);\n    }\n  }\n\n  // event handlers with cleanup tracking\n  const addEventListener = (event: string, handler: (e: Event) => void) => {\n    el.addEventListener(event, handler);\n    ctx.cleanups.push(() => el.removeEventListener(event, handler));\n  };\n\n  // get button text for implicit operation inference\n  const buttonText = type === 'bt' && (typeof content === 'string' || typeof content === 'number')\n    ? String(content)\n    : undefined;\n\n  if (props.c) {\n    addEventListener('click', (e) => createHandler(props.c!, state, e, itemContext, buttonText)());\n  }\n  if (props.x) {\n    const handler = props.x;\n    addEventListener('input', (e) => {\n      if (typeof handler === 'function') {\n        handler();\n      } else {\n        // normalize string shorthand to array form\n        let stateKey: string;\n        let op: Op;\n        if (typeof handler === 'string') {\n          const parsed = parseEventShorthand(handler);\n          if (parsed) {\n            [stateKey, op] = parsed;\n          } else {\n            // plain state key defaults to set (!) for input\n            stateKey = handler;\n            op = '!';\n          }\n        } else {\n          [stateKey, op] = handler;\n        }\n        const sig = state[stateKey];\n        if (sig) {\n          const target = e.target as HTMLInputElement;\n          const val = (type === 'cb' || type === 'rd') ? target.checked : target.value;\n          applyOp(sig, op, val);\n        }\n      }\n    });\n  }\n  if (props.f) {\n    addEventListener('focus', (e) => createHandler(props.f!, state, e, itemContext)());\n  }\n  if (props.bl) {\n    addEventListener('blur', (e) => createHandler(props.bl!, state, e, itemContext)());\n  }\n  if (props.k) {\n    addEventListener('keydown', (e) => createHandler(props.k!, state, e, itemContext)());\n  }\n  if (props.ku) {\n    addEventListener('keyup', (e) => createHandler(props.ku!, state, e, itemContext)());\n  }\n  if (props.kp) {\n    addEventListener('keypress', (e) => createHandler(props.kp!, state, e, itemContext)());\n  }\n  if (props.e) {\n    addEventListener('mouseenter', (e) => createHandler(props.e!, state, e, itemContext)());\n  }\n  if (props.lv) {\n    addEventListener('mouseleave', (e) => createHandler(props.lv!, state, e, itemContext)());\n  }\n  if (props.sub) {\n    addEventListener('submit', (e) => {\n      e.preventDefault();\n      createHandler(props.sub!, state, e, itemContext)();\n    });\n  }\n\n  // apply afterRender hooks from plugins\n  if (ctx.plugins) {\n    for (const plugin of ctx.plugins) {\n      if (plugin.afterRender) {\n        plugin.afterRender(el, processedSpec);\n      }\n    }\n  }\n\n  return el;\n}\n\n// ============ main api ============\n\ninterface TooeyInstance {\n  state: StateStore;\n  el: HTMLElement | null;\n  destroy(): void;\n  update(newSpec: TooeySpec): void;\n  get(key: string): unknown;\n  set(key: string, value: unknown): void;\n  // allow dynamic extension by plugins\n  [key: string]: unknown;\n}\n\nfunction render(container: HTMLElement, spec: TooeySpec, options?: RenderOptions): TooeyInstance {\n  if (!container) {\n    throw new Error('[tooey] render requires a valid container element');\n  }\n  if (!spec || !spec.r) {\n    throw new Error('[tooey] render requires a spec with a root node (r)');\n  }\n\n  const theme = options?.theme;\n  const plugins = options?.plugins || [];\n\n  // helper to create signals with plugin state change notification\n  const createStateSignal = (key: string, initial: StateValue): Signal<StateValue> => {\n    const sig = signal(initial);\n    const originalSet = sig.set.bind(sig);\n    sig.set = (v: StateValue | ((prev: StateValue) => StateValue)) => {\n      const oldVal = sig();\n      originalSet(v);\n      const newVal = sig();\n      if (oldVal !== newVal) {\n        plugins.forEach(p => p.onStateChange?.(key, oldVal, newVal));\n      }\n    };\n    return sig;\n  };\n\n  const state: StateStore = {};\n  if (spec.s) {\n    Object.entries(spec.s).forEach(([key, val]) => {\n      state[key] = createStateSignal(key, val);\n    });\n  }\n\n  const ctx: RenderContext = { cleanups: [], state, theme, plugins };\n\n  container.innerHTML = '';\n  const el = createElement(spec.r, ctx);\n  if (el) container.appendChild(el);\n\n  const instance: TooeyInstance = {\n    state,\n    el,\n    destroy() {\n      // call onDestroy hooks\n      plugins.forEach(p => p.onDestroy?.(instance));\n      ctx.cleanups.forEach(fn => fn());\n      ctx.cleanups = [];\n      container.innerHTML = '';\n    },\n    update(newSpec: TooeySpec) {\n      if (newSpec.s) {\n        batch(() => {\n          Object.entries(newSpec.s!).forEach(([key, val]) => {\n            if (state[key]) {\n              state[key].set(val);\n            } else {\n              state[key] = createStateSignal(key, val);\n            }\n          });\n        });\n      }\n      if (newSpec.r) {\n        ctx.cleanups.forEach(fn => fn());\n        ctx.cleanups = [];\n        container.innerHTML = '';\n        const newEl = createElement(newSpec.r, ctx);\n        if (newEl) container.appendChild(newEl);\n        instance.el = newEl;\n      }\n    },\n    get(key: string) {\n      return state[key]?.();\n    },\n    set(key: string, value: unknown) {\n      if (state[key]) {\n        state[key].set(value);\n      }\n    }\n  };\n\n  // apply plugin extend methods\n  plugins.forEach(plugin => {\n    if (plugin.extend) {\n      Object.entries(plugin.extend).forEach(([name, fn]) => {\n        instance[name] = fn.bind(instance);\n      });\n    }\n  });\n\n  // call onInit hooks\n  plugins.forEach(p => p.onInit?.(instance));\n\n  return instance;\n}\n\n// ============ factory function ============\n\ninterface CreateTooeyOptions {\n  theme?: Theme;\n  plugins?: TooeyPlugin[];\n}\n\ninterface TooeyFactory {\n  render: (container: HTMLElement, spec: TooeySpec) => TooeyInstance;\n  theme: Theme;\n  plugins?: TooeyPlugin[];\n}\n\n// createTooey supports both a Theme directly (backward compatible) or CreateTooeyOptions\nfunction createTooey(themeOrOptions: Theme | CreateTooeyOptions): TooeyFactory {\n  // detect if it's a theme (has colors/spacing/radius/fonts) or options (has theme/plugins keys)\n  const isOptions = themeOrOptions && ('theme' in themeOrOptions || 'plugins' in themeOrOptions);\n  const theme = isOptions ? (themeOrOptions as CreateTooeyOptions).theme : (themeOrOptions as Theme);\n  const plugins = isOptions ? (themeOrOptions as CreateTooeyOptions).plugins : undefined;\n  return {\n    render: (container: HTMLElement, spec: TooeySpec) => render(container, spec, { theme, plugins }),\n    theme: theme!,\n    plugins\n  };\n}\n\n// ============ convenience helpers ============\n\nfunction $(name: string): StateRef {\n  return { $: name };\n}\n\n// component type constants (2-letter abbreviations)\nconst vs = 'vs' as const;\nconst hs = 'hs' as const;\nconst dv = 'dv' as const;\nconst gr = 'gr' as const;\nconst tx = 'tx' as const;\nconst bt = 'bt' as const;\nconst In = 'in' as const; // capitalized export to avoid JS reserved word\nconst ta = 'ta' as const;\nconst sl = 'sl' as const;\nconst cb = 'cb' as const;\nconst rd = 'rd' as const;\nconst tb = 'tb' as const;\nconst th = 'th' as const;\nconst bd = 'bd' as const;\nconst Tr = 'tr' as const; // capitalized export to avoid collision with transform prop\nconst Td = 'td' as const; // capitalized for consistency with Tr\nconst tc = 'tc' as const;\nconst ul = 'ul' as const;\nconst ol = 'ol' as const;\nconst li = 'li' as const;\nconst im = 'im' as const;\nconst ln = 'ln' as const;\nconst sv = 'sv' as const;\nconst fr = 'fr' as const;\n\n// ============ ssr (server-side rendering) ============\n\n// spec to html string converter for SSR\nfunction specToHtml(spec: NodeSpec, state: Record<string, StateValue> = {}, theme?: Theme): string {\n  // create a mock state store for value resolution\n  const mockState: StateStore = {};\n  Object.entries(state).forEach(([key, val]) => {\n    // create a callable function that also has set and sub methods\n    const mockSig = (() => val) as Signal<StateValue>;\n    mockSig.set = () => {};\n    mockSig.sub = () => () => {};\n    mockState[key] = mockSig;\n  });\n\n  function resolveContent(content: unknown): string {\n    if (isStateRef(content)) {\n      const val = mockState[content.$]?.();\n      return val !== undefined && val !== null ? String(val) : '';\n    }\n    return String(content ?? '');\n  }\n\n  function resolveStyleVal(val: string | number | undefined): string | undefined {\n    if (val === undefined) return undefined;\n    if (typeof val === 'string' && val.startsWith('$') && theme) {\n      const token = val.slice(1);\n      const categories: (keyof Theme)[] = ['colors', 'spacing', 'radius', 'fonts'];\n      for (const cat of categories) {\n        const category = theme[cat];\n        if (category && token in category) {\n          const v = category[token];\n          return typeof v === 'number' ? `${v}px` : String(v);\n        }\n      }\n    }\n    return typeof val === 'number' ? `${val}px` : val;\n  }\n\n  function propsToStyle(props: Props): string {\n    const styles: string[] = [];\n    if (props.g !== undefined) { const v = resolveStyleVal(props.g); if (v) styles.push(`gap:${v}`); }\n    if (props.p !== undefined) { const v = resolveStyleVal(props.p); if (v) styles.push(`padding:${v}`); }\n    if (props.m !== undefined) { const v = resolveStyleVal(props.m); if (v) styles.push(`margin:${v}`); }\n    if (props.w !== undefined) { const v = resolveStyleVal(props.w); if (v) styles.push(`width:${v}`); }\n    if (props.h !== undefined) { const v = resolveStyleVal(props.h); if (v) styles.push(`height:${v}`); }\n    if (props.bg !== undefined) { const v = resolveStyleVal(props.bg); if (v) styles.push(`background:${v}`); }\n    if (props.fg !== undefined) { const v = resolveStyleVal(props.fg); if (v) styles.push(`color:${v}`); }\n    if (props.r !== undefined) { const v = resolveStyleVal(props.r); if (v) styles.push(`border-radius:${v}`); }\n    if (props.fs !== undefined) { const v = resolveStyleVal(props.fs); if (v) styles.push(`font-size:${v}`); }\n    if (props.fw !== undefined) styles.push(`font-weight:${props.fw}`);\n    if (props.ai !== undefined) styles.push(`align-items:${styleShortcuts[props.ai] || props.ai}`);\n    if (props.jc !== undefined) styles.push(`justify-content:${styleShortcuts[props.jc] || props.jc}`);\n    return styles.join(';');\n  }\n\n  function nodeToHtml(node: NodeSpec): string {\n    // handle if node\n    if (isIfNode(node)) {\n      const ifCond = node.if ?? node['?'];\n      const thenBranch = node.then ?? node.t;\n      const elseBranch = node.else ?? node.e;\n      const eqValue = node.eq ?? node.is;\n\n      const rawValue = typeof ifCond === 'string'\n        ? mockState[ifCond]?.()\n        : isStateRef(ifCond) ? mockState[ifCond.$]?.() : ifCond;\n\n      const condition = eqValue !== undefined ? rawValue === eqValue : Boolean(rawValue);\n      const branch = condition ? thenBranch : elseBranch;\n      if (!branch) return '';\n\n      if (Array.isArray(branch) && branch.length > 0 && Array.isArray(branch[0])) {\n        return (branch as NodeSpec[]).map(nodeToHtml).join('');\n      }\n      return nodeToHtml(branch as NodeSpec);\n    }\n\n    // handle map node\n    if (isMapNode(node)) {\n      const mapSource = node.map ?? node.m;\n      const asTemplate = node.as ?? node.a;\n      if (!asTemplate) return '';\n\n      const arr = (typeof mapSource === 'string'\n        ? mockState[mapSource]?.()\n        : isStateRef(mapSource) ? mockState[mapSource.$]?.() : mapSource) as unknown[];\n\n      if (!Array.isArray(arr)) return '';\n\n      return arr.map((item, index) => {\n        // temporarily set $item and $index for template resolution\n        const itemStr = typeof item === 'object' ? JSON.stringify(item) : String(item);\n        return nodeToHtml(asTemplate).replace(/\\$item\\.(\\w+)/g, (_, key) => {\n          return String((item as Record<string, unknown>)?.[key] ?? '');\n        }).replace(/\\$item/g, itemStr).replace(/\\$index/g, String(index));\n      }).join('');\n    }\n\n    // handle provider node\n    if (isProviderNode(node)) {\n      const children = Array.isArray(node.c) && node.c.length > 0 && Array.isArray(node.c[0])\n        ? node.c as NodeSpec[]\n        : [node.c as NodeSpec];\n      return children.map(nodeToHtml).join('');\n    }\n\n    // handle portal node - skip for SSR (render placeholder)\n    if (isPortalNode(node)) {\n      return '<!-- portal -->';\n    }\n\n    // handle memo node\n    if (isMemoNode(node)) {\n      return nodeToHtml(node.c);\n    }\n\n    // handle error boundary\n    if (isErrorBoundaryNode(node)) {\n      try {\n        return nodeToHtml(node.child);\n      } catch {\n        return node.fallback ? nodeToHtml(node.fallback) : '<div>[error]</div>';\n      }\n    }\n\n    if (!Array.isArray(node) || (node as unknown[]).length === 0) return '';\n\n    const [typeOrFn, content, props = {}] = node as [ComponentType | Component, Content?, Props?];\n\n    // handle function components\n    if (typeof typeOrFn === 'function') {\n      const children = Array.isArray(content) && content.length > 0 && Array.isArray(content[0])\n        ? content as NodeSpec[]\n        : undefined;\n      const resolved = (typeOrFn as Component)(props, children);\n      return nodeToHtml(resolved);\n    }\n\n    const type = typeOrFn as ComponentType;\n\n    // map component types to HTML tags\n    const tagMap: Record<ComponentType, string> = {\n      vs: 'div', hs: 'div', dv: 'div', gr: 'div', fr: 'div',\n      tx: 'span', bt: 'button',\n      in: 'input', ta: 'textarea', sl: 'select', cb: 'input', rd: 'input',\n      tb: 'table', th: 'thead', bd: 'tbody', tr: 'tr', td: 'td', tc: 'th',\n      ul: 'ul', ol: 'ol', li: 'li',\n      im: 'img', ln: 'a', sv: 'svg'\n    };\n\n    const tag = tagMap[type] || 'div';\n    const selfClosing = ['input', 'img'].includes(tag);\n\n    // build attributes\n    const attrs: string[] = [];\n\n    // add type-specific styles\n    let baseStyle = '';\n    if (type === 'vs') baseStyle = 'display:flex;flex-direction:column;';\n    if (type === 'hs') baseStyle = 'display:flex;flex-direction:row;';\n    if (type === 'gr') baseStyle = 'display:grid;';\n    if (type === 'fr') baseStyle = 'display:contents;';\n\n    const propsStyle = propsToStyle(props);\n    const fullStyle = baseStyle + propsStyle;\n    if (fullStyle) attrs.push(`style=\"${fullStyle}\"`);\n\n    if (props.cls) attrs.push(`class=\"${props.cls}\"`);\n    if (props.id) attrs.push(`id=\"${props.id}\"`);\n    if (props.dis) attrs.push('disabled');\n    if (props.href) attrs.push(`href=\"${props.href}\"`);\n    if (props.src) attrs.push(`src=\"${props.src}\"`);\n    if (props.alt) attrs.push(`alt=\"${props.alt}\"`);\n    if (props.ph) attrs.push(`placeholder=\"${props.ph}\"`);\n    if (props.type) attrs.push(`type=\"${props.type}\"`);\n    if (type === 'cb') attrs.push('type=\"checkbox\"');\n    if (type === 'rd') attrs.push('type=\"radio\"');\n\n    // add data attribute for hydration\n    attrs.push('data-tooey-ssr=\"true\"');\n\n    const attrStr = attrs.length > 0 ? ' ' + attrs.join(' ') : '';\n\n    if (selfClosing) {\n      return `<${tag}${attrStr}/>`;\n    }\n\n    // handle content\n    let innerHtml = '';\n    if (content !== undefined) {\n      if (Array.isArray(content) && content.length > 0 && (Array.isArray(content[0]) || isIfNode(content[0]) || isMapNode(content[0]))) {\n        innerHtml = (content as NodeSpec[]).map(nodeToHtml).join('');\n      } else if (isIfNode(content) || isMapNode(content)) {\n        innerHtml = nodeToHtml(content as NodeSpec);\n      } else if (typeof content === 'string' || typeof content === 'number' || isStateRef(content)) {\n        innerHtml = resolveContent(content);\n      }\n    }\n\n    // handle select options\n    if (type === 'sl' && props.opts) {\n      innerHtml = props.opts.map(opt =>\n        `<option value=\"${opt.v}\">${opt.l}</option>`\n      ).join('');\n    }\n\n    return `<${tag}${attrStr}>${innerHtml}</${tag}>`;\n  }\n\n  return nodeToHtml(spec);\n}\n\n// render to string for SSR (short name: rts)\nfunction rts(spec: TooeySpec, options?: { theme?: Theme }): string {\n  return specToHtml(spec.r, spec.s || {}, options?.theme);\n}\n\n// hydrate - attach event listeners and reactivity to SSR-rendered HTML\nfunction hy(container: HTMLElement, spec: TooeySpec, options?: RenderOptions): TooeyInstance {\n  // for now, just re-render (full hydration would require matching DOM nodes)\n  // this is a simple implementation - production would need smarter reconciliation\n  return render(container, spec, options);\n}\n\n// ============ router ============\n\ninterface Route {\n  p: string;  // path pattern\n  c: NodeSpec | Component;  // component to render\n  ch?: Route[];  // child routes for nested routing\n}\n\ninterface RouterState {\n  path: string;\n  params: Record<string, string>;\n  query: Record<string, string>;\n}\n\n// global router state\nlet routerState: Signal<RouterState> | null = null;\nlet routerBase = '';\n\nfunction initRouter(base = ''): Signal<RouterState> {\n  if (routerState) return routerState;\n\n  routerBase = base;\n  const getState = (): RouterState => {\n    const path = window.location.pathname.replace(base, '') || '/';\n    const query: Record<string, string> = {};\n    new URLSearchParams(window.location.search).forEach((v, k) => {\n      query[k] = v;\n    });\n    return { path, params: {}, query };\n  };\n\n  routerState = signal(getState());\n\n  // listen for popstate (back/forward)\n  window.addEventListener('popstate', () => {\n    routerState?.set(getState());\n  });\n\n  return routerState;\n}\n\n// navigate programmatically\nfunction nav(path: string, options?: { replace?: boolean }): void {\n  const fullPath = routerBase + path;\n  if (options?.replace) {\n    window.history.replaceState(null, '', fullPath);\n  } else {\n    window.history.pushState(null, '', fullPath);\n  }\n  if (routerState) {\n    const query: Record<string, string> = {};\n    new URLSearchParams(window.location.search).forEach((v, k) => {\n      query[k] = v;\n    });\n    routerState.set({ path, params: {}, query });\n  }\n}\n\n// match route pattern to path\nfunction matchRoute(pattern: string, path: string): { match: boolean; params: Record<string, string> } {\n  const patternParts = pattern.split('/').filter(Boolean);\n  const pathParts = path.split('/').filter(Boolean);\n\n  if (patternParts.length !== pathParts.length) {\n    // check for wildcard\n    if (!patternParts.some(p => p === '*')) {\n      return { match: false, params: {} };\n    }\n  }\n\n  const params: Record<string, string> = {};\n\n  for (let i = 0; i < patternParts.length; i++) {\n    const pp = patternParts[i];\n    const pathPart = pathParts[i];\n\n    if (pp === '*') {\n      return { match: true, params };\n    }\n    if (pp.startsWith(':')) {\n      params[pp.slice(1)] = pathPart || '';\n    } else if (pp !== pathPart) {\n      return { match: false, params: {} };\n    }\n  }\n\n  return { match: true, params };\n}\n\n// router props interface\ninterface RouterProps extends Props {\n  routes?: Route[];\n  base?: string;\n}\n\n// link props interface\ninterface LinkProps extends Props {\n  to?: string;\n}\n\n// route component props (passed to route components)\ninterface RouteProps extends Props {\n  params?: Record<string, string>;\n}\n\n// router component - renders matched route\nconst Router: Component<RouterProps> = (props) => {\n  const routes = props?.routes || [];\n  const base = props?.base || '';\n\n  initRouter(base);\n\n  return {\n    '?': { $: '_routerMatch' },\n    t: [dv, 'Route matched'],\n    e: [dv, 'No route matched']\n  } as unknown as NodeSpec;\n};\n\n// create router view that reactively renders matched route\nfunction createRouterView(routes: Route[], base = ''): NodeSpec {\n  const routerSig = initRouter(base);\n\n  // this needs to be a function component that re-evaluates on route change\n  const RouteView: Component = () => {\n    const { path } = routerSig();\n\n    for (const route of routes) {\n      const { match, params } = matchRoute(route.p, path);\n      if (match) {\n        // update params in router state\n        if (Object.keys(params).length > 0) {\n          routerSig.set(s => ({ ...s, params }));\n        }\n\n        if (typeof route.c === 'function') {\n          return (route.c as Component<RouteProps>)({ params });\n        }\n        return route.c as NodeSpec;\n      }\n    }\n\n    // no match - return empty\n    return [tx, ''];\n  };\n\n  return [RouteView];\n}\n\n// link component for navigation\nconst Link: Component<LinkProps> = (props, children) => {\n  const href = props?.to || '/';\n  return [ln, children || href, {\n    href: routerBase + href,\n    c: () => {\n      nav(href);\n    },\n    cls: props?.cls\n  }];\n};\n\n// router component type constants\nconst rt = Router;\nconst lk = Link;\n\n// outlet for nested routes (renders children routes)\nfunction ot(routes: Route[]): NodeSpec {\n  return createRouterView(routes);\n}\n\n// ============ devtools plugin ============\n\ninterface DevtoolsOptions {\n  name?: string;\n  log?: boolean;\n}\n\nfunction devtools(options?: DevtoolsOptions): TooeyPlugin {\n  const name = options?.name || 'tooey';\n  const shouldLog = options?.log ?? true;\n\n  let stateHistory: Array<{ timestamp: number; key: string; oldVal: unknown; newVal: unknown }> = [];\n\n  return {\n    name: 'devtools',\n\n    onInit(instance) {\n      if (shouldLog) {\n        console.log(`[${name}] initialized`, {\n          state: Object.fromEntries(\n            Object.entries(instance.state).map(([k, v]) => [k, v()])\n          )\n        });\n      }\n\n      // expose devtools API on window\n      if (typeof window !== 'undefined') {\n        (window as unknown as Record<string, unknown>).__TOOEY_DEVTOOLS__ = {\n          instance,\n          getState: () => Object.fromEntries(\n            Object.entries(instance.state).map(([k, v]) => [k, v()])\n          ),\n          setState: (key: string, value: unknown) => instance.set(key, value),\n          getHistory: () => stateHistory,\n          clearHistory: () => { stateHistory = []; }\n        };\n      }\n    },\n\n    onDestroy(_instance) {\n      if (shouldLog) {\n        console.log(`[${name}] destroyed`);\n      }\n      if (typeof window !== 'undefined') {\n        delete (window as unknown as Record<string, unknown>).__TOOEY_DEVTOOLS__;\n      }\n    },\n\n    onStateChange(key, oldVal, newVal) {\n      stateHistory.push({\n        timestamp: Date.now(),\n        key,\n        oldVal,\n        newVal\n      });\n\n      // keep last 100 entries\n      if (stateHistory.length > 100) {\n        stateHistory = stateHistory.slice(-100);\n      }\n\n      if (shouldLog) {\n        console.log(`[${name}] state change:`, key, oldVal, '\u2192', newVal);\n      }\n    }\n  };\n}\n\nexport {\n  // core\n  render,\n  createTooey,\n  signal,\n  effect,\n  batch,\n  computed,\n  async$,\n  $,\n  // components\n  vs, hs, dv, gr, fr,\n  tx, bt,\n  In, ta, sl, cb, rd,\n  tb, th, bd, Tr, Td, tc,\n  ul, ol, li,\n  im, ln, sv,\n  // refs\n  ref,\n  Ref,\n  RefCallback,\n  RefProp,\n  // context\n  cx,\n  ux,\n  Context,\n  ProviderNode,\n  PortalNode,\n  MemoNode,\n  // reducer\n  rd$,\n  Reducer,\n  Dispatch,\n  ReducerSpec,\n  // memo\n  mm,\n  // ssr\n  rts,\n  hy,\n  // router\n  rt,\n  lk,\n  ot,\n  nav,\n  Route,\n  RouterState,\n  RouterProps,\n  LinkProps,\n  RouteProps,\n  createRouterView,\n  // devtools\n  devtools,\n  DevtoolsOptions,\n  // types\n  TooeySpec,\n  NodeSpec,\n  Props,\n  StateRef,\n  TooeyInstance,\n  TooeyFactory,\n  CreateTooeyOptions,\n  IfNode,\n  MapNode,\n  ErrorBoundaryNode,\n  ErrorInfo,\n  ErrorHandler,\n  Component,\n  Theme,\n  RenderOptions,\n  TooeyPlugin,\n  ComputedSignal,\n  AsyncSpec\n};\n"],
  "mappings": "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",
  "names": ["tooey_exports", "__export", "$", "In", "Td", "Tr", "async$", "batch", "bd", "bt", "cb", "computed", "createRouterView", "createTooey", "cx", "devtools", "dv", "effect", "fr", "gr", "hs", "hy", "im", "li", "lk", "ln", "mm", "nav", "ol", "ot", "rd", "rd$", "ref", "render", "rt", "rts", "signal", "sl", "sv", "ta", "tb", "tc", "th", "tx", "ul", "ux", "vs", "initial", "contextIdCounter", "contextStacks", "defaultValue", "id", "context", "stack", "pushContext", "value", "popContext", "isErrorBoundaryNode", "v", "createErrorFallback", "error", "el", "currentEffect", "batchDepth", "pendingEffects", "subscribers", "sig", "newValue", "fn", "effects", "ctx", "isActive", "execute", "cleanup", "cachedValue", "isDirty", "recompute", "sub", "prevEffect", "subFn", "promiseOrFn", "options", "instance", "data", "err", "errorMessage", "reducer", "initialState", "currentState", "dispatch", "action", "newState", "key", "val", "target", "prop", "inst", "component", "compareFn", "cachedResult", "prevProps", "compare", "prev", "next", "prevKeys", "nextKeys", "props", "children", "applyOp", "state", "op", "arr", "_", "i", "item", "isStateRef", "isIfNode", "isMapNode", "isProviderNode", "isPortalNode", "isMemoNode", "resolveValue", "content", "resolveCssValue", "resolveThemeValue", "token", "theme", "categories", "category", "cat", "styleShortcuts", "expandStyleValue", "parseEventShorthand", "str", "lastChar", "bangIdx", "stateKey", "valStr", "SAFE_URL_PROTOCOLS", "isValidUrl", "url", "parsed", "lowerUrl", "pattern", "sanitizeUrl", "propName", "createHandler", "handler", "state", "event", "itemContext", "buttonText", "normalizedHandler", "parseEventShorthand", "stateKey", "op", "val", "sig", "actualVal", "key", "target", "applyOp", "resolveStyleValue", "theme", "token", "themeVal", "resolveThemeValue", "applyStyles", "el", "props", "style", "resolve", "resolved", "resolveCssValue", "resolveStr", "v", "posMap", "expandStyleValue", "createElement", "spec", "ctx", "isErrorBoundaryNode", "placeholder", "childCtx", "child", "err", "errorInfo", "fallbackEl", "createErrorFallback", "isIfNode", "currentEl", "ifCond", "thenBranch", "elseBranch", "eqValue", "effect", "fn", "rawValue", "resolveValue", "condition", "branch", "isMapNode", "mapSource", "asTemplate", "arr", "item", "index", "isProviderNode", "pushContext", "isNodeSpecArray", "first", "isPortalNode", "isMemoNode", "popContext", "portalWrapper", "prevValues", "currentValues", "i", "processedSpec", "plugin", "content", "children", "type", "showKey", "_", "propsWithoutShow", "opt", "option", "safeSrc", "safeHref", "childSpec", "isStateRef", "textContent", "addEventListener", "e", "render", "container", "options", "plugins", "createStateSignal", "initial", "signal", "originalSet", "oldVal", "newVal", "p", "instance", "newSpec", "batch", "newEl", "value", "name", "createTooey", "themeOrOptions", "isOptions", "$", "vs", "hs", "dv", "gr", "tx", "bt", "In", "ta", "sl", "cb", "rd", "tb", "th", "bd", "Tr", "Td", "tc", "ul", "ol", "li", "im", "ln", "sv", "fr", "specToHtml", "mockState", "mockSig", "resolveContent", "resolveStyleVal", "categories", "cat", "category", "propsToStyle", "styles", "styleShortcuts", "nodeToHtml", "node", "itemStr", "typeOrFn", "tag", "selfClosing", "attrs", "baseStyle", "propsStyle", "fullStyle", "attrStr", "innerHtml", "rts", "hy", "routerState", "routerBase", "initRouter", "base", "getState", "path", "query", "k", "nav", "fullPath", "matchRoute", "patternParts", "pathParts", "params", "pp", "pathPart", "Router", "routes", "createRouterView", "routerSig", "route", "match", "s", "Link", "href", "rt", "lk", "ot", "devtools", "shouldLog", "stateHistory", "_instance"]
}
